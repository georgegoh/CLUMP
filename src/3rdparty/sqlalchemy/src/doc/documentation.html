<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>
    SQLAlchemy Documentation
</title>
	
    <link rel="stylesheet" href="style.css"></link>
    <link rel="stylesheet" href="docs.css"></link>
    <link href="syntaxhighlight.css" rel="stylesheet" type="text/css"></link>
    <script src="scripts.js"></script>



</head>
<body>








<div id="topanchor"><a name="top">&nbsp;</a></div>


<h1>SQLAlchemy 0.3 Documentation</h1>

<div id="pagecontrol"><a href="index.html">Multiple Pages</a> | <a href="documentation.html">One Page</a></div>

<div class="versionheader">Version: 0.3.7   Last Updated: 04/30/07 00:08:52</div>







	<div class="topnav">

	<a name="table_of_contents"></a>
	<h3>Table of Contents</h3>
	&nbsp;&nbsp;
	<a href="#full_index">(view full table)</a>
	<br/><br/>
	
    <ul>
        
        <li><A style="" href="#tutorial">Tutorial</a></li>
        
        
        <li><A style="" href="#dbengine">Database Engines</a></li>
        
        
        <li><A style="" href="#metadata">Database Meta Data</a></li>
        
        
        <li><A style="" href="#sql">Constructing SQL Queries via Python Expressions</a></li>
        
        
        <li><A style="" href="#datamapping">Data Mapping</a></li>
        
        
        <li><A style="" href="#unitofwork">Session / Unit of Work</a></li>
        
        
        <li><A style="" href="#advdatamapping">Advanced Data Mapping</a></li>
        
        
        <li><A style="" href="#types">The Types System</a></li>
        
        
        <li><A style="" href="#pooling">Connection Pooling</a></li>
        
        
        <li><A style="" href="#plugins">Plugins</a></li>
        
        
        <li><A style="" href="docstrings.html">Generated Documentation</a></li>
        
    </ul>


	<a name="full_index"></a>
	<h3>Table of Contents: Full</h3>
	&nbsp;&nbsp;
	<a href="#table_of_contents">(view brief table)</a>
	
	
    <ul>
        
        <li><A style="" href="#tutorial">Tutorial</a></li>
        
            
    <ul>
        
        <li><A style="" href="#tutorial_installation">Installation</a></li>
        
            
    <ul>
        
        <li><A style="" href="#tutorial_installation_sqlalchemy">Installing SQLAlchemy</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_installation_dbms">Installing a Database API</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#tutorial_gettingstarted">Getting Started</a></li>
        
            
    <ul>
        
        <li><A style="" href="#tutorial_gettingstarted_imports">Imports</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_gettingstarted_connecting">Connecting to the Database</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#tutorial_twoinone">SQLAlchemy is Two Libraries in One</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql">Working with Database Objects</a></li>
        
            
    <ul>
        
        <li><A style="" href="#tutorial_schemasql_metadata">Defining Metadata, Binding to Engines</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql_table_creating">Creating a Table</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql_inserting">Inserting Rows</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql_selecting">Selecting</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql_working">Working with Rows</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_schemasql_table_relationships">Table Relationships</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#tutorial_orm">Working with Object Mappers</a></li>
        
            
    <ul>
        
        <li><A style="" href="#tutorial_orm_mapper">Creating a Mapper</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_session">Obtaining a Session</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_query">The Query Object</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_changes">Making Changes</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_saving">Saving</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_relationships">Relationships</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#tutorial_orm_transactions">Transactions</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#tutorial_next">Next Steps</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#dbengine">Database Engines</a></li>
        
            
    <ul>
        
        <li><A style="" href="#dbengine_supported">Supported Databases</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#dbengine_establishing">Establishing a Database Engine</a></li>
        
            
    <ul>
        
        <li><A style="" href="#dbengine_establishing_custom">Custom DBAPI keyword arguments</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#dbengine_options">Database Engine Options</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#dbengine_logging">Configuring Logging</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#dbengine_connections">Using Connections</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#dbengine_transactions">Transactions</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#dbengine_implicit">Implicit Execution</a></li>
        
            
    <ul>
        
        <li><A style="" href="#dbengine_implicit_strategies">Implicit Execution Strategies</a></li>
        
            
    <ul>
    </ul>

    </ul>

    </ul>

        
        <li><A style="" href="#metadata">Database Meta Data</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_tables">Describing Databases with MetaData</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_tables_binding">Binding MetaData to an Engine</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_tables_using">Using the global Metadata object</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_tables_reflecting">Reflecting Tables</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_tables_reflecting_overriding">Overriding Reflected Columns</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#metadata_tables_schema">Specifying the Schema Name</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_tables_onupdate">ON UPDATE and ON DELETE</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_tables_quoting">Enabling Table / Column Quoting</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_tables_options">Other Options</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#metadata_creating">Creating and Dropping Database Tables</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_defaults">Column Defaults and OnUpdates</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_defaults_oninsert">Pre-Executed Insert Defaults</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_defaults_onupdate">Pre-Executed OnUpdate Defaults</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_defaults_passive">Inline Default Execution: PassiveDefault</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_defaults_passive_postgres">The Catch: Postgres Primary Key Defaults always Pre-Execute</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#metadata_defaults_sequences">Defining Sequences</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#metadata_constraints">Defining Constraints and Indexes</a></li>
        
            
    <ul>
        
        <li><A style="" href="#metadata_constraints_unique">UNIQUE Constraint</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_constraints_check">CHECK Constraint</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#metadata_constraints_indexes">Indexes</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#metadata_adapting">Adapting Tables to Alternate Metadata</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql">Constructing SQL Queries via Python Expressions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_select">Simple Select</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_select_explicit">Explicit Execution</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_select_binding">Binding ClauseElements to Engines</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_select_resultproxy">Getting Results</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_select_labels">Using Column Labels</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_select_columns">Table/Column Specification</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_whereclause">WHERE Clause</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_whereclause_operators">Operators</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_whereclause_functions">Functions</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_whereclause_literals">Literals</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_whereclause_orderby">Order By</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_whereclause_options">DISTINCT, LIMIT and OFFSET</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_join">Inner and Outer Joins</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_alias">Table Aliases</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_subqueries">Subqueries</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_subqueries_scalar">Scalar Column Subqueries</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_correlated">Correlated Subqueries</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_correlated_exists">EXISTS Clauses</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_unions">Unions</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_bindparams">Custom Bind Parameters</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_bindparams_precompiling">Precompiling a Query</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_textual">Literal Text Blocks</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_textual_textual_binds">Using Bind Parameters in Text Blocks</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_building">Building Select Objects</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_insert">Inserts</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#sql_update">Updates</a></li>
        
            
    <ul>
        
        <li><A style="" href="#sql_update_correlated">Correlated Updates</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#sql_delete">Deletes</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#datamapping">Data Mapping</a></li>
        
            
    <ul>
        
        <li><A style="" href="#datamapping_datamapping">Basic Data Mapping</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_synopsis">Synopsis</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_query">The Query Object</a></li>
        
            
    <ul>
        
        <li><A style="" href="#datamapping_query_fullselect">Issuing Full SELECT statements</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_query_callingstyles">Two General Calling Styles</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_query_primarykey">Loading by Primary Key</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_query_columnsonclass">Column Objects Available via their Mapped Class</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_query_generative">Generative Query Methods</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#datamapping_saving">Saving Objects</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_relations">Defining and Using Relationships</a></li>
        
            
    <ul>
        
        <li><A style="" href="#datamapping_relations_onetomany">One to Many</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_relations_lifecycle">Lifecycle Relations</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_relations_backreferences">Backreferences</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#datamapping_selectrelations">Selecting from Relationships</a></li>
        
            
    <ul>
        
        <li><A style="" href="#datamapping_selectrelations_queryjoins">Selecting With Joins</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_selectrelations_relselectby">Creating Joins Using filter_by() and select_by()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_selectrelations_jointo">Generating Join Criterion Using join()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_selectrelations_joinparent">Joining from a Parent Object</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_selectrelations_eagerload">Eager Loading</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_selectrelations_options">Using Options to Change the Loading Strategy</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#datamapping_onetoone">One to One/Many to One</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_manytomany">Many to Many</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#datamapping_association">Association Object</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#unitofwork">Session / Unit of Work</a></li>
        
            
    <ul>
        
        <li><A style="" href="#unitofwork_overview">Overview</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_states">Object States</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_getting">Acquiring a Session</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_identitymap">Introduction to the Identity Map</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_changed">Whats Changed ?</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api">The Session API</a></li>
        
            
    <ul>
        
        <li><A style="" href="#unitofwork_api_query">query()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_get">get()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_load">load()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_save">save()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_flush">flush()</a></li>
        
            
    <ul>
        
        <li><A style="" href="#unitofwork_api_flush_whatis">Notes on Flush</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#unitofwork_api_close">close()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_delete">delete()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_clear">clear()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_refreshexpire">refresh() / expire()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_expunge">expunge()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_bind">bind_mapper() / bind_table()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_update">update()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_saveorupdate">save_or_update()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_api_merge">merge()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#unitofwork_cascade">Cascade rules</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_transaction">SessionTransaction</a></li>
        
            
    <ul>
        
        <li><A style="" href="#unitofwork_transaction_sql">Using SQL with SessionTransaction</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#unitofwork_transaction_using">Using Engine-level Transactions with Sessions</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#unitofwork_logging">Analyzing Object Flushes</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#advdatamapping">Advanced Data Mapping</a></li>
        
            
    <ul>
        
        <li><A style="" href="#advdatamapping_properties">More On Mapper Properties</a></li>
        
            
    <ul>
        
        <li><A style="" href="#advdatamapping_properties_colname">Overriding Column Names</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_overriding">Overriding Properties</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_customlist">Custom List Classes</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_customjoin">Custom Join Conditions</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_multiplejoin">Lazy/Eager Joins Multiple Times to One Table</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_deferred">Deferred Column Loading</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_working">Working with Large Collections</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_properties_relationoptions">Relation Options</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#advdatamapping_orderby">Controlling Ordering</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_limits">Limiting Rows</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_inheritance">Mapping a Class with Table Inheritance</a></li>
        
            
    <ul>
        
        <li><A style="" href="#advdatamapping_inheritance_single">Single Table Inheritance</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_inheritance_concrete">Concrete Table Inheritance</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_inheritance_multiple">Multiple Table Inheritance</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#advdatamapping_joins">Mapping a Class against Multiple Tables</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_selects">Mapping a Class against Arbitrary Selects</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_multiple">Multiple Mappers for One Class</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_selfreferential">Self Referential Mappers</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_resultset">Result-Set Mapping</a></li>
        
            
    <ul>
        
        <li><A style="" href="#advdatamapping_resultset_combining">Combining Eager Loads with Result Set Mappings</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#advdatamapping_mapperoptions">Mapper Options</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#advdatamapping_extending">Extending Mapper</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#types">The Types System</a></li>
        
            
    <ul>
        
        <li><A style="" href="#types_standard">Built-in Types</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#types_custom">Creating your Own Types</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#pooling">Connection Pooling</a></li>
        
            
    <ul>
        
        <li><A style="" href="#pooling_establishing">Establishing a Transparent Connection Pool</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#pooling_configuration">Connection Pool Configuration</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#pooling_custom">Custom Pool Construction</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#plugins">Plugins</a></li>
        
            
    <ul>
        
        <li><A style="" href="#plugins_sessioncontext">SessionContext</a></li>
        
            
    <ul>
        
        <li><A style="" href="#plugins_sessioncontext_sessioncontextext">Using SessionContextExt</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="#plugins_selectresults">SelectResults</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_assignmapper">assignmapper</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_associationproxy">associationproxy</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_threadlocal">threadlocal</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_activemapper">ActiveMapper</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_sqlsoup">SqlSoup</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#plugins_proxyengine">ProxyEngine</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="docstrings.html">Generated Documentation</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql">module sqlalchemy.sql</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_alias">alias()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_and_">and_()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_asc">asc()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_between">between()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_between_">between_()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_bindparam">bindparam()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_case">case()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_cast">cast()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_column">column()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_delete">delete()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_desc">desc()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_except_">except_()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_except_all">except_all()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_exists">exists()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_extract">extract()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_insert">insert()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_intersect">intersect()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_intersect_all">intersect_all()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_is_column">is_column()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_join">join()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_label">label()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_literal">literal()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_literal_column">literal_column()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_not_">not_()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_null">null()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_or_">or_()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_outerjoin">outerjoin()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_select">select()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_subquery">subquery()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_table">table()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_text">text()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_union">union()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_union_all">union_all()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.sql_modfunc_update">update()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_AbstractDialect">class AbstractDialect(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Alias">class Alias(FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__BinaryClause">class _BinaryClause(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__BinaryExpression">class _BinaryExpression(_BinaryClause,ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__BindParamClause">class _BindParamClause(ClauseElement,_CompareMixin)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__BooleanExpression">class _BooleanExpression(_BinaryExpression)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__CalculatedClause">class _CalculatedClause(ClauseList,ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Cast">class _Cast(ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ClauseElement">class ClauseElement(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ClauseList">class ClauseList(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ClauseParameters">class ClauseParameters(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ClauseVisitor">class ClauseVisitor(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__ColumnClause">class _ColumnClause(ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ColumnCollection">class ColumnCollection(OrderedProperties)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_ColumnElement">class ColumnElement(Selectable,_CompareMixin)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__CompareMixin">class _CompareMixin(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Compiled">class Compiled(ClauseVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__CompoundClause">class _CompoundClause(ClauseList)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_CompoundSelect">class CompoundSelect(_SelectBaseMixin,FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Delete">class _Delete(_UpdateBase)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Executor">class Executor(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Exists">class _Exists(_BooleanExpression)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_FromClause">class FromClause(Selectable)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Function">class _Function(_CalculatedClause,FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__FunctionGateway">class _FunctionGateway(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__FunctionGenerator">class _FunctionGenerator(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Insert">class _Insert(_UpdateBase)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Join">class Join(FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Label">class _Label(ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_LoggingClauseVisitor">class LoggingClauseVisitor(ClauseVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_NoColumnVisitor">class NoColumnVisitor(ClauseVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Null">class _Null(ColumnElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Select">class Select(_SelectBaseMixin,FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__SelectBaseMixin">class _SelectBaseMixin(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Selectable">class Selectable(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_TableClause">class TableClause(FromClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__TextClause">class _TextClause(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__TypeClause">class _TypeClause(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__Update">class _Update(_UpdateBase)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql__UpdateBase">class _UpdateBase(ClauseElement)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema">module sqlalchemy.schema</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_BoundMetaData">class BoundMetaData(MetaData)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_CheckConstraint">class CheckConstraint(Constraint)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Column">class Column(SchemaItem,_ColumnClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ColumnDefault">class ColumnDefault(DefaultGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Constraint">class Constraint(SchemaItem)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_DefaultGenerator">class DefaultGenerator(SchemaItem)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_DynamicMetaData">class DynamicMetaData(MetaData)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ForeignKey">class ForeignKey(SchemaItem)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ForeignKeyConstraint">class ForeignKeyConstraint(Constraint)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Index">class Index(SchemaItem)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_MetaData">class MetaData(SchemaItem)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_PassiveDefault">class PassiveDefault(DefaultGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_PrimaryKeyConstraint">class PrimaryKeyConstraint(Constraint)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_SchemaItem">class SchemaItem(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_SchemaVisitor">class SchemaVisitor(ClauseVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Sequence">class Sequence(DefaultGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Table">class Table(SchemaItem,TableClause)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_UniqueConstraint">class UniqueConstraint(Constraint)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types">module sqlalchemy.types</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_BLOB">class BLOB(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_BOOLEAN">class BOOLEAN(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Binary">class Binary(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Boolean">class Boolean(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_CHAR">class CHAR(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_CLOB">class CLOB(TEXT)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DATE">class DATE(Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DATETIME">class DATETIME(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DECIMAL">class DECIMAL(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Date">class Date(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DateTime">class DateTime(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_FLOAT">class FLOAT(Float)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Float">class Float(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_INT">class INT(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Integer">class Integer(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_NCHAR">class NCHAR(Unicode)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_NullTypeEngine">class NullTypeEngine(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Numeric">class Numeric(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_PickleType">class PickleType(MutableType,TypeDecorator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_SMALLINT">class SMALLINT(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_SmallInteger">class SmallInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_String">class String(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TEXT">class TEXT(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TIME">class TIME(Time)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TIMESTAMP">class TIMESTAMP(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Time">class Time(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TypeDecorator">class TypeDecorator(AbstractType)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TypeEngine">class TypeEngine(AbstractType)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Unicode">class Unicode(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_VARCHAR">class VARCHAR(String)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine">module sqlalchemy.engine</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.engine_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.engine_modfunc_create_engine">create_engine()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.engine_modfunc_engine_descriptors">engine_descriptors()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_BufferedColumnResultProxy">class BufferedColumnResultProxy(ResultProxy)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_BufferedRowResultProxy">class BufferedRowResultProxy(ResultProxy)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connectable">class Connectable(Executor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connection">class Connection(Connectable)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ConnectionProvider">class ConnectionProvider(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_DefaultRunner">class DefaultRunner(SchemaVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Dialect">class Dialect(AbstractDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Engine">class Engine(Connectable)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ExecutionContext">class ExecutionContext(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ResultProxy">class ResultProxy(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_RowProxy">class RowProxy(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_SchemaIterator">class SchemaIterator(SchemaVisitor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Transaction">class Transaction(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine_url.html#docstrings_sqlalchemy.engine.url">module sqlalchemy.engine.url</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.engine.url_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.engine.url_modfunc_make_url">make_url()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine_url.html#docstrings_sqlalchemy.engine.url_URL">class URL(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies">module sqlalchemy.engine.strategies</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_DefaultEngineStrategy">class DefaultEngineStrategy(EngineStrategy)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_EngineStrategy">class EngineStrategy(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_MockEngineStrategy">class MockEngineStrategy(EngineStrategy)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_PlainEngineStrategy">class PlainEngineStrategy(DefaultEngineStrategy)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_ThreadLocalEngineStrategy">class ThreadLocalEngineStrategy(DefaultEngineStrategy)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default">module sqlalchemy.engine.default</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default_DefaultDialect">class DefaultDialect(Dialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default_DefaultExecutionContext">class DefaultExecutionContext(ExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default_PoolConnectionProvider">class PoolConnectionProvider(ConnectionProvider)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal">module sqlalchemy.engine.threadlocal</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLConnection">class TLConnection(Connection)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLEngine">class TLEngine(Engine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLSession">class TLSession(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLTransaction">class TLTransaction(Transaction)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLocalConnectionProvider">class TLocalConnectionProvider(PoolConnectionProvider)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql">module sqlalchemy.ansisql</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSICompiler">class ANSICompiler(Compiled)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSIDefaultRunner">class ANSIDefaultRunner(DefaultRunner)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSIDialect">class ANSIDialect(DefaultDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSIIdentifierPreparer">class ANSIIdentifierPreparer(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSISchemaBase">class ANSISchemaBase(SchemaIterator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSISchemaDropper">class ANSISchemaDropper(ANSISchemaBase)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ansisql.html#docstrings_sqlalchemy.ansisql_ANSISchemaGenerator">class ANSISchemaGenerator(ANSISchemaBase)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm">module sqlalchemy.orm</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_backref">backref()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_cascade_mappers">cascade_mappers()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_class_mapper">class_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_clear_mapper">clear_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_clear_mappers">clear_mappers()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_column_property">column_property()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_compile_mappers">compile_mappers()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_contains_alias">contains_alias()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_contains_eager">contains_eager()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_defer">defer()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_deferred">deferred()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_eagerload">eagerload()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_extension">extension()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_lazyload">lazyload()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_mapper">mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_noload">noload()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_object_mapper">object_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_object_session">object_session()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_polymorphic_union">polymorphic_union()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_relation">relation()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_synonym">synonym()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm_modfunc_undefer">undefer()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_MapperExtension">class MapperExtension(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_Query">class Query(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_Session">class Session(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper">module sqlalchemy.orm.mapper</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm.mapper_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm.mapper_modfunc_class_mapper">class_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm.mapper_modfunc_object_mapper">object_mapper()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper_MapperExtension">class MapperExtension(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper_Mapper">class Mapper(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query">module sqlalchemy.orm.query</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_Query">class Query(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_QueryContext">class QueryContext(OperationContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_SelectionContext">class SelectionContext(OperationContext)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session">module sqlalchemy.orm.session</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm.session_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.orm.session_modfunc_class_mapper">class_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm.session_modfunc_object_mapper">object_mapper()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.orm.session_modfunc_object_session">object_session()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_Session">class Session(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_SessionTransaction">class SessionTransaction(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions">module sqlalchemy.exceptions</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_ArgumentError">class ArgumentError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_AssertionError">class AssertionError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_CircularDependencyError">class CircularDependencyError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_CompileError">class CompileError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_ConcurrentModificationError">class ConcurrentModificationError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_DBAPIError">class DBAPIError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_FlushError">class FlushError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_InvalidRequestError">class InvalidRequestError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_NoSuchColumnError">class NoSuchColumnError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_NoSuchTableError">class NoSuchTableError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_SQLAlchemyError">class SQLAlchemyError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_SQLError">class SQLError()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_exceptions.html#docstrings_sqlalchemy.exceptions_TimeoutError">class TimeoutError()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool">module sqlalchemy.pool</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.pool_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.pool_modfunc_clear_managers">clear_managers()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.pool_modfunc_manage">manage()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_AssertionPool">class AssertionPool(Pool)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_NullPool">class NullPool(Pool)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_Pool">class Pool(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_QueuePool">class QueuePool(Pool)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_SingletonThreadPool">class SingletonThreadPool(Pool)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_ext_sessioncontext.html#docstrings_sqlalchemy.ext.sessioncontext">module sqlalchemy.ext.sessioncontext</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_ext_sessioncontext.html#docstrings_sqlalchemy.ext.sessioncontext_SessionContext">class SessionContext(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ext_sessioncontext.html#docstrings_sqlalchemy.ext.sessioncontext_SessionContextExt">class SessionContextExt(MapperExtension)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_mods_threadlocal.html#docstrings_sqlalchemy.mods.threadlocal">module sqlalchemy.mods.threadlocal</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.mods.threadlocal_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.mods.threadlocal_modfunc_assign_mapper">assign_mapper()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_mods_threadlocal.html#docstrings_sqlalchemy.mods.threadlocal_Objectstore">class Objectstore(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_ext_selectresults.html#docstrings_sqlalchemy.ext.selectresults">module sqlalchemy.ext.selectresults</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_ext_selectresults.html#docstrings_sqlalchemy.ext.selectresults_SelectResults">class SelectResults(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ext_selectresults.html#docstrings_sqlalchemy.ext.selectresults_SelectResultsExt">class SelectResultsExt(MapperExtension)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_ext_proxy.html#docstrings_sqlalchemy.ext.proxy">module sqlalchemy.ext.proxy</a></li>
        
            
    <ul>
        
        <li><A style="" href="sqlalchemy_ext_proxy.html#docstrings_sqlalchemy.ext.proxy_AutoConnectEngine">class AutoConnectEngine(BaseProxyEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ext_proxy.html#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">class BaseProxyEngine(Executor)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_ext_proxy.html#docstrings_sqlalchemy.ext.proxy_ProxyEngine">class ProxyEngine(BaseProxyEngine)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite">module sqlalchemy.databases.sqlite</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.sqlite_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.sqlite_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_DateTimeMixin">class DateTimeMixin(object)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_PassiveDefault">class PassiveDefault(DefaultGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLBinary">class SLBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLBoolean">class SLBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLChar">class SLChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLDate">class SLDate(DateTimeMixin,Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLDateTime">class SLDateTime(DateTimeMixin,DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLInteger">class SLInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLNumeric">class SLNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLSmallInteger">class SLSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLString">class SLString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLText">class SLText(TEXT)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLTime">class SLTime(DateTimeMixin,Time)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteCompiler">class SQLiteCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteDialect">class SQLiteDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteExecutionContext">class SQLiteExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteIdentifierPreparer">class SQLiteIdentifierPreparer(ANSIIdentifierPreparer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteSchemaDropper">class SQLiteSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteSchemaGenerator">class SQLiteSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres">module sqlalchemy.databases.postgres</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.postgres_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.postgres_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG1Date">class PG1Date(Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG1DateTime">class PG1DateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG1Time">class PG1Time(Time)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG2Date">class PG2Date(Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG2DateTime">class PG2DateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PG2Time">class PG2Time(Time)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBigInteger">class PGBigInteger(PGInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBinary">class PGBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBoolean">class PGBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGChar">class PGChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGCompiler">class PGCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDefaultRunner">class PGDefaultRunner(ANSIDefaultRunner)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDialect">class PGDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGExecutionContext">class PGExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGFloat">class PGFloat(Float)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGIdentifierPreparer">class PGIdentifierPreparer(ANSIIdentifierPreparer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInet">class PGInet(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInteger">class PGInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInterval">class PGInterval(TypeEngine)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGNumeric">class PGNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSchemaDropper">class PGSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSchemaGenerator">class PGSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSmallInteger">class PGSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGString">class PGString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGText">class PGText(TEXT)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql">module sqlalchemy.databases.mysql</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.mysql_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.mysql_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="#docstrings_sqlalchemy.databases.mysql_modfunc_kw_colspec">kw_colspec()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBigInteger">class MSBigInteger(MSInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBinary">class MSBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBoolean">class MSBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSChar">class MSChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDate">class MSDate(Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDateTime">class MSDateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDecimal">class MSDecimal(MSNumeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDouble">class MSDouble(MSNumeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSEnum">class MSEnum(MSString)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSFloat">class MSFloat(Float)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSInteger">class MSInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSLongText">class MSLongText(MSText)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSMediumBlob">class MSMediumBlob(MSBinary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSMediumText">class MSMediumText(MSText)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSNumeric">class MSNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSSmallInteger">class MSSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSString">class MSString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSText">class MSText(TEXT)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTime">class MSTime(Time)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTimeStamp">class MSTimeStamp(TIMESTAMP)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTinyText">class MSTinyText(MSText)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLCompiler">class MySQLCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLDialect">class MySQLDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLExecutionContext">class MySQLExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLIdentifierPreparer">class MySQLIdentifierPreparer(ANSIIdentifierPreparer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLSchemaDropper">class MySQLSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MySQLSchemaGenerator">class MySQLSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_array">class array(object)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle">module sqlalchemy.databases.oracle</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.oracle_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.oracle_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleBinary">class OracleBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleBoolean">class OracleBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleChar">class OracleChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleCompiler">class OracleCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDateTime">class OracleDateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDefaultRunner">class OracleDefaultRunner(ANSIDefaultRunner)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDialect">class OracleDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleExecutionContext">class OracleExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleInteger">class OracleInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleNumeric">class OracleNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleRaw">class OracleRaw(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSchemaDropper">class OracleSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSchemaGenerator">class OracleSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSmallInteger">class OracleSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleString">class OracleString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleText">class OracleText(TEXT)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleTimestamp">class OracleTimestamp(DateTime)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql">module sqlalchemy.databases.mssql</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.mssql_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.mssql_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_AdoMSNVarchar">class AdoMSNVarchar(MSNVarchar)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSBinary">class MSBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSBoolean">class MSBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSChar">class MSChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDate">class MSDate(Date)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDateTime">class MSDateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSFloat">class MSFloat(Float)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSInteger">class MSInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNChar">class MSNChar(NCHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNVarchar">class MSNVarchar(MSString)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNumeric">class MSNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLCompiler">class MSSQLCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDefaultRunner">class MSSQLDefaultRunner(ANSIDefaultRunner)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect">class MSSQLDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_adodbapi">class MSSQLDialect_adodbapi(MSSQLDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_pymssql">class MSSQLDialect_pymssql(MSSQLDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_pyodbc">class MSSQLDialect_pyodbc(MSSQLDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLExecutionContext">class MSSQLExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLExecutionContext_pyodbc">class MSSQLExecutionContext_pyodbc(MSSQLExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLIdentifierPreparer">class MSSQLIdentifierPreparer(ANSIIdentifierPreparer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLSchemaDropper">class MSSQLSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLSchemaGenerator">class MSSQLSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSmallInteger">class MSSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSString">class MSString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSText">class MSText(TEXT)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSTinyInteger">class MSTinyInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird">module sqlalchemy.databases.firebird</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.firebird_modfunc">Module Functions</a></li>
        
            
    <ul>
        
        <li><A style="" href="#docstrings_sqlalchemy.databases.firebird_modfunc_descriptor">descriptor()</a></li>
        
            
    <ul>
    </ul>

    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBBinary">class FBBinary(Binary)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBBoolean">class FBBoolean(Boolean)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBChar">class FBChar(CHAR)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBCompiler">class FBCompiler(ANSICompiler)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDate">class FBDate(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDateTime">class FBDateTime(DateTime)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDefaultRunner">class FBDefaultRunner(ANSIDefaultRunner)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDialect">class FBDialect(ANSIDialect)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBExecutionContext">class FBExecutionContext(DefaultExecutionContext)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBIdentifierPreparer">class FBIdentifierPreparer(ANSIIdentifierPreparer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBInteger">class FBInteger(Integer)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBNumeric">class FBNumeric(Numeric)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSchemaDropper">class FBSchemaDropper(ANSISchemaDropper)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSchemaGenerator">class FBSchemaGenerator(ANSISchemaGenerator)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSmallInteger">class FBSmallInteger(SmallInteger)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBString">class FBString(String)</a></li>
        
            
    <ul>
    </ul>

        
        <li><A style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBText">class FBText(TEXT)</a></li>
        
            
    <ul>
    </ul>

    </ul>

    </ul>

    </ul>


	</div>




    
    
    <A name="tutorial"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">


            
            Next: <a href="#dbengine">Database Engines</a>
    </div>

        <h2>Tutorial</h2>
    </div>


        








    
    <A name="tutorial"></a>
    
    <div class="sectionL1">

    
    

<p>This tutorial provides a relatively simple walking tour through the basic concepts of SQLAlchemy.  You may wish to skip it and dive into the <a href="#metadata">main manual</a> which is more reference-oriented.  The examples in this tutorial comprise a fully working interactive Python session, and are guaranteed to be functioning courtesy of <a href='http://www.python.org/doc/lib/module-doctest.html'>doctest</a>.
</p>


    
    <A name="tutorial_installation"></a>
    
    <div class="sectionL2">

    <h3>Installation</h3>
    
    



    
    <A name="tutorial_installation_sqlalchemy"></a>
    
    <div class="sectionL3">

    <h3>Installing SQLAlchemy</h3>
    
    

<p>Installing SQLAlchemy from scratch is most easily achieved with <a href='http://peak.telecommunity.com/DevCenter/setuptools'>setuptools</a>.  (<a href='http://peak.telecommunity.com/DevCenter/EasyInstall#installation-instructions'>setuptools installation</a>). Just run this from the command-line:
</p>
<pre><code># easy_install SQLAlchemy
</code></pre><p>This command will download the latest version of SQLAlchemy from the <a href='http://cheeseshop.python.org/pypi/SQLAlchemy'>Python Cheese Shop</a> and install it to your system.
</p>
<p>Otherwise, you can install from the distribution using the <code>setup.py</code> script:
</p>
<pre><code># python setup.py install
</code></pre>


            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_installation_dbms"></a>
    
    <div class="sectionL3">

    <h3>Installing a Database API</h3>
    
    

<p>SQLAlchemy is designed to operate with a <a href='http://www.python.org/doc/peps/pep-0249/'>DBAPI</a> implementation built for a particular database, and includes support for the most popular databases. If you have one of the <a href="#dbengine_supported">supported DBAPI implementations</a>, you can proceed to the following section. Otherwise <a href='http://sqlite.org/'>SQLite</a> is an easy-to-use database to get started with, which works with plain files or in-memory databases.
</p>
<p>SQLite is included with Python 2.5 and greater.
</p>
<p>If you are working with Python 2.3 or 2.4, SQLite and the Python API for SQLite can be installed from the following packages:
</p>
<ul>
 <li>
     <a href='http://pysqlite.org/'>pysqlite</a> - Python interface for SQLite
 </li>

 <li>
     <a href='http://sqlite.org'>SQLite library</a>
 </li>
</ul>
<p>Note that the SQLite library download is not required with Windows, as the Windows Pysqlite library already includes it linked in.  Pysqlite and SQLite can also be installed on Linux or FreeBSD via pre-made <a href='http://initd.org/tracker/pysqlite/wiki/PysqlitePackages'>packages</a> or <a href='http://pysqlite.org/'>from sources</a>.
</p>



            <a href="#tutorial">back to section top</a>
    </div>




    </div>



    
    <A name="tutorial_gettingstarted"></a>
    
    <div class="sectionL2">

    <h3>Getting Started</h3>
    
    



    
    <A name="tutorial_gettingstarted_imports"></a>
    
    <div class="sectionL3">

    <h3>Imports</h3>
    
    

<p>To start connecting to databases and begin issuing queries, we want to import the base of SQLAlchemy's functionality, which is provided under the module name of <code>sqlalchemy</code>.  For the purposes of this tutorial, we will import its full list of symbols into our own local namespace.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*</span></pre>
    </div>
<p>Note that importing using the <code>*</code> operator pulls all the names from <code>sqlalchemy</code> into the local module namespace, which in a real application can produce name conflicts.  Therefore its recommended in practice to either import the individual symbols desired (i.e. <code>from sqlalchemy import Table, Column</code>) or to import under a distinct namespace (i.e. <code>import sqlalchemy as sa</code>).
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_gettingstarted_connecting"></a>
    
    <div class="sectionL3">

    <h3>Connecting to the Database</h3>
    
    

<p>After our imports, the next thing we need is a handle to the desired database, represented by an <code>Engine</code> object.  This object handles the business of managing connections and dealing with the specifics of a particular database.  Below, we will make a SQLite connection to a file-based database called "tutorial.db".
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///tutorial.db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Technically, the above statement did not make an actual connection to the sqlite database just yet.  As soon as we begine working with the engine, it will start creating connections.  In the case of SQLite, the <code>tutorial.db</code> file will actually be created at the moment it is first used, if the file does not exist already.
</p>
<p>For full information on creating database engines, including those for SQLite and others, see <a href="#dbengine">Database Engines</a>.
</p>



            <a href="#tutorial">back to section top</a>
    </div>




    </div>



    
    <A name="tutorial_twoinone"></a>
    
    <div class="sectionL2">

    <h3>SQLAlchemy is Two Libraries in One</h3>
    
    

<p>Now that the basics of installing SQLAlchemy and connecting to our database are established, we can start getting in to actually doing something.  But first, a little bit of explanation is required.
</p>
<p>A central concept of SQLAlchemy is that it actually contains two distinct areas of functionality, one of which builds upon the other.  One is a <strong>SQL Construction Language</strong> and the other is an <strong>Object Relational Mapper</strong> ("ORM" for short).  The SQL construction language allows you to construct objects called <code>ClauseElements</code> which represent SQL expressions.  These ClauseElements can then be executed against any database, where they are <strong>compiled</strong> into strings that are appropriate for the target database, and return an object called a <code>ResultProxy</code>, which is essentially a result set object that acts very much like a deluxe version of the dbapi <code>cursor</code> object.
</p>
<p>The Object Relational Mapper (ORM) is a set of tools completely distinct from the SQL Construction Language which serve the purpose of mapping Python object instances into database rows, providing a rich selection interface with which to retrieve instances from tables as well as a comprehensive solution to persisting changes on those instances back into the database.  When working with the ORM, its underlying workings as well as its public API make extensive use of the SQL Construction Language, however the general theory of operation is slightly different.  Instead of working with database rows directly, you work with your own user-defined classes and object instances.  Additionally, the method of issuing queries to the database is different, as the ORM handles the job of generating most of the SQL required, and instead requires more information about what kind of class instances you'd like to load and where you'd like to put them.
</p>
<p>Where SA is somewhat unique, more powerful, and slightly more complicated is that the two areas of functionality can be mixed together in many ways.  A key strategy to working with SA effectively is to have a solid awareness of these two distinct toolsets, and which concepts of SA belong to each - even some publications have confused the SQL Construction Language with the ORM.  The key difference between the two is that when you're working with cursor-like result sets its the SQL Construction Language, and when working with collections of your own class instances its the Object Relational Mapper.
</p>
<p>This tutorial will first focus on the basic configuration that is common to using both the SQL Construction Language as well as the ORM, which is to declare information about your database called <strong>table metadata</strong>.  This will be followed by some constructed SQL examples, and then into usage of the ORM utilizing the same data we established in the SQL construction examples.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql"></a>
    
    <div class="sectionL2">

    <h3>Working with Database Objects</h3>
    
    



    
    <A name="tutorial_schemasql_metadata"></a>
    
    <div class="sectionL3">

    <h3>Defining Metadata, Binding to Engines</h3>
    
    

<p>Configuring SQLAlchemy for your database consists of creating objects called <code>Tables</code>, each of which represent an actual table in the database.  A collection of <code>Table</code> objects resides in a <code>MetaData</code> object which is essentially a table collection.  We will create a handy form of <code>MetaData</code> that automatically connects to our <code>Engine</code> (connecting a schema object to an Engine is called <em>binding</em>):
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>An equivalent operation is to create the <code>BoundMetaData</code> object directly with an Engine URL, which calls the <code>create_engine</code> call for us:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///tutorial.db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Now, when we tell "metadata" about the tables in our database, we can issue CREATE statements for those tables, as well as execute SQL statements derived from them, without needing to open or close any connections; that will be all done automatically.
</p>
<p>Note that SQLALchemy fully supports the usage of explicit Connection objects for all SQL operations, which may be in conjunction with plain <code>MetaData</code> objects that are entirely unbound to any Engine, providing a more decoupled pattern that allows finer-grained control of connections than the "bound" approach this tutorial will present.  For the purposes of this tutorial, we will stick with "bound" objects, as it allows us to focus more on SA's general concepts, leaving explicit connection management as a more advanced topic.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql_table_creating"></a>
    
    <div class="sectionL3">

    <h3>Creating a Table</h3>
    
    

<p>With <code>metadata</code> as our established home for tables, lets make a Table for it:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>As you might have guessed, we have just defined a table named <code>users</code> which has three columns: <code>user_id</code> (which is a primary key column), <code>user_name</code> and <code>password</code>. Currently it is just an object that doesn't necessarily correspond to an existing table in our database.  To actually create the table, we use the <code>create()</code> method.  To make it interesting, we will have SQLAlchemy echo the SQL statements it sends to the database, by setting the <code>echo</code> flag on the <code>Engine</code> associated with our <code>BoundMetaData</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">CREATE TABLE users </span><span class="python_enclosure">(</span>
    <span class="python_name">user_id INTEGER NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">user_name VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">password VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">PRIMARY KEY </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
...</span></pre>
    </div>
<p>Alternatively, the <code>users</code> table might already exist (such as, if you're running examples from this tutorial for the second time), in which case you can just skip the <code>create()</code> method call. You can even skip defining the individual columns in the <code>users</code> table and ask SQLAlchemy to load its definition from the database:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">list</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_literal">'user_id'</span><span class="python_operator"></span></pre>
    </div>
<p>Loading a table's columns from the database is called <strong>reflection</strong>.  Documentation on table metadata, including reflection, is available in <a href="#metadata">Database Meta Data</a>.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql_inserting"></a>
    
    <div class="sectionL3">

    <h3>Inserting Rows</h3>
    
    

<p>Inserting is achieved via the <code>insert()</code> method, which defines a <em>clause object</em> (known as a <code>ClauseElement</code>) representing an INSERT statement:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">i </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">_Insert object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span><span class="python_literal">>>> </span><span class="python_comment"># the string form of the Insert object is a generic SQL representation</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">i</span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?, ?</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Since we created this insert statement object from the <code>users</code> table which is bound to our <code>Engine</code>, the statement itself is also bound to the <code>Engine</code>, and supports executing itself.  The <code>execute()</code> method of the clause object will <em>compile</em> the object into a string according to the underlying <em>dialect</em> of the Engine to which the statement is bound, and will then execute the resulting statement.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_comment"># insert a single row</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'secure'</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Mary'</span><span class="python_operator">, </span><span class="python_literal">'secure'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span>
<span class="python_literal">>>> </span><span class="python_comment"># insert multiple rows simultaneously</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">({</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Tom'</span><span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Fred'</span><span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Harry'</span><span class="python_enclosure">}) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[[</span><span class="python_literal">'Tom'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'Fred'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre>
    </div>
<p>Note that the <code>VALUES</code> clause of each <code>INSERT</code> statement was automatically adjusted to correspond to the parameters sent to the <code>execute()</code> method.  This is because the compilation step of a <code>ClauseElement</code> takes into account not just the constructed SQL object and the specifics of the type of database being used, but the execution parameters sent along as well.
</p>
<p>When constructing clause objects, SQLAlchemy will bind all literal values into bind parameters.  On the construction side, bind parameters are always treated as named parameters.  At compilation time, SQLAlchemy will convert them into their proper format, based on the paramstyle of the underlying DBAPI.  This works equally well for all named and positional bind parameter formats described in the DBAPI specification.
</p>
<p>Documentation on inserting: <a href="#sql_insert">Inserts</a>.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql_selecting"></a>
    
    <div class="sectionL3">

    <h3>Selecting</h3>
    
    

<p>Let's check that the data we have put into <code>users</code> table is actually there. The procedure is analogous to the insert example above, except you now call the <code>select()</code> method off the <code>users</code> table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator"></span></pre>
    </div>
<p>This time, we won't ignore the return value of <code>execute()</code>.  Its an instance of <code>ResultProxy</code>, which is a result-holding object that behaves very similarly to the <code>cursor</code> object one deals with directly with a database API:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span><span class="python_literal">>>> </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_operator">, </span><span class="python_literal">u'secure'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'Fred'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre>
    </div>
<p>Query criterion for the select is specified using Python expressions, using the <code>Column</code> objects in the <code>Table</code> as a base.  All expressions constructed from <code>Column</code> objects are themselves instances of <code>ClauseElements</code>, just like the <code>Select</code>, <code>Insert</code>, and <code>Table</code> objects themselves.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Pretty much the full range of standard SQL operations are supported as constructed Python expressions, including joins, ordering, grouping, functions, correlated subqueries, unions, etc. Documentation on selecting: <a href="#sql_select">Simple Select</a>.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql_working"></a>
    
    <div class="sectionL3">

    <h3>Working with Rows</h3>
    
    

<p>You can see that when we print out the rows returned by an execution result, it prints the rows as tuples.  These rows in fact support both the list and dictionary interfaces.  The dictionary interface allows the addressing of columns by string column name, or even the original <code>Column</code> object:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">keys</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">] </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Addressing the columns in a row based on the original <code>Column</code> object is especially handy, as it eliminates the need to work with literal column names altogether.
</p>
<p>Result sets also support iteration.  We'll show this with a slightly different form of <code>select</code> that allows you to specify the specific columns to be selected:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'Fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_schemasql_table_relationships"></a>
    
    <div class="sectionL3">

    <h3>Table Relationships</h3>
    
    

<p>Lets create a second table, <code>email_addresses</code>, which references the <code>users</code> table.  To define the relationship between the two tables, we will use the <code>ForeignKey</code> construct.  We will also issue the <code>CREATE</code> statement for the table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">email_addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'email_addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.user_id'</span><span class="python_enclosure">)))</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">CREATE TABLE email_addresses </span><span class="python_enclosure">(</span>
    <span class="python_name">address_id INTEGER NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">email_address VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">) </span><span class="python_name">NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">user_id INTEGER</span><span class="python_operator">,</span>
    <span class="python_name">PRIMARY KEY </span><span class="python_enclosure">(</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">FOREIGN KEY</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">REFERENCES users </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
...</span></pre>
    </div>
<p>Above, the <code>email_addresses</code> table is related to the <code>users</code> table via the <code>ForeignKey('users.user_id')</code>.  The <code>ForeignKey</code> constructor can take a <code>Column</code> object or a string representing the table and column name.  When using the string argument, the referenced table must exist within the same <code>MetaData</code> object; thats where it looks for the other table!
</p>
<p>Next, lets put a few rows in:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_enclosure">{</span><span class="python_literal">'email_address'</span><span class="python_operator">:</span><span class="python_literal">'tom@tom.com'</span><span class="python_operator">, </span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">2</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_enclosure">{</span><span class="python_literal">'email_address'</span><span class="python_operator">:</span><span class="python_literal">'mary@mary.com'</span><span class="python_operator">, </span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">1</span><span class="python_enclosure">}) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[[</span><span class="python_literal">'tom@tom.com'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'mary@mary.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre>
    </div>
<p>With two related tables, we can now construct a join amongst them using the <code>join</code> method:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">email_addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">
</span><span class="python_name">FROM users JOIN email_addresses ON users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id ORDER BY users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">row </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_operator">, </span><span class="python_literal">u'secure'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'mary@mary.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'tom@tom.com'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>join</code> method is also a standalone function in the <code>sqlalchemy</code> namespace.  The join condition is figured out from the foreign keys of the Table objects given.  The condition (also called the "ON clause") can be specified explicitly, such as in this example where we locate all users that used their email address as their password:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">email_addresses_table</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span>
<span class="python_operator">...     </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users JOIN email_addresses ON users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AND users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator"></span></pre>
    </div>



            <a href="#tutorial">back to section top</a>
    </div>




    </div>



    
    <A name="tutorial_orm"></a>
    
    <div class="sectionL2">

    <h3>Working with Object Mappers</h3>
    
    

<p>Now that we have a little bit of Table and SQL operations covered, lets look into SQLAlchemy's ORM (object relational mapper).  With the ORM, you associate Tables (and other <em>Selectable</em> units, like queries and table aliases) with Python classes, into units called <strong>Mappers</strong>.  Then you can execute queries that return lists of object instances, instead of result sets.  The object instances themselves are associated with an object called a <strong>Session</strong>, which automatically tracks changes on each object and supports a "save all at once" operation called a <strong>flush</strong>.
</p>
<p>To start, we will import the names necessary to use SQLAlchemy's ORM, again using <code>import *</code> for simplicities sake, even though we all know that in real life we should be importing individual names via "<code>from sqlalchemy.orm import symbol1, symbol2, ...</code>" or "<code>import sqlalchemy.orm as orm</code>":
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_operator">*</span></pre>
    </div>
<p>It should be noted that the above step is technically not needed when working with the 0.3 series of SQLAlchemy; all symbols from the <code>orm</code> package are also included in the <code>sqlalchemy</code> package.  However, a future release (most likely the 0.4 series) will make the separate <code>orm</code> import required in order to use the object relational mapper, so its a good practice for now.
</p>


    
    <A name="tutorial_orm_mapper"></a>
    
    <div class="sectionL3">

    <h3>Creating a Mapper</h3>
    
    

<p>A Mapper is usually created once per Python class, and at its core primarily means to say, "objects of this class are to be stored as rows in this table".  Lets create a class called <code>User</code>, which will represent a user object that is stored in our <code>users</code> table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...        </span><span class="python_keyword">return </span><span class="python_literal">"%s(%r,%r)" </span><span class="python_operator">% </span><span class="python_enclosure">(</span>
<span class="python_operator">...            </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The class is a new style class (i.e. it extends <code>object</code>) and does not require a constructor (although one may be provided if desired).  We just have one <code>__repr__</code> method on it which will display basic information about the User.  Note that the <code>__repr__</code> method references the instance variables <code>user_name</code> and <code>password</code> which otherwise aren't defined.  While we are free to explicitly define these attributes and treat them normally, this is optional; as SQLAlchemy's <code>Mapper</code> construct will manage them for us, since their names correspond to the names of columns in the <code>users</code> table.  Lets create a mapper, and observe that these attributes are now defined:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">) </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">Mapper object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span><span class="python_literal">>>> </span><span class="python_name">u1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">u1</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_name">None</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">u1</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_name">None</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>mapper</code> function returns a new instance of <code>Mapper</code>.  As it is the first Mapper we have created for the <code>User</code> class, it is known as the classes' <em>primary mapper</em>.  We generally don't need to hold onto the return value of the <code>mapper</code> function; SA can automatically locate this Mapper as needed when it deals with the <code>User</code> class.  <br></br>
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_session"></a>
    
    <div class="sectionL3">

    <h3>Obtaining a Session</h3>
    
    

<p>After you create a Mapper, all operations with that Mapper require the usage of an important object called a <code>Session</code>.  All objects loaded or saved by the Mapper must be <em>attached</em> to a <code>Session</code> object, which represents a kind of "workspace" of objects that are loaded into memory.  A particular object instance can only be attached to one <code>Session</code> at a time (but of course can be moved around or detached altogether).
</p>
<p>By default, you have to create a <code>Session</code> object explicitly before you can load or save objects.  Theres several ways to manage sessions, but the most straightforward is to just create one, which we will do by saying, <code>create_session()</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">Session object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre>
    </div>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_query"></a>
    
    <div class="sectionL3">

    <h3>The Query Object</h3>
    
    

<p>The Session has all kinds of methods on it to manage and inspect its collection of objects.  The Session also provides an easy interface which can be used to query the database, by giving you an instance to a <code>Query</code> object corresponding to a particular Python class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ? </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Harry'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre>
    </div>
<p>All querying for objects is performed via an instance of <code>Query</code>.  The various <code>select</code> methods on an instance of <code>Mapper</code> also use an underlying <code>Query</code> object to perform the operation.  A <code>Query</code> is always bound to a specific <code>Session</code>.
</p>
<p>Lets turn off the database echoing for a moment, and try out a few methods on <code>Query</code>.  Methods that end with the suffix <code>_by</code> primarily take keyword arguments which correspond to properties on the object.  Other methods take <code>ClauseElement</code> objects, which are constructed by using <code>Column</code> objects inside of Python expressions, in the same way as we did with our SQL select example in the previous section of this tutorial.  Using <code>ClauseElement</code> structures to query objects is more verbose but more flexible:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Fred'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Tom'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Mary'</span><span class="python_operator">,</span><span class="python_literal">u'secure'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Tom'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_number">4</span><span class="python_operator"></span></pre>
    </div>
<p>Notice that our <code>User</code> class has a special attribute <code>c</code> attached to it.  This 'c' represents the columns on the User's mapper's Table object.  Saying <code>User.c.user_name</code> is synonymous with saying <code>users_table.c.user_name</code>, recalling that <code>User</code> is the Python class and <code>users</code> is our <code>Table</code> object.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_changes"></a>
    
    <div class="sectionL3">

    <h3>Making Changes</h3>
    
    

<p>With a little experience in loading objects, lets see what its like to make changes.  First, lets create a new user "Ed".  We do this by just constructing the new object.  Then, we just add it to the session:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">ed </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'Ed'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'edspassword'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">ed</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>Lets also make a few changes on some of the objects in the database.  We will load them with our <code>Query</code> object, and then change some things.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">harry </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'marysnewpassword'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">harry</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'harrysnewpassword'</span><span class="python_operator"></span></pre>
    </div>
<p>At the moment, nothing has been saved to the database; all of our changes are in memory only.  What happens if some other part of the application also tries to load 'Mary' from the database and make some changes before we had a chance to save it ?  Assuming that the same <code>Session</code> is used, loading 'Mary' from the database a second time will issue a second query in order locate the primary key of 'Mary', but will <em>return the same object instance as the one already loaded</em>.  This behavior is due to an important property of the <code>Session</code> known as the <strong>identity map</strong>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mary2 </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_keyword">is </span><span class="python_name">mary2</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>With the identity map, a single <code>Session</code> can be relied upon to keep all loaded instances straight.
</p>
<p>As far as the issue of the same object being modified in two different Sessions, that's an issue of concurrency detection; SQLAlchemy does some basic concurrency checks when saving objects, with the option for a stronger check using version ids.  See <b>advdatamapping_arguments</b> for more details.
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_saving"></a>
    
    <div class="sectionL3">

    <h3>Saving</h3>
    
    

<p>With a new user "ed" and some changes made on "Mary" and "Harry", lets also mark "Fred" as deleted:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">fred </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">fred</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Then to send all of our changes to the database, we <code>flush()</code> the Session.  Lets turn echo back on to see this happen!:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">UPDATE users SET password</span><span class="python_operator">=? </span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'marysnewpassword'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">UPDATE users SET password</span><span class="python_operator">=? </span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'harrysnewpassword'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'edspassword'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">DELETE FROM users WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_number">3</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre>
    </div>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_relationships"></a>
    
    <div class="sectionL3">

    <h3>Relationships</h3>
    
    

<p>When our User object contains relationships to other kinds of information, such as a list of email addresses, we can indicate this by using a function when creating the <code>Mapper</code> called <code>relation()</code>.  While there is a lot you can do with relations, we'll cover a simple one here.  First, recall that our <code>users</code> table has a foreign key relationship to another table called <code>email_addresses</code>.  A single row in <code>email_addresses</code> has a column <code>user_id</code> that references a row in the <code>users</code> table; since many rows in the <code>email_addresses</code> table can reference a single row in <code>users</code>, this is called a <em>one to many</em> relationship.
</p>
<p>To illustrate this relationship, we will start with a new mapper configuration.  Since our <code>User</code> class has a mapper assigned to it, we want to discard it and start over again.  So we issue the <code>clear_mappers()</code> function first, which removes all mapping associations from classes:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">clear_mappers</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>When removing mappers, it is usually best to remove all mappings at the same time, since mappers usually have relationships to each other which will become invalid if only part of the mapper collection is removed.  In practice, a particular mapping setup will usually remain throughout the lifetime of an application.  Clearing out the mappers and making new ones is a practice that is generally limited to writing mapper unit tests and experimenting from the console.
</p>
<p>Next, we want to create a class/mapping that corresponds to the <code>email_addresses</code> table.  We will create a new class <code>Address</code> which represents a single row in the <code>email_addresses</code> table, and a corresponding <code>Mapper</code> which will associate the <code>Address</code> class with the <code>email_addresses</code> table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= </span><span class="python_name">email_address</span><span class="python_operator">
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_keyword">return </span><span class="python_literal">"%s(%r)" </span><span class="python_operator">% </span><span class="python_enclosure">(</span>
<span class="python_operator">...            </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)    </span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">email_addresses_table</span><span class="python_enclosure">) </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">Mapper object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre>
    </div>
<p>We then create a mapper for the <code>User</code> class which contains a relationship to the <code>Address</code> class using the <code>relation()</code> function:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{ </span>
<span class="python_operator">...    </span><span class="python_literal">'addresses'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">})</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">Mapper object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre>
    </div>
<p>The <code>relation()</code> function takes either a class or a Mapper as its first argument, and has many options to further control its behavior.  When this mapping relationship is used, each new <code>User</code> instance will contain an attribute called <code>addresses</code>.  SQLAlchemy will automatically determine that this relationship is a one-to-many relationship, and will subsequently create <code>addresses</code> as a list.  When a new <code>User</code> is created, this list will begin as empty.
</p>
<p>The order in which the mapping definitions for <code>User</code> and <code>Address</code> is created is <em>not significant</em>.  When the <code>mapper()</code> function is called, it creates an <em>uncompiled</em> mapping record corresponding to the given class/table combination.  When the mappers are first used, the entire collection of mappers created up until that point will be compiled, which involves the establishment of class instrumentation as well as the resolution of all mapping relationships.  <br></br>
</p>
<p>Lets try out this new mapping configuration, and see what we get for the email addresses already in the database.  Since we have made a new mapping configuration, its best that we clear out our <code>Session</code>, which is currently holding onto every <code>User</code> object we have already loaded:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>We can then treat the <code>addresses</code> attribute on each <code>User</code> object like a regular list:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ? </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">oid </span><span class="python_operator">
</span><span class="python_name">LIMIT </span><span class="python_number">1 </span><span class="python_name">OFFSET </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Mary'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">a </span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">SELECT email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AS email_addresses_user_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id AS email_addresses_address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address AS email_addresses_email_address </span><span class="python_operator">
</span><span class="python_name">FROM email_addresses </span><span class="python_operator">
</span><span class="python_name">WHERE</span><span class="python_operator"> ? = </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id ORDER BY email_addresses</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">u'mary@mary.com'</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre>
    </div>
<p>Adding to the list is just as easy.  New <code>Address</code> objects will be detected and saved when we <code>flush</code> the Session:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'mary2@gmail.com'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'mary2@gmail.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre>
    </div>
<p>Main documentation for using mappers:  <a href="#datamapping">Data Mapping</a>
</p>



            <a href="#tutorial">back to section top</a>
    </div>



    
    <A name="tutorial_orm_transactions"></a>
    
    <div class="sectionL3">

    <h3>Transactions</h3>
    
    

<p>You may have noticed from the example above that when we say <code>session.flush()</code>, SQLAlchemy indicates the names <code>BEGIN</code> and <code>COMMIT</code> to indicate a transaction with the database.  The <code>flush()</code> method, since it may execute many statements in a row, will automatically use a transaction in order to execute these instructions.  But what if we want to use <code>flush()</code> inside of a larger transaction?  This is performed via the <code>SessionTransaction</code> object, which we can establish using <code>session.create_transaction()</code>.  Below, we will perform a more complicated <code>SELECT</code> statement, make several changes to our collection of users and email addresess, and then create a new user with two email addresses, within the context of a transaction.  We will perform a <code>flush()</code> in the middle of it to write the changes we have so far, and then allow the remaining changes to be written when we finally <code>commit()</code> the transaction.  We enclose our operations within a <code>try/except</code> block to ensure that resources are properly freed:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">transaction </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">try</span><span class="python_operator">: 
...     </span><span class="python_enclosure">(</span><span class="python_name">ed</span><span class="python_operator">, </span><span class="python_name">harry</span><span class="python_operator">, </span><span class="python_name">mary</span><span class="python_enclosure">) </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
<span class="python_operator">...         </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'Harry'</span><span class="python_operator">, </span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span>
<span class="python_operator">...     </span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_keyword">del </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
...     </span><span class="python_name">harry</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'harry2@gmail.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_keyword">print </span><span class="python_literal">"***flushed the session***"</span><span class="python_operator">
...     </span><span class="python_name">fred </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred_again'</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'fred@fred.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'fredsnewemail@fred.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">fred</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">transaction</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
... </span><span class="python_keyword">except</span><span class="python_operator">:
...     </span><span class="python_name">transaction</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name IN </span><span class="python_enclosure">(</span><span class="python_operator">?, ?, ?</span><span class="python_enclosure">) </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'Harry'</span><span class="python_operator">, </span><span class="python_literal">'Mary'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">SELECT email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AS email_addresses_user_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id AS email_addresses_address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address AS email_addresses_email_address </span><span class="python_operator">
</span><span class="python_name">FROM email_addresses </span><span class="python_operator">
</span><span class="python_name">WHERE</span><span class="python_operator"> ? = </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id ORDER BY email_addresses</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">UPDATE email_addresses SET user_id</span><span class="python_operator">=? </span><span class="python_name">WHERE email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'harry2@gmail.com'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
***</span><span class="python_name">flushed the session</span><span class="python_operator">***    
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fred_again'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fred@fred.com'</span><span class="python_operator">, </span><span class="python_number">6</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fredsnewemail@fred.com'</span><span class="python_operator">, </span><span class="python_number">6</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre>
    </div>
<p>Main documentation:  <a href="#unitofwork">Session / Unit of Work</a>
</p>



            <a href="#tutorial">back to section top</a>
    </div>




    </div>



    
    <A name="tutorial_next"></a>
    
    <div class="sectionL2">

    <h3>Next Steps</h3>
    
    

<p>That covers a quick tour through the basic idea of SQLAlchemy, in its simplest form.  Beyond that, one should familiarize oneself with the basics of Sessions, the various patterns that can be used to define different kinds of Mappers and relations among them, the rudimentary SQL types that are available when constructing Tables, and the basics of Engines, SQL statements, and database Connections.
</p>




            <a href="#tutorial">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="dbengine"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#tutorial">Tutorial</a>

               |   
            Next: <a href="#metadata">Database Meta Data</a>
    </div>

        <h2>Database Engines</h2>
    </div>


        








    
    <A name="dbengine"></a>
    
    <div class="sectionL1">

    
    

<p>A database engine is a subclass of <code>sqlalchemy.sql.Engine</code>, and is the starting point for where SQLAlchemy provides a layer of abstraction on top of the various DBAPI2 database modules.  For all databases supported by SA, there is a specific "implementation" module, found in the <code>sqlalchemy.databases</code> package, that provides all the objects an <code>Engine</code> needs in order to perform its job.  A typical user of SQLAlchemy never needs to deal with these modules directly.  For many purposes, the only knowledge that's needed is how to create an Engine for a particular connection URL.  When dealing with direct execution of SQL statements, one would also be aware of Result, Connection, and Transaction objects.  The primary public facing objects are:
</p>
<ul>
 <li>
     <strong><a href="sqlalchemy_engine_url.html#docstrings_sqlalchemy.engine.url_URL">URL</a></strong> - represents the identifier for a particular database.  URL objects are usually created automatically based on a given connect string passed to the <code>create_engine()</code> function.
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Engine">Engine</a></strong> - Combines a connection-providing resource with implementation-provided objects that know how to generate, execute, and gather information about SQL statements.  It also provides the primary interface by which Connections are obtained, as well as a context for constructed SQL objects and schema constructs to "implicitly execute" themselves, which is an optional feature of SQLAlchemy.  <br></br>
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connection">Connection</a></strong> - represents a connection to the database.  The underlying connection object returned by a DBAPI's connect() method is referenced internally by the Connection object.  Connection provides methods that handle the execution of SQLAlchemy's own SQL constructs, as well as literal string-based statements.  <br></br>
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Transaction">Transaction</a></strong> - represents a transaction on a single Connection.  Includes <code>begin()</code>, <code>commit()</code> and <code>rollback()</code> methods that support basic "nestable" behavior, meaning an outermost transaction is maintained against multiple nested calls to begin/commit.
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ResultProxy">ResultProxy</a></strong> - Represents the results of an execution, and is most analgous to the cursor object in DBAPI.  It primarily allows iteration over result sets, but also provides an interface to information about inserts/updates/deletes, such as the count of rows affected, last inserted IDs, etc.
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_RowProxy">RowProxy</a></strong> -  Represents a single row returned by the fetchone() method on ResultProxy.
 </li>
</ul>
<p>Underneath the public-facing API of <code>Engine</code>, several components are provided by database implementations to provide the full behavior, including:
</p>
<ul>
 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Dialect">Dialect</a></strong> - this object is provided by database implementations to describe the behavior of a particular database.  It acts as a repository for metadata about a database's characteristics, and provides factory methods for other objects that deal with generating SQL strings and objects that handle some of the details of statement execution.  <br></br>
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ConnectionProvider">ConnectionProvider</a></strong> - this object knows how to return a DBAPI connection object.  It typically talks to a connection pool which maintains one or more connections in memory for quick re-use.
 </li>

 <li>
     <strong><a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ExecutionContext">ExecutionContext</a></strong> - this object is created for each execution of a single SQL statement, and tracks information about its execution such as primary keys inserted, the total count of rows affected, etc.  It also may implement any special logic that various DBAPI implementations may require before or after a statement execution.
 </li>

 <li>
     <strong><a href="sqlalchemy_sql.html#docstrings_sqlalchemy.sql_Compiled">Compiled</a></strong> - represents a "compiled" SQL expression object.  Includes a <code>compile()</code> method which receives SQL expression objects and assembles them into strings that are suitable for direct execution.  Also collects default bind parameters into a datastructure that will be converted at execution time into a dictionary or list, depending on the dialect's paramstyle.
 </li>
</ul>


    
    <A name="dbengine_supported"></a>
    
    <div class="sectionL2">

    <h3>Supported Databases</h3>
    
    

<p>Engines exist for SQLite, Postgres, MySQL, and Oracle, using the Pysqlite, Psycopg2 (Psycopg1 will work to a limited degree, but it is <strong>not supported</strong>), MySQLDB, and cx_Oracle modules.  There is also preliminary support for MS-SQL using pyodbc, adodbapi or pymssql, Firebird with kinterbasdb, and Informix with informixdb.   For each engine, a distinct Python module exists in the <code>sqlalchemy.databases</code> package, which provides implementations of some of the objects mentioned in the previous section.
</p>
<p>Downloads for each DBAPI at the time of this writing are as follows:
</p>
<ul>
 <li>
     Postgres:  <a href='http://www.initd.org/tracker/psycopg/wiki/PsycopgTwo'>psycopg2</a>
 </li>

 <li>
     SQLite:  <a href='http://initd.org/tracker/pysqlite'>pysqlite</a>
 </li>

 <li>
     MySQL:   <a href='http://sourceforge.net/projects/mysql-python'>MySQLDB</a>
 </li>

 <li>
     Oracle:  <a href='http://www.cxtools.net/default.aspx?nav=home'>cx_Oracle</a>
 </li>

 <li>
     MS-SQL:  <a href='http://adodbapi.sourceforge.net/'>adodbapi</a>  <a href='http://pymssql.sourceforge.net/'>pymssql</a>
 </li>

 <li>
     Firebird:  <a href='http://kinterbasdb.sourceforge.net/'>kinterbasdb</a>
 </li>

 <li>
     Informix:  <a href='http://informixdb.sourceforge.net/'>informixdb</a>
 </li>
</ul>
<p>The SQLAlchemy Wiki contains a page of database notes, describing whatever quirks and behaviors have been observed.  Its a good place to check for issues with specific databases.  <a href='http://www.sqlalchemy.org/trac/wiki/DatabaseNotes'>Database Notes</a>
</p>



            <a href="#dbengine">back to section top</a>
    </div>



    
    <A name="dbengine_establishing"></a>
    
    <div class="sectionL2">

    <h3>Establishing a Database Engine</h3>
    
    

<p>SQLAlchemy indicates the source of an Engine strictly via <a href='http://rfc.net/rfc1738.html'>RFC-1738</a> style URLs, combined with optional keyword arguments to specify options for the Engine.  The form of the URL is:
</p>
<pre><code>$ driver://username:password@host:port/database
</code></pre><p>Available drivernames are <code>sqlite</code>, <code>mysql</code>, <code>postgres</code>, <code>oracle</code>, <code>mssql</code>, and <code>firebird</code>.  For sqlite, the database name is the filename to connect to, or the special name ":memory:" which indicates an in-memory database.  The URL is typically sent as a string to the <code>create_engine()</code> function:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># postgres
</span><span class="python_name">pg_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost:5432/mydatabase'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># sqlite (note the four slashes for an absolute path)
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:////absolute/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///relative/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">)  </span><span class="python_comment"># in-memory database</span><span class="python_operator">
</span>
<span class="python_comment"># mysql
</span><span class="python_name">mysql_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle via TNS name
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@dsn'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle will feed host/port/SID into cx_oracle.makedsn
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@127.0.0.1:1521/sidname'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>Engine</code> will ask the connection pool for a connection when a SQL statement is executed.  The default connection pool, <code>QueuePool</code> as well as the default SQLite connection pool <code>SingletonThreadPool</code>, will open connections to the database on an as-needed basis.  As concurrent statements are executed, <code>QueuePool</code> will grow its pool of connections to a default size of five, and will allow a default "overflow" of ten.   Since the <code>Engine</code> is essentially "home base" for the connection pool, it follows that you should keep a single <code>Engine</code> per database established within an application, rather than creating a new one for each connection.
</p>


    
    <A name="dbengine_establishing_custom"></a>
    
    <div class="sectionL3">

    <h3>Custom DBAPI keyword arguments</h3>
    
    

<p>Custom arguments can be passed to the underlying DBAPI in three ways.  String-based arguments can be passed directly from the URL string as query arguments:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test?argument1=foo&argument2=bar'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>If SQLAlchemy's database connector is aware of a particular query argument, it may convert its type from string to its proper type.
</p>
<p><code>create_engine</code> also takes an argument <code>connect_args</code> which is an additional dictionary that will be passed to <code>connect()</code>.  This can be used when arguments of a type other than string are required, and SQLAlchemy's database connector has no type conversion logic present for that parameter:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test'</span><span class="python_operator">, </span><span class="python_name">connect_args </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'argument1'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_operator">, </span><span class="python_literal">'argument2'</span><span class="python_operator">:</span><span class="python_literal">'bar'</span><span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>The most customizable connection method of all is to pass a <code>creator</code> argument, which specifies a callable that returns a DBAPI connection:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">def </span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'localhost'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">connect</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#dbengine">back to section top</a>
    </div>




    </div>



    
    <A name="dbengine_options"></a>
    
    <div class="sectionL2">

    <h3>Database Engine Options</h3>
    
    

<p>Keyword options can also be specified to <code>create_engine()</code>, following the string URL as follows:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://...'</span><span class="python_operator">, </span><span class="python_name">encoding</span><span class="python_operator">=</span><span class="python_literal">'latin1'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>A list of all standard options, as well as several that are used by particular database dialects, is as follows:
</p>
<ul>
 <li>
     <strong>connect_args</strong> - a dictionary of options which will be passed directly to the DBAPI's <code>connect()</code> method as additional keyword arguments.
 </li>

 <li>
     <strong>convert_unicode=False</strong> - if set to True, all String/character based types will convert Unicode values to raw byte values going into the database, and all raw byte values to Python Unicode coming out in result sets.  This is an engine-wide method to provide unicode conversion across the board.  For unicode conversion on a column-by-column level, use the <code>Unicode</code> column type instead, described in <a href="#types">The Types System</a>.
 </li>

 <li>
     <strong>creator</strong> - a callable which returns a DBAPI connection.  This creation function will be passed to the underlying connection pool and will be used to create all new database connections.  Usage of this function causes connection parameters specified in the URL argument to be bypassed.
 </li>

 <li>
     <strong>echo=False</strong> - if True, the Engine will log all statements as well as a repr() of their parameter lists to the engines logger, which defaults to sys.stdout.  The <code>echo</code> attribute of <code>Engine</code> can be modified at any time to turn logging on and off.  If set to the string <code>&quot;debug&quot;</code>, result rows will be printed to the standard output as well.  This flag ultimately controls a Python logger; see <a href="#dbengine_logging">Configuring Logging</a> for information on how to configure logging directly.
 </li>

 <li>
     <strong>echo_pool=False</strong> - if True, the connection pool will log all checkouts/checkins to the logging stream, which defaults to sys.stdout.  This flag ultimately controls a Python logger; see <a href="#dbengine_logging">Configuring Logging</a> for information on how to configure logging directly.
 </li>

 <li>
     <strong>encoding='utf-8'</strong> - the encoding to use for all Unicode translations, both by engine-wide unicode conversion as well as the <code>Unicode</code> type object.
 </li>

 <li>
     <strong>module=None</strong> - used by database implementations which support multiple DBAPI modules, this is a reference to a DBAPI2 module to be used instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 2 cannot be found.  For Oracle, its cx_Oracle.
 </li>

 <li>
     <strong>pool=None</strong> - an already-constructed instance of <code>sqlalchemy.pool.Pool</code>, such as a <code>QueuePool</code> instance.  If non-None, this pool will be used directly as the underlying connection pool for the engine, bypassing whatever connection parameters are present in the URL argument.  For information on constructing connection pools manually, see <a href="#pooling">Connection Pooling</a>.
 </li>

 <li>
     <strong>poolclass=None</strong> - a <code>sqlalchemy.pool.Pool</code> subclass, which will be used to create a connection pool instance using the connection parameters given in the URL.  Note this differs from <code>pool</code> in that you don't actually instantiate the pool in this case, you just indicate what type of pool to be used.
 </li>

 <li>
     <strong>max_overflow=10</strong> - the number of connections to allow in connection pool "overflow", that is connections that can be opened above and beyond the pool_size setting, which defaults to five.  this is only used with <code>QueuePool</code>.
 </li>

 <li>
     <strong>pool_size=5</strong> - the number of connections to keep open inside the connection pool.  This used with <code>QueuePool</code> as well as <code>SingletonThreadPool</code>.
 </li>

 <li>
     <strong>pool_recycle=-1</strong> - this setting causes the pool to recycle connections after the given number of seconds has passed.  It defaults to -1, or no timeout.  For example, setting to 3600 means connections will be recycled after one hour.  Note that MySQL in particular will disconnect automatically if no activity is detected on a connection for eight hours (although this is configurable with the MySQLDB connection itself and the  server configuration as well).
 </li>

 <li>
     <strong>pool_timeout=30</strong> - number of seconds to wait before giving up on getting a connection from the pool.  This is only used with <code>QueuePool</code>.
 </li>

 <li>
     <strong>strategy='plain'</strong> - the Strategy argument is used to select alternate implementations of the underlying Engine object, which coordinates operations between dialects, compilers, connections, and so on.  Currently, the only alternate strategy besides the default value of "plain" is the "threadlocal" strategy, which selects the usage of the <code>TLEngine</code> class that provides a modified connection scope for implicit executions.  Implicit execution as well as further detail on this setting are described in <a href="#dbengine_implicit">Implicit Execution</a>.
 </li>

 <li>
     <strong>threaded=True</strong> - used by cx_Oracle; sets the <code>threaded</code> parameter of the connection indicating thread-safe usage.  cx_Oracle docs indicate setting this flag to <code>False</code> will speed performance by 10-15%.  While this defaults to <code>False</code> in cx_Oracle, SQLAlchemy defaults it to <code>True</code>, preferring stability over early optimization.
 </li>

 <li>
     <strong>use_ansi=True</strong> - used only by Oracle;  when False, the Oracle driver attempts to support a particular "quirk" of Oracle versions 8 and previous, that the LEFT OUTER JOIN SQL syntax is not supported, and the "Oracle join" syntax of using <code>&amp;lt;column1&amp;gt;(+)=&amp;lt;column2&amp;gt;</code> must be used in order to achieve a LEFT OUTER JOIN.
 </li>

 <li>
     <strong>use_oids=False</strong> - used only by Postgres, will enable the column name "oid" as the object ID column, which is also used for the default sort order of tables.  Postgres as of 8.1 has object IDs disabled by default.
 </li>
</ul>



            <a href="#dbengine">back to section top</a>
    </div>



    
    <A name="dbengine_logging"></a>
    
    <div class="sectionL2">

    <h3>Configuring Logging</h3>
    
    

<p>As of the 0.3 series of SQLAlchemy, Python's standard <a href='http://www.python.org/doc/lib/module-logging.html'>logging</a> module is used to implement informational and debug log output.  This allows SQLAlchemy's logging to integrate in a standard way with other applications and libraries.  The <code>echo</code> and <code>echo_pool</code> flags that are present on <code>create_engine()</code>, as well as the <code>echo_uow</code> flag used on <code>Session</code>, all interact with regular loggers.
</p>
<p>This section assumes familiarity with the above linked logging module.  All logging performed by SQLAlchemy exists underneath the <code>sqlalchemy</code> namespace, as used by <code>logging.getLogger('sqlalchemy')</code>.  When logging has been configured (i.e. such as via <code>logging.basicConfig()</code>), the general namespace of SA loggers that can be turned on is as follows:
</p>
<ul>
 <li>
     <code>sqlalchemy.engine</code> - controls SQL echoing.  set to <code>logging.INFO</code> for SQL query output, <code>logging.DEBUG</code> for query + result set output.
 </li>

 <li>
     <code>sqlalchemy.pool</code> - controls connection pool logging.  set to <code>logging.INFO</code> or lower to log connection pool checkouts/checkins.
 </li>

 <li>
     <code>sqlalchemy.orm</code> - controls logging of various ORM functions.  set to <code>logging.INFO</code> for configurational logging as well as unit of work dumps, <code>logging.DEBUG</code> for extensive logging during query and flush() operations.  Subcategories of <code>sqlalchemy.orm</code> include:<ul>
 <li>
     <code>sqlalchemy.orm.attributes</code> - logs certain instrumented attribute operations, such as triggered callables
 </li>

 <li>
     <code>sqlalchemy.orm.mapper</code> - logs Mapper configuration and operations
 </li>

 <li>
     <code>sqlalchemy.orm.unitofwork</code> - logs flush() operations, including dependency sort graphs and other operations
 </li>

 <li>
     <code>sqlalchemy.orm.strategies</code> - logs relation loader operations (i.e. lazy and eager loads)
 </li>

 <li>
     <code>sqlalchemy.orm.sync</code> - logs synchronization of attributes from parent to child instances during a flush()
 </li>
</ul>

 </li>
</ul>
<p>For example, to log SQL queries as well as unit of work debugging:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">logging</span><span class="python_operator">
</span>
<span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">basicConfig</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">getLogger</span><span class="python_enclosure">(</span><span class="python_literal">'sqlalchemy.engine'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">setLevel</span><span class="python_enclosure">(</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">INFO</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">getLogger</span><span class="python_enclosure">(</span><span class="python_literal">'sqlalchemy.orm.unitofwork'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">setLevel</span><span class="python_enclosure">(</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">DEBUG</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>By default, the log level is set to <code>logging.ERROR</code> within the entire <code>sqlalchemy</code> namespace so that no log operations occur, even within an application that has logging enabled otherwise.
</p>
<p>The <code>echo</code> flags present as keyword arguments to <code>create_engine()</code> and others as well as the <code>echo</code> property on <code>Engine</code>, when set to <code>True</code>, will first attempt to ensure that logging is enabled.  Unfortunately, the <code>logging</code> module provides no way of determining if output has already been configured (note we are referring to if a logging configuration has been set up, not just that the logging level is set).  For this reason, any <code>echo=True</code> flags will result in a call to <code>logging.basicConfig()</code> using sys.stdout as the destination.  It also sets up a default format using the level name, timestamp, and logger name.  Note that this configuration has the affect of being configured <strong>in addition</strong> to any existing logger configurations.  Therefore, <strong>when using Python logging, ensure all echo flags are set to False at all times</strong>, to avoid getting duplicate log lines.  <br></br>
</p>



            <a href="#dbengine">back to section top</a>
    </div>



    
    <A name="dbengine_connections"></a>
    
    <div class="sectionL2">

    <h3>Using Connections</h3>
    
    

<p>In this section we describe the SQL execution interface available from an <code>Engine</code> instance.  Note that when using the Object Relational Mapper (ORM) as well as when dealing with with "bound" metadata objects, SQLAlchemy deals with the Engine and Connections for you and you generally don't need to know much about it; in those cases, you can skip this section and go to <a href="#metadata">Database Meta Data</a>.  "Bound" metadata is described in <a href="#metadata_tables_binding">Binding MetaData to an Engine</a>.
</p>
<p>The Engine provides a <code>connect()</code> method which returns a <code>Connection</code> object.  <code>Connection</code> is a <em>proxy</em> object which maintains a reference to a DBAPI connection instance.  This object provides methods by which literal SQL text as well as SQL clause constructs can be compiled and executed.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from mytable where col1=:col1"</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>close</code> method on <code>Connection</code> does not actually remove the underlying connection to the database, but rather indicates that the underlying resources can be returned to the connection pool.  When using the <code>connect()</code> method, the DBAPI connection referenced by the <code>Connection</code> object is not referenced anywhere else. 
</p>
<p>In both execution styles above, the <code>Connection</code> object will also automatically return its resources to the connection pool when the object is garbage collected, i.e. its <code>__del__()</code> method is called.  When using the standard C implementation of Python, this method is usually called immediately as soon as the object is dereferenced.  With other Python implementations such as Jython, this is not so guaranteed.  <br></br>
</p>
<p>The execute method on <code>Engine</code> and <code>Connection</code> can also receive SQL clause constructs as well, which are described in <a href="#sql">Constructing SQL Queries via Python Expressions</a>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">==</span><span class="python_number">5</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>Both <code>Connection</code> and <code>Engine</code> fulfill an interface known as <code>Connectable</code> which specifies common functionality between the two objects, such as getting a <code>Connection</code> and executing queries.  Therefore, most SQLAlchemy functions which take an <code>Engine</code> as a parameter with which to execute SQL will also accept a <code>Connection</code> (and the name of the argument is typically called <code>connectable</code>):
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Specify Engine or Connection</div>
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># specify some Table metadata
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'sometable'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># create the table with the Engine
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># drop the table with a Connection off the Engine
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Connection facts:
</p>
<ul>
 <li>
     the Connection object is <strong>not threadsafe</strong>.  While a Connection can be shared among threads using properly synchronized access, this is also not recommended as many DBAPIs have issues with, if not outright disallow, sharing of connection state between threads.
 </li>

 <li>
     The Connection object represents a single dbapi connection checked out from the connection pool.  In this state, the connection pool has no affect upon the connection, including its expiration or timeout state.  For the connection pool to properly manage connections, <strong>connections should be returned to the connection pool (i.e. Connection.close()) whenever the connection is not in use</strong>.  If your application has a need for management of multiple connections or is otherwise long running (this includes all web applications, threaded or not), don't hold a single connection open at the module level.
 </li>
</ul>



            <a href="#dbengine">back to section top</a>
    </div>



    
    <A name="dbengine_transactions"></a>
    
    <div class="sectionL2">

    <h3>Transactions</h3>
    
    

<p>The <code>Connection</code> object provides a <code>begin()</code> method which returns a <code>Transaction</code> object.  This object is usually used within a try/except clause so that it is guaranteed to <code>rollback()</code> or <code>commit()</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'this is some data'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>Transaction</code> object also handles "nested" behavior by keeping track of the outermost begin/commit pair.  In this example, two functions both issue a transaction on a Connection, but only the outermost Transaction object actually takes effect when it is committed.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># method_a starts a transaction and calls method_b
</span><span class="python_keyword">def </span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is committed here</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># method_b also starts a transaction
</span><span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction - this runs in the context of method_a's transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('bat', 'lala')"</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'bat'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'lala'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is not committed yet</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># open a Connection and call method_a
</span><span class="python_operator"></span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()                </span><span class="python_operator">
</span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>Above, <code>method_a</code> is called first, which calls <code>connection.begin()</code>.  Then it calls <code>method_b</code>. When <code>method_b</code> calls <code>connection.begin()</code>, it just increments a counter that is decremented when it calls <code>commit()</code>.  If either <code>method_a</code> or <code>method_b</code> calls <code>rollback()</code>, the whole transaction is rolled back.  The transaction is not committed until <code>method_a</code> calls the <code>commit()</code> method.
</p>
<p>Note that SQLAlchemy's Object Relational Mapper also provides a way to control transaction scope at a higher level; this is described in <a href="#unitofwork_transaction">SessionTransaction</a>.
</p>
<p>Transaction Facts:
</p>
<ul>
 <li>
     the Transaction object, just like its parent Connection, is <strong>not threadsafe</strong>.
 </li>
</ul>



            <a href="#dbengine">back to section top</a>
    </div>



    
    <A name="dbengine_implicit"></a>
    
    <div class="sectionL2">

    <h3>Implicit Execution</h3>
    
    

<p><strong>Implicit execution</strong> refers to the execution of SQL without the explicit usage of a <code>Connection</code> object.  This occurs when you call the <code>execute()</code> method off of an <code>Engine</code> object or off of a SQL expression or table that is associated with "bound" metadata.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Implicit Execution Using Engine</div>
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from mytable where col1=:col1"</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>Using "bound" metadata:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Implicit Execution Using Engine-Bound SQL Construct</div>
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)))</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'some record'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Notice in the above two examples, no <code>connect()</code> method is ever called nor do we ever see a <code>Connection</code> anywhere; the <code>Connection</code> is created for you automatically via the <code>execute()</code> method, and a handle to the execution's cursor remains open in the returned result set.  When the result set is closed via the <code>close()</code> method, or if the result set object falls out of scope and is garbage collected, the underlying cursor is closed, the <code>Connection</code> is discarded and the underlying DBAPI connection is returned to the connection pool.
</p>
<p>The purpose of the "implicit" connection is strictly one of convenience; while in SQLAlchemy 0.1 it was the only style of operation, it is now optional.
</p>


    
    <A name="dbengine_implicit_strategies"></a>
    
    <div class="sectionL3">

    <h3>Implicit Execution Strategies</h3>
    
    

<p>The internal behavior of engine during implicit execution can be affected by the <code>strategy</code> keyword argument to <code>create_engine()</code>.  Generally this setting can be left at its default value of <code>plain</code>.  However, for the advanced user, the <code>threadlocal</code> option can provide the service of managing connections against the current thread in which they were pulled from the connection pool, where the same underlying DBAPI connection as well as a single database-level transaction can then be shared by many operations without explicitly passing a <code>Connection</code> or <code>Transaction</code> object around.  It also may reduce the number of connections checked out from the connection pool at a given time.
</p>
<p>Note that this setting does <strong>not</strong> affect the fact that <strong>Connection and Transaction objects are not threadsafe.</strong>  The "threadlocal" strategy affects the selection of DBAPI connections which are pulled from the connection pool when a <code>Connection</code> object is created, but does not synchronize method access to the <code>Connection</code> or <code>Transaction</code> instances themselves, which are only proxy objects.  It is instead intended that many <code>Connection</code> instances would share access to a single "connection" object that is referenced in relation to the current thread.
</p>
<p>When <code>strategy</code> is set to <code>plain</code>, each implicit execution requests a unique connection from the connection pool, which is returned to the pool when the resulting <code>ResultProxy</code> falls out of scope (i.e. <code>__del__()</code> is called) or its <code>close()</code> method is called.  If a second implicit execution occurs while the <code>ResultProxy</code> from the previous execution is still open, then a second connection is pulled from the pool.
</p>
<p>When <code>strategy</code> is set to <code>threadlocal</code>, the <code>Engine</code> still checks out a connection which is closeable in the same manner via the <code>ResultProxy</code>, except the connection it checks out will be the <strong>same</strong> connection as one which is already checked out, assuming the operation is in the same thread.  When all <code>ResultProxy</code> objects are closed in a particular thread, the connection is returned to the pool normally.
</p>
<p>An additional feature of the <code>threadlocal</code> selection is that <code>Transaction</code> objects can be managed implicitly as well, by calling the <code>begin()</code>,<code>commit()</code> and <code>rollback()</code> methods off of the <code>Engine</code>, or by using <code>Transaction</code> objects from the thread-local connection.
</p>
<p>It is crucial to note that the <code>plain</code> and <code>threadlocal</code> contexts <strong>do not impact the connect() method on the Engine.</strong>  <code>connect()</code> always returns a unique connection.  Implicit connections use a different method off of <code>Engine</code> for their operations called <code>contextual_connect()</code>.
</p>
<p>By default, every call to <code>execute</code> pulls a dedicated DBAPI connection from the connection pool:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Plain Strategy</div>
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'plain'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references a *second* DBAPI connection resource.
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># release connection 1
</span><span class="python_operator"></span><span class="python_name">r1</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># release connection 2
</span><span class="python_name">r2</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>Using the "threadlocal" strategy, all calls to <code>execute</code> within the same thread will be guaranteed to use the same underlying DBAPI connection, which is only returned to the connection pool when all <code>ResultProxy</code> instances have been closed.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Threadlocal Strategy</div>
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references the *same* resource as r1
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># dereference r1.  the connection is still held by r2.
</span><span class="python_operator"></span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
</span>
<span class="python_comment"># dereference r2.  with no more references to the underlying connection resources, they
# are returned to the pool.
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator"></span></pre>
    </div>
<p>To get at the actual <code>Connection</code> object which is used by implicit executions, call the <code>contextual_connect()</code> method on <code>Engine</code>:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Contextual Connection</div>
        <pre><span class="python_comment"># threadlocal strategy
</span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">conn1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">conn2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">conn1</span><span class="python_operator">.</span><span class="python_name">connection </span><span class="python_keyword">is </span><span class="python_name">conn2</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>When the <code>plain</code> strategy is used, the <code>contextual_connect()</code> method is synonymous with the <code>connect()</code> method; both return a distinct connection from the pool.
</p>
<p>One programming pattern that the <code>threadlocal</code> strategy supports is transparent connection and transaction sharing.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">threadlocal connection sharing</div>
        <pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_comment"># do stuff with conn
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_comment"># do stuff
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>In the above example, the program calls three functions <code>dosomethingimplicit()</code>, <code>dosomethingelse()</code> and <code>dosomethingtransactional()</code>.  In all three functions, either implicit execution is used, <strong>or</strong> an explicit <code>Connection</code> is used via the <code>contextual_connect()</code> method.  This indicates that they all will share the same underlying dbapi connection as well as the same parent <code>Transaction</code> instance, which is created in the main body of the program via the call to <code>db.create_transaction()</code>.  So while there are several calls that return "new" <code>Transaction</code> or <code>Connection</code> objects, in reality only one "real" connection is ever used, and there is only one transaction (i.e. one begin/commit pair) executed.
</p>




            <a href="#dbengine">back to section top</a>
    </div>




    </div>




    </div>


</html>
    
    
    <A name="metadata"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#dbengine">Database Engines</a>

               |   
            Next: <a href="#sql">Constructing SQL Queries via Python Expressions</a>
    </div>

        <h2>Database Meta Data</h2>
    </div>


        








    
    <A name="metadata"></a>
    
    <div class="sectionL1">

    
    



    
    <A name="metadata_tables"></a>
    
    <div class="sectionL2">

    <h3>Describing Databases with MetaData</h3>
    
    

<p>The core of SQLAlchemy's query and object mapping operations is database metadata, which are Python objects that describe tables and other schema-level objects.  Metadata objects can be created by explicitly naming the various components and their properties, using the Table, Column, ForeignKey, Index, and Sequence objects imported from <code>sqlalchemy.schema</code>.  There is also support for <em>reflection</em>, which means you only specify the <em>name</em> of the entities and they are recreated from the database automatically.
</p>
<p>A collection of metadata entities is stored in an object aptly named <code>MetaData</code>.  This object takes an optional <code>name</code> parameter:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'my metadata'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Then to construct a Table, use the <code>Table</code> class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The specific datatypes for each Column, such as Integer, String, etc. are described in <a href="#types">The Types System</a>, and exist within the module <code>sqlalchemy.types</code> as well as the global <code>sqlalchemy</code> namespace.
</p>
<p>Foreign keys are most easily specified by the <code>ForeignKey</code> object within a <code>Column</code> object.  For a composite foreign key, i.e. a foreign key that contains multiple columns referencing multiple columns to a composite primary key, an explicit syntax is provided which allows the correct table CREATE statements to be generated:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># a table with a composite primary key
</span><span class="python_name">invoices </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoices'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'description'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table with a composite foreign key referencing the parent table
</span><span class="python_name">invoice_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_items'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'ref_num'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'invoices.invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'invoices.ref_num'</span><span class="python_enclosure">])</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Above, the <code>invoice_items</code> table will have <code>ForeignKey</code> objects automatically added to the <code>invoice_id</code> and <code>ref_num</code> <code>Column</code> objects as a result of the additional <code>ForeignKeyConstraint</code> object.
</p>
<p>The <code>MetaData</code> object supports some handy methods, such as getting a list of Tables in the order (or reverse) of their dependency:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">for </span><span class="python_name">t </span><span class="python_keyword">in </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">table_iterator</span><span class="python_enclosure">(</span><span class="python_name">reverse</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">:
...    </span><span class="python_keyword">print </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">
</span><span class="python_name">user_prefs</span><span class="python_operator"></span></pre>
    </div>
<p>And <code>Table</code> provides an interface to the table's properties as well as that of its columns:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># access the column "EMPLOYEE_ID":
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># or just
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># via string
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">[</span><span class="python_literal">'employee_id'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># iterate through all columns
</span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's primary key columns
</span><span class="python_keyword">for </span><span class="python_name">primary_key </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's foreign key objects:
</span><span class="python_keyword">for </span><span class="python_name">fkey </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">foreign_keys</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># access the table's MetaData:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">
</span>
<span class="python_comment"># access the table's Engine, if its MetaData is bound:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's name, type, nullable, primary key, foreign key
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">nullable</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">
</span>
<span class="python_comment"># get the "key" of a column, which defaults to its name, but can 
# be any user-defined string:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">key</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's table:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">table </span><span class="python_keyword">is </span><span class="python_name">employees</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">True</span><span class="python_operator">
</span>
<span class="python_comment"># get the table related by a foreign key
</span><span class="python_name">fcolumn </span><span class="python_operator">= </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="metadata_tables_binding"></a>
    
    <div class="sectionL3">

    <h3>Binding MetaData to an Engine</h3>
    
    

<p>A MetaData object can be associated with one or more Engine instances.  This allows the MetaData and the elements within it to perform operations automatically, using the connection resources of that Engine.  This includes being able to "reflect" the columns of tables, as well as to perform create and drop operations without needing to pass an <code>Engine</code> or <code>Connection</code> around.  It also allows SQL constructs to be created which know how to execute themselves (called "implicit execution").
</p>
<p>To bind <code>MetaData</code> to a single <code>Engine</code>, use <code>BoundMetaData</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create BoundMetaData from an Engine
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the Engine and MetaData in one step
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db/'</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Another form of <code>MetaData</code> exits which can connect to an engine within the current thread (or "on a per-thread basis"), allowing other threads to be connected to different engines simultaneously:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">DynamicMetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># In thread 1, connect to an existing Engine    
</span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># Meanwhile in thread 2, create a new Engine and connect
</span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_literal">'mysq://user@host/dsn'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p><code>DynamicMetaData</code> is intended for applications that need to use the same set of <code>Tables</code> for many different database connections in the same process, such as a CherryPy web application which handles multiple application instances in one process.
</p>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_tables_using"></a>
    
    <div class="sectionL3">

    <h3>Using the global Metadata object</h3>
    
    

<p>Some users prefer to create <code>Table</code> objects without specifying a <code>MetaData</code> object, having Tables scoped on an application-wide basis.  For them the <code>default_metadata</code> object and the <code>global_connect()</code> function is supplied.  <code>default_metadata</code> is simply an instance of <code>DynamicMetaData</code> that exists within the <code>sqlalchemy</code> namespace, and <code>global_connect()</code> is a synonym for <code>default_metadata.connect()</code>.  Defining a <code>Table</code> that has no <code>MetaData</code> argument will automatically use this default metadata as follows:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># a Table with just a name and its Columns
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># connect all the "anonymous" tables to a postgres uri in the current thread    
</span><span class="python_name">global_connect</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://foo:bar@lala/test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create all tables in the default metadata
</span><span class="python_name">default_metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the table is bound
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'some value'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_tables_reflecting"></a>
    
    <div class="sectionL3">

    <h3>Reflecting Tables</h3>
    
    

<p>Once you have a <code>BoundMetaData</code> or a connected <code>DynamicMetaData</code>, you can create <code>Table</code> objects without specifying their columns, just their names, using <code>autoload=True</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">messages </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'messages'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">messages</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'message_id'</span><span class="python_operator">, </span><span class="python_literal">'message_name'</span><span class="python_operator">, </span><span class="python_literal">'date'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>At the moment the Table is constructed, it will query the database for the columns and constraints of the <code>messages</code> table.
</p>
<p>Note that if a reflected table has a foreign key referencing another table, then the metadata for the related table will be loaded as well, even if it has not been defined by the application:              <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">shopping_cart_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_cart_items'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">shopping_carts</span><span class="python_operator"></span></pre>
    </div>
<p>To get direct access to 'shopping_carts', simply instantiate it via the Table constructor.  You'll get the same instance of the shopping cart Table as the one that is attached to shopping_cart_items:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">shopping_carts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_carts'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">shopping_carts </span><span class="python_keyword">is </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>This works because when the Table constructor is called for a particular name and <code>MetaData</code> object, if the table has already been created then the instance returned will be the same as the original.  This is a <b>singleton</b> constructor:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">news_articles </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'url'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">250</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">othertable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">othertable </span><span class="python_keyword">is </span><span class="python_name">news_articles</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>

    
    <A name="metadata_tables_reflecting_overriding"></a>
    
    <div class="sectionL4">

    <h3>Overriding Reflected Columns</h3>
    
    
<p>Individual columns can be overridden with explicit values when reflecting tables; this is handy for specifying custom datatypes, constraints such as primary keys that may not be configured within the database, etc.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,   </span><span class="python_comment"># override reflected 'id' to have primary key</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mydata'</span><span class="python_operator">, </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,    </span><span class="python_comment"># override reflected 'mydata' to be Unicode</span>
<span class="python_operator">... </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_tables_schema"></a>
    
    <div class="sectionL3">

    <h3>Specifying the Schema Name</h3>
    
    

<p>Some databases support the concept of multiple schemas.  A <code>Table</code> can reference this by specifying the <code>schema</code> keyword argument:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">financial_info </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'financial_info'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">schema</span><span class="python_operator">=</span><span class="python_literal">'remote_banks'</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Within the <code>MetaData</code> collection, this table will be identified by the combination of <code>financial_info</code> and <code>remote_banks</code>.  If another table called <code>financial_info</code> is referenced without the <code>remote_banks</code> schema, it will refer to a different <code>Table</code>.  <code>ForeignKey</code> objects can reference columns in this table using the form <code>remote_banks.financial_info.id</code>.
</p>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_tables_onupdate"></a>
    
    <div class="sectionL3">

    <h3>ON UPDATE and ON DELETE</h3>
    
    

<p><code>ON UPDATE</code> and <code>ON DELETE</code> clauses to a table create are specified within the <code>ForeignKeyConstraint</code> object, using the <code>onupdate</code> and <code>ondelete</code> keyword arguments:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">foobar </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foobar'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'lala'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'lala'</span><span class="python_enclosure">]</span><span class="python_operator">,</span><span class="python_enclosure">[</span><span class="python_literal">'hoho.lala'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>Note that these clauses are not supported on SQLite, and require <code>InnoDB</code> tables when used with MySQL.  They may also not be supported on other databases.
</p>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_tables_quoting"></a>
    
    <div class="sectionL3">

    <h3>Enabling Table / Column Quoting</h3>
    
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Many table, schema, or column names require quoting to be enabled.  Reasons for this include names that are the same as a database reserved word, or for identifiers that use MixedCase, where the database would normally "fold" the case convention into lower or uppercase (such as Postgres).  SQLAlchemy will attempt to automatically determine when quoting should be used.  It will determine a value for every identifier name called <code>case_sensitive</code>, which defaults to <code>False</code> if the identifer name uses no uppercase letters, or <code>True</code> otherwise.  This flag may be explicitly set on any schema item as well (schema items include <code>Table</code>, <code>Column</code>, <code>MetaData</code>, <code>Sequence</code>, etc.) to override this default setting, where objects will inherit the setting from an enclosing object if not explicitly overridden.
</p>
<p>When <code>case_sensitive</code> is <code>True</code>, the dialect will do what it has to in order for the database to recognize the casing.  For Postgres and Oracle, this means using quoted identifiers.
</p>
<p>Identifiers that match known SQL reserved words (such as "asc", "union", etc.) will also be quoted according to the dialect's quoting convention regardless of the <code>case_sensitive</code> setting.
</p>
<p>To force quoting for an identifier, set the "quote=True" flag on <code>Column</code> or <code>Table</code>, as well as the <code>quote_schema=True</code> flag for <code>Table</code>. 
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">table2 </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'WorstCase2'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_comment"># desc is a reserved word, which will be quoted.</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'desc'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># if using a reserved word which SQLAlchemy doesn't know about,</span>
    <span class="python_comment"># specify quote=True</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'some_reserved_word'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">quote</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># MixedCase uses a mixed case convention. </span>
    <span class="python_comment"># it will be automatically quoted since it is case sensitive</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'MixedCase'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># Union is both a reserved word and mixed case</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'Union'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># normal_column doesnt require quoting</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'normal_column'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_comment"># to use tables where case_sensitive is False by default regardless
# of idenfifier casings, set "case_sensitive" to false at any level
# (or true to force case sensitive for lowercase identifiers as well)
</span><span class="python_name">lowercase_metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_name">case_sensitive</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_tables_options"></a>
    
    <div class="sectionL3">

    <h3>Other Options</h3>
    
    

<p><code>Tables</code> may support database-specific options, such as MySQL's <code>engine</code> option that can specify "MyISAM", "InnoDB", and other backends for the table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engine_email_addresses'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'remote_user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">mysql_engine</span><span class="python_operator">=</span><span class="python_literal">'InnoDB'</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_creating"></a>
    
    <div class="sectionL2">

    <h3>Creating and Dropping Database Tables</h3>
    
    

<p>Creating and dropping individual tables can be done via the <code>create()</code> and <code>drop()</code> methods of <code>Table</code>; these methods take an optional <code>connectable</code> parameter which references an <code>Engine</code> or a <code>Connection</code>.  If not supplied, the <code>Engine</code> bound to the <code>MetaData</code> will be used, else an error is raised:
</p>

    

    <div class="code">
        <pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_1', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_1_div" class="codepop" style="display:none;">CREATE TABLE employees(<br/>
employee_id SERIAL NOT NULL PRIMARY KEY,<br/>
employee_name VARCHAR(60) NOT NULL,<br/>
employee_dept INTEGER REFERENCES departments(department_id)<br/>
)<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p><code>drop()</code> method:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_2', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_2_div" class="codepop" style="display:none;">DROP TABLE employees<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The <code>create()</code> and <code>drop()</code> methods also support an optional keyword argument <code>checkfirst</code> which will issue the database's appropriate pragma statements to check if the table exists before creating or dropping:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_operator">, </span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Entire groups of Tables can be created and dropped directly from the <code>MetaData</code> object with <code>create_all()</code> and <code>drop_all()</code>.  These methods always check for the existence of each table before creating or dropping.  Each method takes an optional <code>connectable</code> keyword argument which can reference an <code>Engine</code> or a <code>Connection</code>.  If no engine is specified, the underlying bound <code>Engine</code>,  if any, is used:
</p>

    

    <div class="code">
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_3', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_3_div" class="codepop" style="display:none;">PRAGMA table_info(users){}<br/>
CREATE TABLE users(<br/>
        user_id INTEGER NOT NULL PRIMARY KEY, <br/>
        user_name VARCHAR(16) NOT NULL, <br/>
        email_address VARCHAR(60), <br/>
        password VARCHAR(20) NOT NULL<br/>
)<br/>
PRAGMA table_info(user_prefs){}<br/>
CREATE TABLE user_prefs(<br/>
        pref_id INTEGER NOT NULL PRIMARY KEY, <br/>
        user_id INTEGER NOT NULL REFERENCES users(user_id), <br/>
        pref_name VARCHAR(40) NOT NULL, <br/>
        pref_value VARCHAR(100)<br/>
)</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_defaults"></a>
    
    <div class="sectionL2">

    <h3>Column Defaults and OnUpdates</h3>
    
    

<p>SQLAlchemy includes flexible constructs in which to create default values for columns upon the insertion of rows, as well as upon update.  These defaults can take several forms: a constant, a Python callable to be pre-executed before the SQL is executed, a SQL expression or function to be pre-executed before the SQL is executed, a pre-executed Sequence (for databases that support sequences), or a "passive" default, which is a default function triggered by the database itself upon insert, the value of which can then be post-fetched by the engine, provided the row provides a primary key in which to call upon.
</p>


    
    <A name="metadata_defaults_oninsert"></a>
    
    <div class="sectionL3">

    <h3>Pre-Executed Insert Defaults</h3>
    
    

<p>A basic default is most easily specified by the "default" keyword argument to Column.  This defines a value, function, or SQL expression that will be pre-executed to produce the new value, before the row is inserted:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># a function to create primary key ids
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">mydefault</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">global </span><span class="python_name">i</span><span class="python_operator">
    </span><span class="python_name">i </span><span class="python_operator">+= </span><span class="python_number">1</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">i</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_comment"># function-based default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">mydefault</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a scalar default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_literal">"default"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The "default" keyword can also take SQL expressions, including select statements or direct function calls:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'create_date' to default to now()</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'create_date'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">())</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'key' to pull its default from the 'keyvalues' table</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_literal">'type1'</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The "default" keyword argument is shorthand for using a ColumnDefault object in a column definition.  This syntax is optional, but is required for other types of defaults, futher described below:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()))</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_defaults_onupdate"></a>
    
    <div class="sectionL3">

    <h3>Pre-Executed OnUpdate Defaults</h3>
    
    

<p>Similar to an on-insert default is an on-update default, which is most easily specified by the "onupdate" keyword to Column, which also can be a constant, plain Python function or SQL expression:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'last_updated' to be populated with current_timestamp (the ANSI-SQL version of now())</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_updated'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">current_timestamp</span><span class="python_enclosure">())</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>To use an explicit ColumnDefault object to specify an on-update, use the "for_update" keyword argument:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">for_update</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_defaults_passive"></a>
    
    <div class="sectionL3">

    <h3>Inline Default Execution: PassiveDefault</h3>
    
    

<p>A PassiveDefault indicates an column default that is executed upon INSERT by the database.  This construct is used to specify a SQL function that will be specified as "DEFAULT" when creating tables.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"sysdate"</span><span class="python_enclosure">)))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>A create call for the above table will produce:
</p>

    

    <div class="sliding_code">
        <pre>CREATE TABLE test (
    mycolumn datetime default sysdate
)</pre>
    </div>
<p>PassiveDefault also sends a message to the <code>Engine</code> that data is available after an insert.  The object-relational mapper system uses this information to post-fetch rows after the insert, so that instances can be refreshed with the new data.  Below is a simplified version:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># table with passive defaults
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'my_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># an on-insert database-side default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"d1_func()"</span><span class="python_enclosure">)))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># insert a row
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># check the result: were there defaults fired off on that row ?
</span><span class="python_keyword">if </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">lastrow_has_defaults</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_comment"># postfetch the row based on primary key.
    # this only works for a table with primary key columns defined
</span><span class="python_operator">    </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">last_inserted_ids</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">== </span><span class="python_name">primary_key</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre>
    </div>
<p>When Tables are reflected from the database using <code>autoload=True</code>, any DEFAULT values set on the columns will be reflected in the Table object as PassiveDefault instances.
</p>

    
    <A name="metadata_defaults_passive_postgres"></a>
    
    <div class="sectionL4">

    <h3>The Catch: Postgres Primary Key Defaults always Pre-Execute</h3>
    
    
<p>Current Postgres support does not rely upon OID's to determine the identity of a row.  This is because the usage of OIDs has been deprecated with Postgres and they are disabled by default for table creates as of PG version 8.  Pyscopg2's "cursor.lastrowid" function only returns OIDs.  Therefore, when inserting a new row which has passive defaults set on the primary key columns, the default function is <b>still pre-executed</b> since SQLAlchemy would otherwise have no way of retrieving the row just inserted.
</p>



            <a href="#metadata">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_defaults_sequences"></a>
    
    <div class="sectionL3">

    <h3>Defining Sequences</h3>
    
    

<p>A table with a sequence looks like:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"cartitems"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"cart_id"</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">Sequence</span><span class="python_enclosure">(</span><span class="python_literal">'cart_id_seq'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"description"</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"createdate"</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_enclosure">())</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The Sequence is used with Postgres or Oracle to indicate the name of a database sequence that will be used to create default values for a column.  When a table with a Sequence on a column is created in the database by SQLAlchemy, the database sequence object is also created.   Similarly, the database sequence is dropped when the table is dropped.  Sequences are typically used with primary key columns.  When using Postgres, if an integer primary key column defines no explicit Sequence or other default method, SQLAlchemy will create the column with the SERIAL keyword, and will pre-execute a sequence named "tablename_columnname_seq" in order to retrieve new primary key values, if they were not otherwise explicitly stated.   Oracle, which has no "auto-increment" keyword, requires that a Sequence be created for a table if automatic primary key generation is desired.
</p>
<p>A Sequence object can be defined on a Table that is then used for a non-sequence-supporting database.  In that case, the Sequence object is simply ignored.  Note that a Sequence object is <strong>entirely optional for all databases except Oracle</strong>, as other databases offer options for auto-creating primary key values, such as AUTOINCREMENT, SERIAL, etc.  SQLAlchemy will use these default methods for creating primary key values if no Sequence is present on the table metadata.
</p>
<p>A sequence can also be specified with <code>optional=True</code> which indicates the Sequence should only be used on a database that requires an explicit sequence, and not those that supply some other method of providing integer values.  At the moment, it essentially means "use this sequence only with Oracle and not Postgres".
</p>



            <a href="#metadata">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_constraints"></a>
    
    <div class="sectionL2">

    <h3>Defining Constraints and Indexes</h3>
    
    



    
    <A name="metadata_constraints_unique"></a>
    
    <div class="sectionL3">

    <h3>UNIQUE Constraint</h3>
    
    

<p>Unique constraints can be created anonymously on a single column using the <code>unique</code> keyword on <code>Column</code>.  Explicitly named unique constraints and/or those with multiple columns are created via the <code>UniqueConstraint</code> table-level construct.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column anonymous unique constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># explicit/composite unique constraint.  'name' is optional.</span>
    <span class="python_name">UniqueConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'uix_1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_constraints_check"></a>
    
    <div class="sectionL3">

    <h3>CHECK Constraint</h3>
    
    

<p>Check constraints can be named or unnamed and can be created at the Column or Table level, using the <code>CheckConstraint</code> construct.  The text of the check constraint is passed directly through to the database, so there is limited "database independent" behavior.  Column level check constraints generally should only refer to the column to which they are placed, while table level constraints can refer to any columns in the table.
</p>
<p>Note that some databases do not actively support check constraints such as MySQL and sqlite.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column CHECK constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col1&gt;5'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># table level CHECK constraint.  'name' is optional.</span>
    <span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2 &gt; col3 + 5'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'check1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>



    
    <A name="metadata_constraints_indexes"></a>
    
    <div class="sectionL3">

    <h3>Indexes</h3>
    
    

<p>Indexes can be created anonymously (using an auto-generated name "ix_<column label>") for a single column using the inline <code>index</code> keyword on <code>Column</code>, which also modifies the usage of <code>unique</code> to apply the uniqueness to the index itself, instead of adding a separate UNIQUE constraint.  For indexes with specific names or which encompass more than one column, use the <code>Index</code> construct, which requires a name.  <br></br>
</p>
<p>Note that the <code>Index</code> construct is created <strong>externally</strong> to the table which it corresponds, using <code>Column</code> objects and not strings.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_comment"># an indexed column, with index "ix_mytable_col1"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a uniquely indexed column with index "ix_mytable_col2"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col4'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col5'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col6'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place an index on col3, col4
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'idx_col34'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col3</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col4</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place a unique index on col5, col6
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'myindex'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col6</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>Index</code> objects will be created along with the CREATE statements for the table itself.  An index can also be created on its own independently of the table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># create a table
</span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># define an index
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'someindex'</span><span class="python_operator">, </span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the index, will use the table's connectable, or specify the connectable keyword argument
</span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_adapting"></a>
    
    <div class="sectionL2">

    <h3>Adapting Tables to Alternate Metadata</h3>
    
    

<p>A <code>Table</code> object created against a specific <code>MetaData</code> object can be re-created against a new MetaData using the <code>tometadata</code> method:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># create two metadata
</span><span class="python_name">meta1 </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///querytest.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta2 </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load 'users' from the sqlite engine
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta1</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the same Table object for the plain metadata
</span><span class="python_name">users_table_2 </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">tometadata</span><span class="python_enclosure">(</span><span class="python_name">meta2</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>




            <a href="#metadata">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="sql"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#metadata">Database Meta Data</a>

               |   
            Next: <a href="#datamapping">Data Mapping</a>
    </div>

        <h2>Constructing SQL Queries via Python Expressions</h2>
    </div>


        








    
    <A name="sql"></a>
    
    <div class="sectionL1">

    
    

<p><em>Note:</em> This section describes how to use SQLAlchemy to construct SQL queries and receive result sets.  It does <em>not</em> cover the object relational mapping capabilities of SQLAlchemy; that is covered later on in <a href="#datamapping">Data Mapping</a>.  However, both areas of functionality work similarly in how selection criterion is constructed, so if you are interested just in ORM, you should probably skim through basic <a href="#sql_whereclause">WHERE Clause</a> construction before moving on.
</p>
<p>Once you have used the <code>sqlalchemy.schema</code> module to construct your tables and/or reflect them from the database, performing SQL queries using those table meta data objects is done via the <code>sqlalchemy.sql</code> package.  This package defines a large set of classes, each of which represents a particular kind of lexical construct within a SQL query; all are descendants of the common base class <code>sqlalchemy.sql.ClauseElement</code>.  A full query is represented via a structure of <code>ClauseElement</code>s.  A set of reasonably intuitive creation functions is provided by the <code>sqlalchemy.sql</code> package to create these structures; these functions are described in the rest of this section. 
</p>
<p>Executing a <code>ClauseElement</code> structure can be performed in two general ways.  You can use an <code>Engine</code> or a <code>Connection</code> object's <code>execute()</code> method to which you pass the query structure; this is known as <strong>explicit style</strong>.  Or, if the <code>ClauseElement</code> structure is built upon Table metadata which is bound to an <code>Engine</code> directly, you can simply call <code>execute()</code> on the structure itself, known as <strong>implicit style</strong>.  In both cases, the execution returns a cursor-like object (more on that later).  The same clause structure can be executed repeatedly.  The <code>ClauseElement</code> is compiled into a string representation by an underlying <code>Compiler</code> object which is associated with the <code>Engine</code> via its <code>Dialect</code>.
</p>
<p>The examples below all include a dump of the generated SQL corresponding to the query object, as well as a dump of the statement's bind parameters.  In all cases, bind parameters are shown as named parameters using the colon format (i.e. ':name').  When the statement is compiled into a database-specific version, the named-parameter statement and its bind values are converted to the proper paramstyle for that database automatically.
</p>
<p>For this section, we will mostly use the implcit style of execution, meaning the <code>Table</code> objects are associated with an instance of <code>BoundMetaData</code>, and constructed <code>ClauseElement</code> objects support self-execution.  Assume the following configuration:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///mydb.db'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_select"></a>
    
    <div class="sectionL2">

    <h3>Simple Select</h3>
    
    

<p>A select is done by constructing a <code>Select</code> object with the proper arguments, adding any extra arguments if desired, then calling its <code>execute()</code> method.
</p>

    

    <div class="code">
            <div class="codetitle">Basic Select</div>
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># use the select() function defined in the sql package
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># or, call the select() method off of a Table object
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># then, call execute on the Select object:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_4', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_4_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
{}</div><pre><span class="python_comment"># the SQL text of any clause object can also be viewed via the str() call:
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_select_explicit"></a>
    
    <div class="sectionL3">

    <h3>Explicit Execution</h3>
    
    

<p>As mentioned above, <code>ClauseElement</code> structures can also be executed with a <code>Connection</code> object explicitly:
</p>

    

    <div class="code">
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_5', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_5_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
{}</div><pre><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_select_binding"></a>
    
    <div class="sectionL3">

    <h3>Binding ClauseElements to Engines</h3>
    
    

<p>For queries that don't contain any tables, <code>ClauseElement</code>s that represent a fully executeable statement support an <code>engine</code> keyword parameter which can bind the object to an <code>Engine</code>, thereby allowing implicit execution:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># select a literal
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_6', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"current_time"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_6_div" class="codepop" style="display:none;">SELECT current_time<br/>
{}</div><pre><span class="python_comment"># select a function
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_7', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_7_div" class="codepop" style="display:none;">SELECT now()<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_select_resultproxy"></a>
    
    <div class="sectionL3">

    <h3>Getting Results</h3>
    
    

<p>The object returned by <code>execute()</code> is a <code>sqlalchemy.engine.ResultProxy</code> object, which acts much like a DBAPI <code>cursor</code> object in the context of a result set, except that the rows returned can address their columns by ordinal position, column name, or even column object:
</p>

    

    <div class="code">
            <div class="codetitle">Using the ResultProxy</div>
        <pre><span class="python_comment"># select rows, get resulting ResultProxy object
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_8', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_8_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
{}</div><pre><span class="python_comment"># get one row
</span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get the 'user_id' column via integer index:
</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column name
</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'user_name'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column object
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column accessor
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_comment"># ResultProxy object also supports fetchall()
</span><span class="python_name">rows </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or get the underlying DBAPI cursor object
</span><span class="python_name">cursor </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">
</span>
<span class="python_comment"># close the result.  If the statement was implicitly executed 
# (i.e. without an explicit Connection), this will
# return the underlying connection resources back to 
# the connection pool.  de-referencing the result
# will also have the same effect.  if an explicit Connection was 
# used, then close() just closes the underlying cursor object.
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_select_labels"></a>
    
    <div class="sectionL3">

    <h3>Using Column Labels</h3>
    
    

<p>A common need when writing statements that reference multiple tables is to create labels for columns, thereby separating columns from different tables with the same name.  The Select construct supports automatic generation of column labels via the <code>use_labels=True</code> parameter:
</p>

    

    <div class="code">
            <div class="codetitle">use_labels Flag</div>
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_9', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
<span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
<span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_9_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The table name part of the label is affected if you use a construct such as a table alias:
</p>

    

    <div class="code">
            <div class="codetitle">use_labels with an Alias</div>
        <pre><span class="python_name">person </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_10', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">person</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
    <span class="python_name">person</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
    <span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_10_div" class="codepop" style="display:none;">SELECT person.user_id AS person_user_id, person.user_name AS person_user_name, <br/>
person.password AS person_password, addresses.address_id AS addresses_address_id,<br/>
 addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
 addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
 addresses.zip AS addresses_zip FROM users AS person, addresses<br/>
WHERE person.user_id = addresses.address_id</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Labels are also generated in such a way as to never go beyond 30 characters.  Most databases support a limit on the length of symbols, such as Postgres, and particularly Oracle which has a rather short limit of 30:
</p>

    

    <div class="code">
            <div class="codetitle">use_labels Generates Abbreviated Labels</div>
        <pre><span class="python_name">long_named_table </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'this_is_the_person_table'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_11', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">long_named_table</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_11_div" class="codepop" style="display:none;">SELECT this_is_the_person_table.user_id AS this_is_the_person_table_b36c, <br/>
this_is_the_person_table.user_name AS this_is_the_person_table_f76a, <br/>
this_is_the_person_table.password AS this_is_the_person_table_1e7c<br/>
FROM users AS this_is_the_person_table<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>You can also specify custom labels on a per-column basis using the <code>label()</code> function:
</p>

    

    <div class="code">
            <div class="codetitle">label() Function on Column</div>
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_12', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
           <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_12_div" class="codepop" style="display:none;">SELECT users.user_id AS id, users.user_name AS name<br/>
FROM users<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_select_columns"></a>
    
    <div class="sectionL3">

    <h3>Table/Column Specification</h3>
    
    

<p>Calling <code>select</code> off a table automatically generates a column clause which includes all the table's columns, in the order they are specified in the source Table object.
</p>
<p>But in addition to selecting all the columns off a single table, any set of columns can be specified, as well as full tables, and any combination of the two:
</p>

    

    <div class="code">
            <div class="codetitle">Specify Columns to Select</div>
        <pre><span class="python_comment"># individual columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_13', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_13_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name FROM users<br/>
{}</div><pre><span class="python_comment"># full tables
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_14', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_14_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.address_id, addresses.user_id, <br/>
addresses.street, addresses.city, addresses.state, addresses.zip<br/>
FROM users, addresses<br/>
{}</div><pre><span class="python_comment"># combinations
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_15', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_15_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.zip FROM users, addresses<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_whereclause"></a>
    
    <div class="sectionL2">

    <h3>WHERE Clause</h3>
    
    

<pre><code>
</code></pre><p>The WHERE condition is the named keyword argument <code>whereclause</code>, or the second positional argument to the <code>select()</code> constructor and the first positional argument to the <code>select()</code> method of <code>Table</code>.
</p>
<p>WHERE conditions are constructed using column objects, literal values, and functions defined in the <code>sqlalchemy.sql</code> module.  Column objects override the standard Python operators to provide clause compositional objects, which compile down to SQL operations:
</p>

    

    <div class="code">
            <div class="codetitle">Basic WHERE Clause</div>
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_16', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_16_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
FROM users WHERE users.user_id = :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Notice that the literal value "7" was broken out of the query and placed into a bind parameter.  Databases such as Oracle must parse incoming SQL and create a "plan" when new queries are received, which is an expensive process.  By using bind parameters, the same query with various literal values can have its plan compiled only once, and used repeatedly with less overhead.
</p>
<p>More where clauses:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># another comparison operator
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_17', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_17_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
FROM users WHERE users.user_id > :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_comment"># OR keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_18', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_18_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :users_user_name <br/>
OR users.user_name = :users_user_name_1<br/>
{'users_user_name_1': 'ed', 'users_user_name': 'jack'}</div><pre><span class="python_comment"># AND keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_19', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_19_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name <br/>
AND users.password = :users_password<br/>
{'users_user_name': 'jack', 'users_password': 'dog'}</div><pre><span class="python_comment"># NOT keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_20', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">not_</span><span class="python_enclosure">(</span>
        <span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_20_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE NOT (users.user_name = :users_user_name <br/>
    OR users.password = :users_password)<br/>
{'users_user_name': 'jack', 'users_password': 'dog'}</div><pre><span class="python_comment"># IN clause
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_21', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'fred'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_21_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name <br/>
IN (:users_user_name, :users_user_name_1, :users_user_name_2)<br/>
{'users_user_name': 'jack', 'users_user_name_1': 'ed', <br/>
'users_user_name_2': 'fred'}</div><pre><span class="python_comment"># join users and addresses together
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_22', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_22_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password,  <br/>
addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_comment"># join users and addresses together, but dont specify "addresses" in the 
# selection criterion.  The WHERE criterion adds it to the FROM list 
# automatically.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_23', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">and_</span><span class="python_enclosure">(</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span>
            <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_23_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users, addresses WHERE users.user_id = addresses.user_id <br/>
AND users.user_name = :users_user_name<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Select statements can also generate a WHERE clause based on the parameters you give it.  If a given parameter, which matches the name of a column or its "label" (the combined tablename + "_" + column name), and does not already correspond to a bind parameter in the select object, it will be added as a comparison against that column.  This is a shortcut to creating a full WHERE clause:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># specify a match for the "user_name" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_24', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_24_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'ed'}</div><pre><span class="python_comment"># specify a full where clause for the "user_name" column, as well as a
# comparison for the "user_id" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_25', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_25_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name AND users.user_id = :users_user_id<br/>
{'users_user_name': 'ed', 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_whereclause_operators"></a>
    
    <div class="sectionL3">

    <h3>Operators</h3>
    
    

<p>Supported column operators so far are all the numerical comparison operators, i.e. '==', '>', '>=', etc., as well as <code>like()</code>, <code>startswith()</code>, <code>endswith()</code>, <code>between()</code>, and <code>in()</code>.  Boolean operators include <code>not_()</code>, <code>and_()</code> and <code>or_()</code>, which also can be used inline via '~', '&', and '|'.  Math operators are '+', '-', '*', '/'.  Any custom operator can be specified via the <code>op()</code> function shown below.
</p>

    

    <div class="code">
        <pre><span class="python_comment"># "like" operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%ter'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># equality operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># in opertator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">,</span><span class="python_number">2</span><span class="python_operator">,</span><span class="python_number">3</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># and_, endswith, equality operators
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># & operator subsituting for 'and_'
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">) </span><span class="python_operator">& </span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># + concatenation operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">+ </span><span class="python_literal">'_name'</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># NOT operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_operator">~</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">== </span><span class="python_literal">'Green Street'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># any custom operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">op</span><span class="python_enclosure">(</span><span class="python_literal">'||'</span><span class="python_enclosure">)(</span><span class="python_literal">'_category'</span><span class="python_enclosure">)])</span><span class="python_operator">
</span>
<span class="python_comment"># "null" comparison via == (converts to IS)
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_26', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_26_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE users.user_name IS NULL</div><pre><span class="python_comment"># or via explicit null() construct
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_27', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">null</span><span class="python_enclosure">())</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_27_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE users.user_name IS NULL</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_whereclause_functions"></a>
    
    <div class="sectionL3">

    <h3>Functions</h3>
    
    

<p>Functions can be specified using the <code>func</code> keyword:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_28', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_28_div" class="codepop" style="display:none;">SELECT count(users.user_id) FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_29', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">substr</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_literal">'J'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_29_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE substr(users.user_name, :substr) = :substr_1<br/>
{'substr_1': 'J', 'substr': 1}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Functions also are callable as standalone values:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># call the "now()" function
</span><span class="python_name">time </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># call myfunc(1,2,3)
</span><span class="python_name">myvalue </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">myfunc</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or call them off the engine
</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_whereclause_literals"></a>
    
    <div class="sectionL3">

    <h3>Literals</h3>
    
    

<p>You can drop in a literal value anywhere there isnt a column to attach to via the <code>literal</code> keyword:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_30', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_30_div" class="codepop" style="display:none;">SELECT :literal + :literal_1, users.user_name <br/>
FROM users<br/>
{'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_comment"># literals have all the same comparison functions as columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_31', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_31_div" class="codepop" style="display:none;">SELECT :literal = :literal_1<br/>
{'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Literals also take an optional <code>type</code> parameter to give literals a type.  This can sometimes be significant, for example when using the "+" operator with SQLite, the String type is detected and the operator is converted to "||":
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_32', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_literal">'bar'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_32_div" class="codepop" style="display:none;">SELECT ? || ?<br/>
['foo', 'bar']</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_whereclause_orderby"></a>
    
    <div class="sectionL3">

    <h3>Order By</h3>
    
    

<p>The ORDER BY clause of a select statement can be specified as individual columns to order by within an array specified via the <code>order_by</code> parameter, and optional usage of the asc() and desc() functions:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># straight order by
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_33', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_33_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users ORDER BY users.user_name</div><pre><span class="python_comment"># descending/ascending order by on multiple columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_34', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">></span><span class="python_literal">'J'</span><span class="python_operator">, </span>
    <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">asc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_34_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name > :users_user_name <br/>
ORDER BY users.user_id DESC, users.user_name ASC<br/>
{'users_user_name':'J'}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_whereclause_options"></a>
    
    <div class="sectionL3">

    <h3>DISTINCT, LIMIT and OFFSET</h3>
    
    

<p>These are specified as keyword arguments:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_35', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_35_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_name FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_36', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_36_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users LIMIT 10 OFFSET 20</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The Oracle driver does not support LIMIT and OFFSET directly, but instead wraps the generated query into a subquery and uses the "rownum" variable to control the rows selected (this is somewhat experimental).  Similarly, the Firebird and MSSQL drivers convert LIMIT into queries using FIRST and TOP, respectively.
</p>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_join"></a>
    
    <div class="sectionL2">

    <h3>Inner and Outer Joins</h3>
    
    

<p>As some of the examples indicated above, a regular inner join can be implicitly stated, just like in a SQL expression, by just specifying the tables to be joined as well as their join conditions:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_37', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_37_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip FROM addresses, users<br/>
WHERE addresses.user_id = users.user_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>There is also an explicit join constructor, which can be embedded into a select query via the <code>from_obj</code> parameter of the select statement:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_38', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_38_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip <br/>
FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The join constructor can also be used by itself:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_39', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_39_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip <br/>
FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The join criterion in a join() call is optional.  If not specified, the condition will be derived from the foreign key relationships of the two tables.  If no criterion can be constructed, an exception will be raised.
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_40', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_40_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip <br/>
FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Notice that this is the first example where the FROM criterion of the select statement is explicitly specified.  In most cases, the FROM criterion is automatically determined from the columns requested as well as the WHERE clause.  The <code>from_obj</code> keyword argument indicates a list of explicit FROM clauses to be used in the statement.
</p>
<p>A join can be created on its own using the <code>join</code> or <code>outerjoin</code> functions, or can be created off of an existing Table or other selectable unit via the <code>join</code> or <code>outerjoin</code> methods:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_41', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span>
           <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_41_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, addresses.address_id, <br/>
addresses.user_id, addresses.street, addresses.city, addresses.state, addresses.zip<br/>
FROM users LEFT OUTER JOIN addresses ON users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_42', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'running'</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
        <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
            <span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
                <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_42_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
JOIN userkeywords ON userkeywords.user_id = users.user_id <br/>
JOIN keywords ON keywords.keyword_id = userkeywords.keyword_id<br/>
WHERE keywords.name = :keywords_name<br/>
{'keywords_name': 'running'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Joins also provide a keyword argument <code>fold_equivalents</code> on the <code>select()</code> function which allows the column list of the resulting select to be "folded" to the minimal list of columns, based on those columns that are known to be equivalent from the "onclause" of the join.  This saves the effort of constructing column lists manually in conjunction with databases like Postgres which can be picky about "ambiguous columns".  In this example, only the "users.user_id" column, but not the "addresses.user_id" column, shows up in the column clause of the resulting select:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_43', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">fold_equivalents</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_43_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, addresses.address_id, <br/>
addresses.street, addresses.city, addresses.state, addresses.zip<br/>
FROM users JOIN addresses ON users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The <code>fold_equivalents</code> argument will recursively apply to "chained" joins as well, i.e. <code>a.join(b).join(c)...</code>.
</p>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_alias"></a>
    
    <div class="sectionL2">

    <h3>Table Aliases</h3>
    
    

<p>Aliases are used primarily when you want to use the same table more than once as a FROM expression in a statement:
</p>

    

    <div class="code">
        <pre><span class="python_name">address_b </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'addressb'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_44', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_comment"># select users who have an address on Green street as well as Orange street</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Orange%'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_44_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users, addresses, addresses AS addressb<br/>
WHERE users.user_id = addresses.user_id <br/>
AND addresses.street LIKE :addresses_street <br/>
AND users.user_id = addressb.user_id <br/>
AND addressb.street LIKE :addressb_street<br/>
{'addressb_street': '%Orange%', 'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_subqueries"></a>
    
    <div class="sectionL2">

    <h3>Subqueries</h3>
    
    

<p>SQLAlchemy allows the creation of select statements from not just Table objects, but from a whole class of objects that implement the <code>Selectable</code> interface.  This includes Tables, Aliases, Joins and Selects.  Therefore, if you have a Select, you can select from the Select:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT user_id</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_name">FROM </span><span class="python_enclosure">(</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Any Select, Join, or Alias object supports the same column accessors as a Table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">key </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>When you use <code>use_labels=True</code> in a Select object, the label version of the column names become the keys of the accessible columns.  In effect you can create your own "view objects":
</p>

    

    <div class="code">
        <pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_45', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span>
    <span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">users_user_name</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_street</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_zip</span>
<span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_city</span><span class="python_operator">==</span><span class="python_literal">'San Francisco'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_45_div" class="codepop" style="display:none;">SELECT users_user_name, addresses_street, addresses_zip<br/>
FROM (SELECT users.user_id AS users_user_id, users.user_name AS users_user_name,<br/>
users.password AS users_password, addresses.address_id AS addresses_address_id,<br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.user_id)<br/>
WHERE addresses_city = :addresses_city<br/>
{'addresses_city': 'San Francisco'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>To specify a SELECT statement as one of the selectable units in a FROM clause, it usually should be given an alias.
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_46', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_46_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip, u.user_id, u.user_name, u.password <br/>
FROM addresses, <br/>
(SELECT users.user_id, users.user_name, users.password FROM users) AS u<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Select objects can be used in a WHERE condition, in operators such as IN:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># select user ids for all users whos name starts with a "p"
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'p%'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># now select all addresses for those users
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_47', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_47_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip<br/>
FROM addresses WHERE addresses.address_id IN <br/>
(SELECT users.user_id FROM users WHERE users.user_name LIKE :users_user_name)<br/>
{'users_user_name': 'p%'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The sql package supports embedding select statements into other select statements as the criterion in a WHERE condition, or as one of the "selectable" objects in the FROM list of the query.  It does not at the moment directly support embedding a SELECT statement as one of the column criterion for a statement, although this can be achieved via direct text insertion, described later.
</p>


    
    <A name="sql_subqueries_scalar"></a>
    
    <div class="sectionL3">

    <h3>Scalar Column Subqueries</h3>
    
    

<p>Subqueries can be used in the column clause of a select statement by specifying the <code>scalar=True</code> flag:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_48', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">, </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">, </span>
                <span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">scalar</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre><div id="popbox_48_div" class="codepop" style="display:none;">SELECT table2.col1, table2.col2, <br/>
(SELECT table1.col1 AS col1 FROM table1 WHERE col2=:table1_col2) <br/>
FROM table2<br/>
{'table1_col2': 7}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_correlated"></a>
    
    <div class="sectionL2">

    <h3>Correlated Subqueries</h3>
    
    

<p>When a select object is embedded inside of another select object, and both objects reference the same table, SQLAlchemy makes the assumption that the table should be correlated from the child query to the parent query.  To disable this behavior, specify the flag <code>correlate=False</code> to the Select statement.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># make an alias of a regular select.   
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'s'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span><span class="python_operator">, </span><span class="python_name">users </span><span class="python_operator">
</span><span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span>
<span class="python_comment"># now embed that select into another one.  the "users" table is removed from
# the embedded query's FROM list and is instead correlated to the parent query
</span><span class="python_name">s2 </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s2</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span>
<span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">s</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_correlated_exists"></a>
    
    <div class="sectionL3">

    <h3>EXISTS Clauses</h3>
    
    

<p>An EXISTS clause can function as a higher-scaling version of an IN clause, and is usually used in a correlated fashion:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># find all users who have an address on Green street:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_49', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">exists</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">and_</span><span class="python_enclosure">(</span>
            <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
            <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_49_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE EXISTS (SELECT addresses.address_id <br/>
FROM addresses WHERE addresses.user_id = users.user_id <br/>
AND addresses.street LIKE :addresses_street)<br/>
{'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_unions"></a>
    
    <div class="sectionL2">

    <h3>Unions</h3>
    
    

<p>Unions come in two flavors, UNION and UNION ALL, which are available via module level functions or methods off a Selectable:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_50', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">union</span><span class="python_enclosure">(</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'44 Park Ave.'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'3 Mill Road'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span>
<span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_50_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street <br/>
UNION <br/>
SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street_1 <br/>
UNION <br/>
SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street_2 <br/>
ORDER BY addresses.street<br/>
{'addresses_street_1': '44 Park Ave.', <br/>
'addresses_street': '123 Green Street', <br/>
'addresses_street_2': '3 Mill Road'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_51', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span>
  <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">union_all</span><span class="python_enclosure">(</span>
      <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
          <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">9</span>
      <span class="python_enclosure">)</span><span class="python_operator">, </span>
      <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]   </span><span class="python_comment"># order_by is an argument to union_all()</span>
  <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_51_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_id = :users_user_id <br/>
UNION ALL <br/>
SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_id = :users_user_id_1 <br/>
ORDER BY users.user_id<br/>
{'users_user_id_1': 9, 'users_user_id': 7}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_bindparams"></a>
    
    <div class="sectionL2">

    <h3>Custom Bind Parameters</h3>
    
    

<p>Throughout all these examples, SQLAlchemy is busy creating bind parameters wherever literal expressions occur.  You can also specify your own bind parameters with your own names, and use the same statement repeatedly.  The bind parameters, shown here in the "named" format, will be converted to the appropriate named or positional style according to the database implementation being used.
</p>

    

    <div class="code">
            <div class="codetitle">Custom Bind Params</div>
        <pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># execute implicitly
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_52', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_52_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :username<br/>
{'username': 'fred'}</div><pre><span class="python_comment"># execute explicitly
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_53', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_53_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :username<br/>
{'username': 'fred'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p><code>executemany()</code> is also available by supplying multiple dictionary arguments instead of keyword arguments to the <code>execute()</code> method of <code>ClauseElement</code> or <code>Connection</code>.  Examples can be found later in the sections on INSERT/UPDATE/DELETE.
</p>


    
    <A name="sql_bindparams_precompiling"></a>
    
    <div class="sectionL3">

    <h3>Precompiling a Query</h3>
    
    

<p>By throwing the <code>compile()</code> method onto the end of any query object, the query can be "compiled" by the SQLEngine into a <code>sqlalchemy.sql.Compiled</code> object just once, and the resulting compiled object reused, which eliminates repeated internal compilation of the SQL string:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_textual"></a>
    
    <div class="sectionL2">

    <h3>Literal Text Blocks</h3>
    
    

<p>The sql package tries to allow free textual placement in as many ways as possible.  In the examples below, note that the from_obj parameter is used only when no other information exists within the select object with which to determine table metadata.  Also note that in a query where there isnt even table metadata used, the SQLEngine to be used for the query has to be explicitly specified:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># strings as column clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_54', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"user_id"</span><span class="python_operator">, </span><span class="python_literal">"user_name"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_54_div" class="codepop" style="display:none;">SELECT user_id, user_name FROM users<br/>
{}</div><pre><span class="python_comment"># strings for full column lists
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_55', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"user_id, user_name, password, addresses.*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_55_div" class="codepop" style="display:none;">SELECT u.user_id, u.user_name, u.password, addresses.* <br/>
FROM users AS u, addresses<br/>
{}</div><pre><span class="python_comment"># functions, etc.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_56', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)"</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_56_div" class="codepop" style="display:none;">SELECT users.user_id, process_string(user_name) FROM users<br/>
{}</div><pre><span class="python_comment"># where clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_57', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)=27"</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_57_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE users.user_id = :users_user_id AND process_string(user_name)=27<br/>
{'users_user_id': 7}</div><pre><span class="python_comment"># subqueries
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_58', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_literal">"exists (select 1 from addresses where addresses.user_id=users.user_id)"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_58_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE exists (select 1 from addresses where addresses.user_id=users.user_id)<br/>
{}</div><pre><span class="python_comment"># custom FROM objects
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_59', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">"(select user_id, user_name from users)"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_59_div" class="codepop" style="display:none;">SELECT * FROM (select user_id, user_name from users)<br/>
{}</div><pre><span class="python_comment"># a full query
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_60', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select user_name from users"</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_60_div" class="codepop" style="display:none;">SELECT user_name FROM users<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_textual_textual_binds"></a>
    
    <div class="sectionL3">

    <h3>Using Bind Parameters in Text Blocks</h3>
    
    

<p>Use the format <code>':paramname'</code> to define bind parameters inside of a text block.  They will be converted to the appropriate format upon compilation:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Bind parameters can also be explicit, which allows typing information to be added.  Just specify them as a list with keys that match those inside the textual statement:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
                <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)])</span><span class="python_operator">
    </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Result-row type processing can be added via the <code>typemap</code> argument, which is a dictionary of return columns mapped to types:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># specify DateTime type for the 'foo' column in the result set
# sqlite, for example, uses result-row post-processing to construct dates
</span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
        <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
        <span class="python_name">typemap</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'foo'</span><span class="python_operator">:</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">DateTime</span><span class="python_enclosure">}</span>
        <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># 'foo' is a datetime
</span><span class="python_name">year </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()[</span><span class="python_literal">'foo'</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">year</span><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_building"></a>
    
    <div class="sectionL2">

    <h3>Building Select Objects</h3>
    
    

<p>One of the primary motivations for a programmatic SQL library is to allow the piecemeal construction of a SQL statement based on program variables.  All the above examples typically show Select objects being created all at once.  The Select object also includes "builder" methods to allow building up an object.  The below example is a "user search" function, where users can be selected based on primary key, user name, street address, keywords, or any combination:
</p>

    

    <div class="code">
        <pre><span class="python_keyword">def </span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">id </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">name </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">street </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_comment"># append_whereclause joins "WHERE" conditions together with AND
</span><span class="python_operator">        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_name">street</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">keywords </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_from</span><span class="python_enclosure">(</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
                        <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_comment"># to avoid multiple repeats, set query to be DISTINCT:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_literal"><a href="javascript:togglePopbox('popbox_61', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_61_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE users.user_id = :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_62', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_62_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users, addresses <br/>
WHERE users.user_id = addresses.user_id AND addresses.street = :addresses_street<br/>
{'addresses_street': '123 Green Street'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_63', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Jack'</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'foo'</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre><div id="popbox_63_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_id, users.user_name, users.password <br/>
FROM users JOIN userkeywords ON users.user_id = userkeywords.user_id <br/>
JOIN keywords ON userkeywords.keyword_id = keywords.keyword_id <br/>
WHERE users.user_name = :users_user_name AND keywords.name IN ('jack', 'foo')<br/>
{'users_user_name': 'Jack'}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_insert"></a>
    
    <div class="sectionL2">

    <h3>Inserts</h3>
    
    

<p>An INSERT involves just one table.  The Insert object is used via the insert() function, and the specified columns determine what columns show up in the generated SQL.  If primary key columns are left out of the criterion, the SQL generator will try to populate them as specified by the particular database engine and sequences, i.e. relying upon an auto-incremented column or explicitly calling a sequence beforehand.  Insert statements, as well as updates and deletes, can also execute multiple parameters in one pass via specifying an array of dictionaries as parameters.
</p>
<p>The values to be populated for an INSERT or an UPDATE can be specified to the insert()/update() functions as the <code>values</code> named argument, or the query will be compiled based on the values of the parameters sent to the execute() method.
</p>

    

    <div class="code">
            <div class="codetitle">Using insert()</div>
        <pre><span class="python_comment"># basic insert
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_64', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'asdfdaf'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_64_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
{'user_name': 'jack', 'password': 'asdfdaf', 'user_id': 1}</div><pre><span class="python_comment"># insert just user_name, NULL for others
# will auto-populate primary key columns if they are configured
# to do so
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_65', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_65_div" class="codepop" style="display:none;">INSERT INTO users (user_name) VALUES (:user_name)<br/>
{'user_name': 'ed'}</div><pre><span class="python_comment"># INSERT with a list:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_66', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'sdfadfas'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_66_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
{'user_id': 3, 'password': 'sdfadfas', 'user_name': 'jane'}</div><pre><span class="python_comment"># INSERT with user-defined bind parameters
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span>
    <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'pw'</span><span class="python_enclosure">)}</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_67', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_name">pw</span><span class="python_operator">=</span><span class="python_literal">'adas5fs'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_67_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:name, :pw)<br/>
{'name': 'mary', 'pw': 'adas5fs'}</div><pre><span class="python_comment"># INSERT many - if no explicit 'values' parameter is sent,
# the first parameter list in the list determines
# the generated SQL of the insert (i.e. what columns are present)
# executemany() is used at the DBAPI level
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_68', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdfasdf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdffcadf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asttf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_68_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
[{'user_name': 'jack', 'password': 'asdfasdf', 'user_id': 7}, <br/>
{'user_name': 'ed', 'password': 'asdffcadf', 'user_id': 8}, <br/>
{'user_name': 'fred', 'password': 'asttf', 'user_id': 9}]</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>



    
    <A name="sql_update"></a>
    
    <div class="sectionL2">

    <h3>Updates</h3>
    
    

<p>Updates work a lot like INSERTS, except there is an additional WHERE clause that can be specified.
</p>

    

    <div class="code">
            <div class="codetitle">Using update()</div>
        <pre><span class="python_comment"># change 'jack' to 'ed'
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_69', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_69_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'jack', 'user_name': 'ed'}</div><pre><span class="python_comment"># use bind parameters
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
                <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'newname'</span><span class="python_enclosure">)})</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_70', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">newname</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_70_div" class="codepop" style="display:none;">UPDATE users SET user_name=:newname WHERE users.user_name = :name<br/>
{'newname': 'ed', 'name': 'jack'}</div><pre><span class="python_comment"># update a column to another column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_71', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">:</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">})</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_71_div" class="codepop" style="display:none;">UPDATE users SET password=users.user_name<br/>
{}</div><pre><span class="python_comment"># expressions OK too
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_72', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">:</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">+ </span><span class="python_number">17</span><span class="python_enclosure">})</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_72_div" class="codepop" style="display:none;">UPDATE users SET user_id=users.user_id + :users_user_id<br/>
{'users_user_id':17}</div><pre><span class="python_comment"># multi-update
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_73', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fh5jks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fsr234ks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'7h5jse'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_73_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name, password=:password WHERE users.user_id = :id<br/>
[{'password': 'fh5jks', 'user_name': 'jack', 'id': 7}, <br/>
{'password': 'fsr234ks', 'user_name': 'ed', 'id': 8}, <br/>
{'password': '7h5jse', 'user_name': 'mary', 'id': 9}]</div><pre><span class="python_operator"></span></pre>
    </div>


    
    <A name="sql_update_correlated"></a>
    
    <div class="sectionL3">

    <h3>Correlated Updates</h3>
    
    

<p>A correlated update lets you update a table using selection from another table, or the same table:
</p>

    

    <div class="code">
        <pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_74', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span>
    <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator"><</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
    <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">:</span><span class="python_name">s</span><span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_74_div" class="codepop" style="display:none;">UPDATE users SET user_name=(SELECT addresses.city <br/>
FROM addresses <br/>
WHERE addresses.user_id = users.user_id) <br/>
WHERE users.user_id > :users_user_id AND users.user_id < :users_user_id_1<br/>
{'users_user_id_1': 20, 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#sql">back to section top</a>
    </div>




    </div>



    
    <A name="sql_delete"></a>
    
    <div class="sectionL2">

    <h3>Deletes</h3>
    
    

<p>A delete is formulated like an update, except theres no values:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jack%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Ed%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jane%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">exists</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre>
    </div>




            <a href="#sql">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="datamapping"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#sql">Constructing SQL Queries via Python Expressions</a>

               |   
            Next: <a href="#unitofwork">Session / Unit of Work</a>
    </div>

        <h2>Data Mapping</h2>
    </div>


        








    
    <A name="datamapping"></a>
    
    <div class="sectionL1">

    
    



    
    <A name="datamapping_datamapping"></a>
    
    <div class="sectionL2">

    <h3>Basic Data Mapping</h3>
    
    

<p>Data mapping describes the process of defining <em>Mapper</em> objects, which associate table metadata with user-defined classes.
</p>
<p>The <code>Mapper</code>'s role is to perform SQL operations upon the database, associating individual table rows with instances of those classes, and individual database columns with properties upon those instances, to transparently associate in-memory objects with a persistent database representation. 
</p>
<p>When a <code>Mapper</code> is created to associate a <code>Table</code> object with a class, all of the columns defined in the <code>Table</code> object are associated with the class via property accessors, which add overriding functionality to the normal process of setting and getting object attributes.  These property accessors keep track of changes to object attributes; these changes will be stored to the database when the application "flushes" the current state of objects (known as a <em>Unit of Work</em>).
</p>
<p>Two objects provide the primary interface for interacting with Mappers and the "unit of work", which are the <code>Query</code> object and the <code>Session</code> object.  <code>Query</code> deals with selecting objects from the database, whereas <code>Session</code> provides a context for loaded objects and the ability to communicate changes on those objects back to the database.
</p>
<p>The primary method on <code>Query</code> for loading objects is its <code>select()</code> method, which has similar arguments to a <code>sqlalchemy.sql.Select</code> object.  But this select method executes automatically and returns results, instead of awaiting an execute() call.  Instead of returning a cursor-like object, it returns an array of objects.
</p>
<p>The three configurational elements to be defined, i.e. the <code>Table</code> metadata, the user-defined class, and the <code>Mapper</code>, are typically defined as module-level variables, and may be defined in any fashion suitable to the application, with the only requirement being that the class and table metadata are described before the mapper.  For the sake of example, we will be defining these elements close together, but this should not be construed as a requirement; since SQLAlchemy is not a framework, those decisions are left to the developer or an external framework.
</p>
<p>Also, keep in mind that the examples in this section deal with explicit <code>Session</code> objects mapped directly to <code>Engine</code> objects, which represents the most explicit style of using the ORM.  Options exist for how this is configured, including binding <code>Table</code> objects directly to <code>Engines</code> (described in <a href="#metadata_tables_binding">Binding MetaData to an Engine</a>), as well as using an auto-generating "contextual" session via the SessionContext plugin (described in <a href="#plugins_sessioncontext">SessionContext</a>).
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_synopsis"></a>
    
    <div class="sectionL2">

    <h3>Synopsis</h3>
    
    

<p>Starting with a <code>Table</code> definition and a minimal class construct, the two are associated with each other via the <code>mapper()</code> function [<a href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper_Mapper">api</a>], which generates an object called a <code>Mapper</code>.  SA associates the class and all instances of that class with this particular <code>Mapper</code>, which is then stored in a global registry.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># metadata
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># table object
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'fullname'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definition 
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># create a mapper and associate it with the User class.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Thats all for configuration.  Next, we will create an <code>Engine</code> and bind it to a <code>Session</code>, which represents a local collection of mapped objects to be operated upon.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># engine
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">"sqlite://mydb.db"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># session
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>session</code> represents a "workspace" which can load objects and persist changes to the database.  A <code>Session</code> [<a href="#unitofwork">doc</a>] [<a href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_Session">api</a>] is best created as local to a particular set of related data operations, such as scoped within a function call, or within a single application request cycle.  Next we illustrate a rudimental query which will load a single object instance.  We will modify one of its attributes and persist the change back to the database.
</p>

    

    <div class="code">
        <pre><span class="python_comment"># select
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_75', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">selectfirst_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_75_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name ORDER BY users.oid LIMIT 1<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred jones'</span><span class="python_operator">
</span>
<span class="python_comment"># flush - saves everything that changed
# within the scope of our Session
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_76', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_76_div" class="codepop" style="display:none;">BEGIN<br/>
UPDATE users SET user_name=:user_name <br/>
 WHERE users.user_id = :user_id<br/>
[{'user_name': 'fred jones', 'user_id': 1}]        <br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Things to note from the above include that the loaded <code>User</code> object has an attribute named <code>user_name</code> on it, which corresponds to the <code>user_name</code> column in the <code>users_table</code>; this attribute was configured at the class level when the <code>Mapper</code> which we created first compiled itself.  Our modify operation on this attribute caused the object to be marked as <code>dirty</code>, which was picked up automatically within the subsequent <code>flush()</code> process.  The <code>flush()</code> is the point at which all changes to objects within the <code>Session</code> are persisted to the database, and the <code>User</code> object is no longer marked as <code>dirty</code> until it is again modified.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_query"></a>
    
    <div class="sectionL2">

    <h3>The Query Object</h3>
    
    

<p>The method <code>session.query(class_or_mapper)</code> returns a <code>Query</code> object [<a href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_Query">api</a>].  <code>Query</code> implements a large set of methods which are used to produce and execute select statements tailored for loading object instances.  It returns objects in most cases either as lists of objects or as single instances, depending on the type of query issued.
</p>
<p>A <code>Query</code> is always initially generated starting with the <code>Session</code> that we're working with, and is always created relative to a particular class, which is the primary class we wish to load.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># get a query from a Session based on class:
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Alternatively, an actual <code>Mapper</code> instance can be specified instead of a class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># locate the mapper corresponding to the User class
</span><span class="python_name">usermapper </span><span class="python_operator">= </span><span class="python_name">class_mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create query for the User
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">usermapper</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Dealing with mappers explicitly as above is usually not needed except for more advanced patterns where a class may have multiple mappers associated with it.
</p>
<p>Once we have a query, we can start loading objects.  The two most rudimental and general purpose methods are <code>select()</code> and <code>select_by()</code>.  <code>select()</code> is oriented towards query criterion constructed as a <code>ClauseElement</code> object, which is the kind of object generated when constructing SQL expressions as described in the <a href="#sql">SQL</a> section.  <code>select_by()</code> can also accomodate <code>ClauseElement</code> objects but is generally more oriented towards keyword arguments which correspond to mapped attribute names.  In both cases, the criterion specified is used to construct the <code>WHERE</code> criterion of the generated SQL.  The <code>Query</code> object will use this criterion to <strong>compile</strong> the full SQL query issued to the database, combining the <code>WHERE</code> condition with the appropriate column selection clauses and <code>FROM</code> criterion, incuding whatever modifications are required to control ordering, number of rows returned, joins for loading related objects, etc.
</p>
<p>The general form of <code>select_by()</code> is:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">def </span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">clause_elements</span><span class="python_operator">, **</span><span class="python_name">keyword_criterion</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Where <code>*clause_elements</code> is a set of zero or more <code>ClauseElement</code> objects, and <code>**keyword_criterion</code> are key/value pairs each of which correspond to a simple equality comparison.  The full set of clause elements and key/value pairs are joined together in the resulting SQL statement via <code>AND</code>.
</p>

    

    <div class="code">
        <pre><span class="python_comment"># using select_by with keyword arguments
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_77', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">'John Smith'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_77_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name AND users.fullname = :users_fullname<br/>
ORDER BY users.oid<br/>
{'users_user_name': 'john', 'users_fullname': 'John Smith'}</div><pre><span class="python_comment"># using select_by with preceding ClauseElements followed by keywords
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">224</span><span class="python_operator">, </span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_78', 'show', 'hide')" class="codepoplink">sql</a>        </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">'John Smith'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_78_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_id>:users_user_id AND users.user_name = :users_user_name <br/>
AND users.fullname = :users_fullname<br/>
ORDER BY users.oid<br/>
{'users_user_name': 'john', 'users_fullname': 'John Smith', 'users_user_id': 224}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Note that a <code>ClauseElement</code> is generated by each boolean operator (i.e. <code>==</code>, <code>&gt;</code>) that's performed against a <code>Column</code> object - recall that this operator is overloaded to return a binary clause construct.  But the <code>fullname=&quot;John Smith&quot;</code> argument is not using any kind of overloading, and is a regular Python keyword argument.   Additionally, while <code>ClauseElements</code> are constructed against the <code>Column</code> elements configured on the mapped <code>Table</code>, the keyword-based criterion is constructed against the class-level attribute names which were configured by the mapper.  While they are the same name as their columns in this particular example, they can be configured to have names distinct from their columns.  So it follows that using <code>ClauseElements</code> for criterion are closer to the relational side of things, and using keyword arguments are closer towards the domain object side of things.
</p>
<p>The <code>select()</code> method, unlike the <code>select_by()</code> method, is purely <code>ClauseElement</code>/relationally oriented and has no domain-level awareness.  Its basic argument signature:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">def </span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">clause_element</span><span class="python_operator">, **</span><span class="python_name">additional_options</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>clause_element</code> argument again represents a <code>ClauseElement</code> which corresponds to the <code>WHERE</code> criterion of a <code>SELECT</code> statement.  Here, there is only a single <code>ClauseElement</code> and it will be used to form the entire set of criterion.  A basic <code>select()</code> operation looks like this:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>To generate <code>AND</code> criterion the way <code>select_by()</code> does, you use the <code>and_()</code> construct from the sql construction system, which generates just another <code>ClauseElement</code> containing two sub-<code>ClauseElement</code>s:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_operator">, </span>
    <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">==</span><span class="python_literal">'John Smith'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>From this, one can see that <code>select()</code> is stricter in its operation and does not make any kind of assumptions about how to join multiple criterion together.  Of course in all cases where <code>ClauseElement</code> is used, any expression can be created using combinations of <code>and_()</code>, <code>or_()</code>, <code>not_()</code>, etc.
</p>

    

    <div class="code">
        <pre><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_79', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_79_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name  OR users.user_name = :users_user_name_1<br/>
ORDER BY users.oid<br/>
{'users_user_name': 'john', 'users_user_name_1': 'fred'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The keyword portion of <code>select()</code> is used to indicate further modifications to the generated SQL, including common arguments like ordering, limits and offsets:
</p>

    

    <div class="code">
        <pre><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_operator">, </span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_80', 'show', 'hide')" class="codepoplink">sql</a>            </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_80_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name <br/>
ORDER BY users.fullname LIMIT 10 OFFSET 12<br/>
{'users_user_name': 'john'}</div><pre><span class="python_operator"></span></pre>
    </div>


    
    <A name="datamapping_query_fullselect"></a>
    
    <div class="sectionL3">

    <h3>Issuing Full SELECT statements</h3>
    
    

<p><code>select()</code> also provides an additional calling style, which is to pass a fully constructed <code>Select</code> construct to it.
</p>

    

    <div class="code">
        <pre><span class="python_comment"># using a full select object
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_81', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre><div id="popbox_81_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'john'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>When a full select is passed, the <code>Query</code> object does not generate its own SQL.  Instead, the select construct passed in is used without modification, except that its <code>use_labels</code> flag is switched on to prevent column name collisions.  Therefore its expected that the construct will include the proper column clause as appropriate to the mapped class being loaded.
</p>
<p>The techniques used when querying with a full select construct are similar to another query method called <code>instances()</code>, which is described in <a href="#advdatamapping_resultset">Result-Set Mapping</a>.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_query_callingstyles"></a>
    
    <div class="sectionL3">

    <h3>Two General Calling Styles</h3>
    
    

<p>The twin calling styles presented by <code>select()</code> and <code>select_by()</code> are mirrored in several other methods on <code>Query</code>.  For each method that indicates a verb such as <code>select()</code> and accepts a single <code>ClauseElement</code> followed by keyword-based options, the <code>_by()</code> version accepts a list of <code>ClauseElement</code> objects followed by keyword-based argument criterion.  These include:
</p>
<ul>
 <li>
     <code>selectfirst()</code> / <code>selectfirst_by()</code> - select with LIMIT 1 and return a single object instance
 </li>

 <li>
     <code>selectone()</code> / <code>selectone_by()</code> - select with LIMIT 2, assert that only one row is present, and return a single object instance
 </li>

 <li>
     <code>filter()</code> / <code>filter_by()</code> - apply the criterion to the <code>Query</code> object generatively, and return a new <code>Query</code> object with the criterion built in.
 </li>

 <li>
     <code>count()</code> / <code>count_by()</code> - return the total number of object instances that would be returned.
 </li>
</ul>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_query_primarykey"></a>
    
    <div class="sectionL3">

    <h3>Loading by Primary Key</h3>
    
    

<p>The <code>get()</code> method loads a single instance, given the primary key value of the desired entity:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># load user with primary key 15
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>get()</code> method, because it has the actual primary key value of the instance, can return an already-loaded instance from the <code>Session</code> without performing any SQL.  It is the only method on <code>Query</code> that does not issue SQL to the database in all cases.
</p>
<p>To issue a composite primary key to <code>get()</code>, use a tuple.  The order of the arguments matches that of the table meta data.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">((</span><span class="python_number">27</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'receipts'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>Another special method on <code>Query</code> is <code>load()</code>.  This method has the same signature as <code>get()</code>, except it always <strong>refreshes</strong> the returned instance with the latest data from the database.  This is in fact a unique behavior, since as we will see in the <a href="#unitofwork">Session / Unit of Work</a> chapter, the <code>Query</code> usually does not refresh the contents of instances which are already present in the session.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_query_columnsonclass"></a>
    
    <div class="sectionL3">

    <h3>Column Objects Available via their Mapped Class</h3>
    
    

<p>Some of the above examples above illustrate the usage of the mapper's Table object to provide the columns for a WHERE Clause.  These columns are also accessible off of the mapped class directly.  When a mapper is assigned to a class, it also attaches a special property accessor <code>c</code> to the class itself, which can be used just like the table metadata to access the columns of the table:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_query_generative"></a>
    
    <div class="sectionL3">

    <h3>Generative Query Methods</h3>
    
    

<p>The <code>filter()</code> and <code>filter_by()</code> methods on <code>Query</code> are known as "generative" methods, in that instead of returning results, they return a newly constructed <code>Query</code> object which contains the "filter" criterion as part of its internal state.  This is another method of stringing together criterion via <code>AND</code> clauses.  But when using the <code>Query</code> generatively, it becomes a much more flexible object, as there are generative methods for adding all kinds of criterion and modifiers, some of which are relationally oriented and others which are domain oriented.  The key behavior of a "generative" method is that calling it produces a <strong>new</strong> <code>Query</code> object, which contains all the attributes of the previous <code>Query</code> object plus some new modifications.  <br></br>
</p>

    

    <div class="code">
        <pre><span class="python_comment"># create a Query
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)   </span><span class="python_operator">
</span>
<span class="python_comment"># filter by user_name property using filter_by()
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">"john"</span><span class="python_enclosure">) </span><span class="python_operator">
</span>
<span class="python_comment"># filter by email address column using filter()
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">==</span><span class="python_literal">"John Smith"</span><span class="python_enclosure">)  </span><span class="python_operator">
</span>
<span class="python_comment"># execute - the list() method returns a list.  this is equivalent to just saying query.select()
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_82', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_82_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.fullname as users_fullname,<br/>
users.password AS users_password, users.user_id AS users_user_id <br/>
FROM users <br/>
WHERE ((users.user_name = :users_user_name) <br/>
AND users.fullname = :users_fullname) ORDER BY users.oid</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Other generative behavior includes list-based indexing and slice operations, which translate into <code>LIMIT</code> and <code>OFFSET</code> criterion:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_83', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">user_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'j%'</span><span class="python_enclosure">))[</span><span class="python_number">20</span><span class="python_operator">:</span><span class="python_number">30</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_83_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.fullname as users_fullname,<br/>
users.password AS users_password, users.user_id AS users_user_id <br/>
FROM users <br/>
WHERE users.fullname LIKE :users_fullname <br/>
ORDER BY users.oid LIMIT 10 OFFSET 20<br/>
{'users_fullname': 'j%'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Iterable behavior:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">for </span><span class="python_name">user </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'john'</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># etc.</span><span class="python_operator"></span></pre>
    </div>
<p>Applying modifiers generatively:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_84', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">user_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'j%'</span><span class="python_enclosure">))</span><span class="python_operator">.
    </span><span class="python_name">limit</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">offset</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">user_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_84_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.fullname as users_fullname,<br/>
users.password AS users_password, users.user_id AS users_user_id <br/>
FROM users <br/>
WHERE users.fullname LIKE :users_fullname <br/>
ORDER BY users.user_id LIMIT 10 OFFSET 20</div><pre><span class="python_operator"></span></pre>
    </div>
<p>There is no restriction to mixing the "generative" methods like <code>filter()</code>, <code>join()</code>, <code>order_by()</code> etc. with the "non-generative" methods like <code>select()</code> and <code>select_by()</code>.  The only difference is that <code>select...</code> methods return results immediately, whereas generative methods return a new <code>Query</code> from which results can be retrieved using any number of methods such as <code>list()</code>, <code>select()</code>, <code>select_by()</code>, <code>selectfirst()</code>, etc.  Options that are specified to the <code>select...</code> methods build upon options that were already built up generatively.
</p>
<p>The <code>Query</code> object will be described further in subsequent sections dealing with joins.  Also, be sure to consult the full generated documentation for <code>Query</code>: <a href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_Query">Query</a>.
</p>



            <a href="#datamapping">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_saving"></a>
    
    <div class="sectionL2">

    <h3>Saving Objects</h3>
    
    

<p>When objects corresponding to mapped classes are created or manipulated, all changes are logged by the <code>Session</code> object.  The changes are then written to the database when an application calls <code>flush()</code>.  This pattern is known as a <em>Unit of Work</em>, and has many advantages over saving individual objects or attributes on those objects with individual method invocations.  Domain models can be built with far greater complexity with no concern over the order of saves and deletes, excessive database round-trips and write operations, or deadlocking issues.  The <code>flush()</code> operation batches its SQL statements into a transaction, and can also perform optimistic concurrency checks (using a version id column) to ensure the proper number of rows were in fact affected. 
</p>
<p>The Unit of Work is a powerful tool, and has some important concepts that should be understood in order to use it effectively.  See the <a href="#unitofwork">Session / Unit of Work</a> section for a full description on all its operations.
</p>
<p>When a mapper is created, the target class has its mapped properties decorated by specialized property accessors that track changes.  New objects by default must be explicitly added to the <code>Session</code> using the <code>save()</code> method:
</p>

    

    <div class="code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a new User
</span><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'jane'</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'hello123'</span><span class="python_operator">
</span>
<span class="python_comment"># create another new User      
</span><span class="python_name">myuser2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'ed'</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'lalalala'</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session and save them
</span><span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">myuser</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">myuser2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># load a third User from the database            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_85', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">myuser3 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_85_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_name">myuser3</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fredjones'</span><span class="python_operator">
</span>
<span class="python_comment"># save all changes            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_86', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_86_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name<br/>
WHERE users.user_id =:users_user_id<br/>
[{'users_user_id': 1, 'user_name': 'fredjones'}]<br/>
INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'hello123', 'user_name': 'jane'}<br/>
INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'lalalala', 'user_name': 'ed'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The requirement that new instances be explicitly stored in the <code>Session</code> via <code>save()</code> operation can be modified by using the <a href="#plugins_sessioncontext">SessionContext</a> extension module.
</p>
<p>The mapped class can also specify whatever methods and/or constructor it wants:
</p>

    

    <div class="code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_name</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"User id %s name %s password %s" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_87', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_87_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'foo', 'user_name': 'john'}</div><pre><span class="python_literal">>>> </span><span class="python_name">u</span><span class="python_operator">
</span><span class="python_name">User id </span><span class="python_number">1 </span><span class="python_name">name </span><span class="python_literal">'john' </span><span class="python_name">password </span><span class="python_literal">'foo'</span><span class="python_operator"></span></pre>
    </div>
<p>Note that the <strong>__init__() method is not called when the instance is loaded</strong>.  This is so that classes can define operations that are specific to their initial construction which are not re-called when the object is restored from the database, and is similar in concept to how Python's <code>pickle</code> module calls <code>__new__()</code> when deserializing instances.  To allow <code>__init__()</code> to be called at object load time, or to define any other sort of on-load operation, create a <code>MapperExtension</code> which supplies the <code>create_instance()</code> method (see <a href="#advdatamapping_extending">Extending Mapper</a>, as well as the example in the FAQ).
</p>
<p>SQLAlchemy will only place columns into UPDATE statements for which the value of the attribute has changed.  This is to conserve database traffic and also to successfully interact with a "deferred" attribute, which is a mapped object attribute against the mapper's primary table that isnt loaded until referenced by the application.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_relations"></a>
    
    <div class="sectionL2">

    <h3>Defining and Using Relationships</h3>
    
    

<p>So that covers how to map the columns in a table to an object, how to load objects, create new ones, and save changes.  The next step is how to define an object's relationships to other database-persisted objects.  This is done via the <code>relation</code> function [<a href="#advdatamapping_properties_relationoptions">doc</a>][<a href="#docstrings_sqlalchemy.orm_modfunc_relation">api</a>] provided by the <code>orm</code> module.
</p>


    
    <A name="datamapping_relations_onetomany"></a>
    
    <div class="sectionL3">

    <h3>One to Many</h3>
    
    

<p>With our User class, lets also define the User has having one or more mailing addresses.  First, the table metadata:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># define user table
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define user address table
</span><span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Of importance here is the addresses table's definition of a <em>foreign key</em> relationship to the users table, relating the user_id column into a parent-child relationship.  When a <code>Mapper</code> wants to indicate a relation of one object to another, the <code>ForeignKey</code> relationships are the default method by which the relationship is determined (options also exist to describe the relationships explicitly).
</p>
<p>So then lets define two classes, the familiar <code>User</code> class, as well as an <code>Address</code> class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">, </span><span class="python_name">city</span><span class="python_operator">, </span><span class="python_name">state</span><span class="python_operator">, </span><span class="python_name">zip</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">= </span><span class="python_name">street</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">city </span><span class="python_operator">= </span><span class="python_name">city</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">state </span><span class="python_operator">= </span><span class="python_name">state</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">zip </span><span class="python_operator">= </span><span class="python_name">zip</span><span class="python_operator"></span></pre>
    </div>
<p>And then a <code>Mapper</code> that will define a relationship of the <code>User</code> and the <code>Address</code> classes to each other as well as their table metadata.  We will add an additional mapper keyword argument <code>properties</code> which is a dictionary relating the names of class attributes to database relationships, in this case a <code>relation</code> object against a newly defined mapper for the Address class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Lets do some operations with these classes and see what happens:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///mydb.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'hihilala'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'hihilala', 'user_name': 'jane'}<br/>
INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'big city', 'state': 'UT', 'street': '123 anywhere street', 'user_id':1, 'zip': '76543'}<br/>
INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'some other city', 'state': 'OK', 'street': '1 Park Place', 'user_id':1, 'zip': '83923'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>A lot just happened there!  The <code>Mapper</code> figured out how to relate rows in the addresses table to the users table, and also upon flush had to determine the proper order in which to insert rows.  After the insert, all the <code>User</code> and <code>Address</code> objects have their new primary and foreign key attributes populated.
</p>
<p>Also notice that when we created a <code>Mapper</code> on the <code>User</code> class which defined an <code>addresses</code> relation, the newly created <code>User</code> instance magically had an "addresses" attribute which behaved like a list.   This list is in reality a Python <code>property</code> which will return an instance of <code>sqlalchemy.orm.attributes.InstrumentedList</code>.  This is a generic collection-bearing object which can represent lists, sets, dictionaries, or any user-defined collection class which has an <code>append()</code> method.  By default it represents a list:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">UPDATE addresses SET user_id=:user_id<br/>
 WHERE addresses.address_id = :addresses_address_id<br/>
[{'user_id': None, 'addresses_address_id': 2}]<br/>
INSERT INTO addresses (user_id, street, city, state, zip) <br/>
VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Note that when creating a relation with the <code>relation()</code> function, the target can either be a class, in which case the primary mapper for that class is used as the target, or a <code>Mapper</code> instance itself, as returned by the <code>mapper()</code> function.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_relations_lifecycle"></a>
    
    <div class="sectionL3">

    <h3>Lifecycle Relations</h3>
    
    

<p>In the previous example, a single address was removed from the <code>addresses</code> attribute of a <code>User</code> object, resulting in the corresponding database row being updated to have a user_id of <code>None</code>.  But now, theres a mailing address with no user_id floating around in the database of no use to anyone.  How can we avoid this ?  This is acheived by using the <code>cascade</code> parameter of <code>relation</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">clear_mappers</span><span class="python_enclosure">()  </span><span class="python_comment"># clear mappers from the previous example</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO addresses (user_id, street, city, state, zip) <br/>
VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}<br/>
DELETE FROM addresses WHERE addresses.address_id = :address_id<br/>
[{'address_id': 2}]</div><pre><span class="python_operator"></span></pre>
    </div>
<p>In this case, with the <code>delete-orphan</code> <strong>cascade rule</strong> set, the element that was removed from the addresses list was also removed from the database.  Specifying <code>cascade=&quot;all, delete-orphan&quot;</code> means that every persistence operation performed on the parent object will be <em>cascaded</em> to the child object or objects handled by the relation, and additionally that each child object cannot exist without being attached to a parent.  Such a relationship indicates that the <strong>lifecycle</strong> of the <code>Address</code> objects are bounded by that of their parent <code>User</code> object.
</p>
<p>Cascading is described fully in <a href="#unitofwork_cascade">Cascade rules</a>.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_relations_backreferences"></a>
    
    <div class="sectionL3">

    <h3>Backreferences</h3>
    
    

<p>By creating relations with the <code>backref</code> keyword, a bi-directional relationship can be created which will keep both ends of the relationship updated automatically, independently of database operations.  Below, the <code>User</code> mapper is created with an <code>addresses</code> property, and the corresponding <code>Address</code> mapper receives a "backreference" to the <code>User</code> object via the property name <code>user</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">Address </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'user'</span><span class="python_enclosure">)</span>
            <span class="python_enclosure">}</span>
          <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'hi'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a2 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># append a1 to u
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">a1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># attach u to a2
</span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">u</span><span class="python_operator">
</span>
<span class="python_comment"># the bi-directional relation is maintained
</span><span class="python_literal">>>> </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses </span><span class="python_operator">== </span><span class="python_enclosure">[</span><span class="python_name">a1</span><span class="python_operator">, </span><span class="python_name">a2</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user </span><span class="python_keyword">and </span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>The backreference feature also works with many-to-many relationships, which are described later.  When creating a backreference, a corresponding property (i.e. a second <code>relation()</code>) is placed on the child mapper.  The default arguments to this property can be overridden using the <code>backref()</code> function:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>backref()</code> function is often used to set up a bi-directional one-to-one relationship.  This is because the <code>relation()</code> function by default creates a "one-to-many" relationship when presented with a primary key/foreign key relationship, but the <code>backref()</code> function can redefine the <code>uselist</code> property to make it a scalar:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'address'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_selectrelations"></a>
    
    <div class="sectionL2">

    <h3>Selecting from Relationships</h3>
    
    

<p>We've seen how the <code>relation</code> specifier affects the saving of an object and its child items, how does it affect selecting them?  By default, the relation keyword indicates that the related property should be attached a <em>lazy loader</em> when instances of the parent object are loaded from the database; this is just a callable function that when accessed will invoke a second SQL query to load the child objects of the parent.
</p>

    

    <div class="code">
        <pre><span class="python_comment"># define a mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
      <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># select users where username is 'jane', get the first element of the list
# this will incur a load operation for the parent table
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_88', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jane'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_88_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users WHERE users.user_name = :users_user_name ORDER BY users.oid<br/>
{'users_user_name': 'jane'}</div><pre><span class="python_comment"># iterate through the User object's addresses.  this will incur an
# immediate load of those child items
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_89', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:</span></pre><div id="popbox_89_div" class="codepop" style="display:none;">SELECT addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip FROM addresses<br/>
WHERE addresses.user_id = :users_user_id ORDER BY addresses.oid<br/>
{'users_user_id': 1}</div><pre><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="datamapping_selectrelations_queryjoins"></a>
    
    <div class="sectionL3">

    <h3>Selecting With Joins</h3>
    
    

<p>When using mappers that have relationships to other mappers, the need to specify query criterion across multiple tables arises.  SQLAlchemy provides several core techniques which offer this functionality.
</p>
<p>When specifying columns to the <code>select()</code> method (including variants like <code>selectfirst()</code>, <code>selectone()</code>, etc.) or the generative <code>filter()</code> method of <code>Query</code>, if the columns are attached to a table other than the mapped table, that table is automatically added to the "FROM" clause of the query.  This is the same behavior that occurs when creating a non-ORM <code>select</code> object.  Using this feature, joins can be created when querying:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_90', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
             <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre><div id="popbox_90_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users, addresses <br/>
WHERE users.user_id=addresses.user_id<br/>
AND addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Above, we specified selection criterion that included columns from both the <code>users</code> and the <code>addresses</code> table.  Note that in this case, we had to specify not just the matching condition to the <code>street</code> column on <code>addresses</code>, but also the join condition between the <code>users</code> and <code>addresses</code> table.  Even though the <code>User</code> mapper has a relationship to the <code>Address</code> mapper where the join condition is known, <strong>the select method does not assume how you want to construct joins</strong>.  If we did not include the join clause, we would get:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># this is usually not what you want to do
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_91', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_91_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users, addresses <br/>
WHERE addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The above join will return all rows of the <code>users</code> table, even those that do not correspond to the <code>addresses</code> table, in a <strong>cartesian product</strong> with the matching rows from the <code>addresses</code> table.
</p>
<p>Another way to specify joins more explicitly is to use the <code>from_obj</code> parameter of <code>select()</code>, or the generative <code>select_from()</code> method.  These allow you to explicitly place elements in the FROM clause of the query, which could include lists of tables and/or <code>Join</code> constructs:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_92', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_operator">, </span>
                <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre><div id="popbox_92_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users JOIN addresses ON users.user_id=addresses.user_id<br/>
WHERE addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>In the above example, the <code>join()</code> function by default creates a natural join between the two tables, so we were able to avoid having to specify the join condition between <code>users</code> and <code>addresses</code> explicitly.
</p>
<p>Using a generative approach:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_93', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator">.
            </span><span class="python_name">select_from</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_93_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users JOIN addresses ON users.user_id=addresses.user_id<br/>
WHERE addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Note that <code>select_from()</code> takes either a single scalar element or a list of selectables (i.e. <code>select_from([table1, table2, table3.join(table4), ...])</code>), which are added to the current list of "from" elements.  As is the behavior of constructed SQL, <code>join</code> elements used in the <code>from_obj</code> parameter or the <code>select_from()</code> method will replace instances of the individual tables they represent.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_selectrelations_relselectby"></a>
    
    <div class="sectionL3">

    <h3>Creating Joins Using filter_by() and select_by()</h3>
    
    

<p>Another way that joins can be created is by using the <code>select_by</code> method or the generative <code>filter_by</code> methods of <code>Query</code>, which have the ability to create joins across relationships automatically.  These methods are in many circumstances more convenient than, but not as flexible as, the more SQL-level approach using the <code>select()</code>/<code>select_from()</code> methods described in the previous section.
</p>
<p>To issue a join using <code>select_by()</code>, just specify a key in the keyword-based argument list which is not present in the primary mapper's list of properties or columns, but <em>is</em> present in the property list of some relationship down the line of objects.  The <code>Query</code> object will recursively traverse along the mapped relationships starting with the lead class and descending into child classes, until it finds a property matching the given name.  For each new mapper it encounters along the path to the located property, it constructs a join across that relationship:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_94', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_94_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users, addresses <br/>
WHERE users.user_id=addresses.user_id<br/>
AND addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The above example is shorthand for:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
         <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
         <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span>
   <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p><code>select_by()</code> and its related functions can compare not only column-based attributes to column-based values, but also relations to object instances:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># get an instance of Address. assume its primary key identity
# is 12.
</span><span class="python_name">someaddress </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># look for User instances which have the 
# "someaddress" instance in their "addresses" collection
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_95', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">=</span><span class="python_name">someaddress</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_95_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users, addresses <br/>
WHERE users.user_id=addresses.user_id<br/>
AND addresses.address_id=:addresses_address_id<br/>
ORDER BY users.oid<br/>
{'addresses_addresses_id': 12}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Where above, the comparison denoted by <code>addresses=someaddress</code> is constructed by comparing all the primary key columns in the <code>Address</code> mapper to each corresponding primary key value in the <code>someaddress</code> entity.  In other words, its equivalent to saying <code>select_by(address_id=someaddress.address_id)</code>.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_selectrelations_jointo"></a>
    
    <div class="sectionL3">

    <h3>Generating Join Criterion Using join()</h3>
    
    

<p>The <code>join()</code> method is a generative method which can apply join conditions to a <code>Query</code> based on the names of relationships, using a similar mechanism as that of <code>select_by()</code> and similar methods.  By specifying the string name of a relation as its only argument, the resulting <code>Query</code> will automatically join from the starting class' mapper to the target mapper, indicated by searching for a relationship of that name along the relationship path.
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_96', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_96_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.password AS users_password, <br/>
users.user_id AS users_user_id <br/>
FROM users JOIN addresses ON users.user_id = addresses.user_id <br/>
ORDER BY users.oid</div><pre><span class="python_operator"></span></pre>
    </div>
<p>One drawback of this method of locating a relationship is that its not <em>deterministic</em>.   If the same relationship name occurs on more than one traversal path, its only possible to locate one of those relationships.  Similarly, if relationships are added to mapped classes, queries that worked fine may suddenly experience a similar conflict and produce unexpected results.
</p>
<p>So to specify a deterministic path to <code>join()</code>, send the relationship name or a path of names as a list.  Such as:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">([</span><span class="python_literal">'addresses'</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>Where above, if the "addresses" relation is not present directly on the <code>User</code> class, an error is raised.
</p>
<p>To traverse more deeply into relationships, specify multiple relationship names in the order in which they are constructed:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">orders </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">([</span><span class="python_literal">'customer'</span><span class="python_operator">, </span><span class="python_literal">'addresses'</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">=</span><span class="python_literal">"foo@bar.com"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>For those familiar with older versions of <code>Query</code>, the <code>join()</code> method is an easier-to-use version of the <code>join_by()</code>, <code>join_to()</code> and <code>join_via()</code> methods, all of which produce <code>ClauseElements</code> that can be constructed into a query criterion.  Consult the generated documentation for information on these methods.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_selectrelations_joinparent"></a>
    
    <div class="sectionL3">

    <h3>Joining from a Parent Object</h3>
    
    

<p>(new in 0.3.7) To help in navigating collections, the <code>with_parent()</code> generative method adds criterion which corresponds to instances which belong to a particular parent.  This method makes use of the same "lazy loading" criterion used to load relationships normally, which means for a typical non-many-to-many relationship it will <strong>not</strong> actually create a join, and instead places bind parameters at the point at which the parent table's columns are normally specified.  This means you get a lighter weight query which also works with self-referential relationships, which otherwise would require an explicit <code>alias</code> object in order to create self-joins.  For example, to load all the <code>Address</code> objects which belong to a particular <code>User</code>:
</p>

    

    <div class="code">
        <pre><span class="python_comment"># load a user
</span><span class="python_name">someuser </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># load the addresses of that user
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_97', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_parent</span><span class="python_enclosure">(</span><span class="python_name">someuser</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_97_div" class="codepop" style="display:none;">SELECT addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip FROM addresses<br/>
WHERE addresses.user_id = :users_user_id ORDER BY addresses.oid<br/>
{'users_user_id': 1}</div><pre><span class="python_comment"># filter the results
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_98', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">someaddresses </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_parent</span><span class="python_enclosure">(</span><span class="python_name">someuser</span><span class="python_enclosure">)</span><span class="python_operator">.
    </span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">=</span><span class="python_literal">"foo@bar.com"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_98_div" class="codepop" style="display:none;">SELECT addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip FROM addresses<br/>
WHERE addresses.email_address =  :addresses_email_address AND <br/>
addresses.user_id = :users_user_id ORDER BY addresses.oid<br/>
{'users_user_id': 1, 'addresses_email_address': 'foo@bar.com'}</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_selectrelations_eagerload"></a>
    
    <div class="sectionL3">

    <h3>Eager Loading</h3>
    
    

<p>Eager Loading describes the loading of parent and child objects across a relation using a single query.  The purpose of eager loading is strictly one of performance enhancement; eager loading has <strong>no impact</strong> on the results of a query, except that when traversing child objects within the results, lazy loaders will not need to issue separate queries to load those child objects.
</p>
<p>Eager Loading is enabled on a per-relationship basis, either as the default
   for a particular relationship, or for a single query using query options,
   described later.
</p>
<p>With just a single parameter <code>lazy=False</code> specified to the relation object, the parent and child SQL queries can be joined together.
</p>

    

    <div class="code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_99', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'Jane'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_99_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.password AS users_password, <br/>
users.user_id AS users_user_id, addresses_4fb8.city AS addresses_4fb8_city, <br/>
addresses_4fb8.address_id AS addresses_4fb8_address_id, addresses_4fb8.user_id AS addresses_4fb8_user_id, <br/>
addresses_4fb8.zip AS addresses_4fb8_zip, addresses_4fb8.state AS addresses_4fb8_state, <br/>
addresses_4fb8.street AS addresses_4fb8_street <br/>
FROM users LEFT OUTER JOIN addresses AS addresses_4fb8 ON users.user_id = addresses_4fb8.user_id <br/>
WHERE users.user_name = :users_user_name ORDER BY users.oid, addresses_4fb8.oid<br/>
{'users_user_name': 'jane'}</div><pre><span class="python_keyword">for </span><span class="python_name">u </span><span class="python_keyword">in </span><span class="python_name">users</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:
        </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Above, a pretty ambitious query is generated just by specifying that the User should be loaded with its child Addresses in one query.  When the mapper processes the results, it uses an <em>Identity Map</em> to keep track of objects that were already loaded, based on their primary key identity.  Through this method, the redundant rows produced by the join are organized into the distinct object instances they represent.
</p>
<p>Recall that eager loading has no impact on the results of the query.  What if our query included our own join criterion?  The eager loading query accomodates this using aliases, and is immune to the effects of additional joins being specified in the original query.  To use our select_by example above, joining against the "addresses" table to locate users with a certain street results in this behavior:
</p>

    

    <div class="code">
        <pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_100', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_100_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, <br/>
users.password AS users_password, users.user_id AS users_user_id, <br/>
addresses_6ca7.city AS addresses_6ca7_city, <br/>
addresses_6ca7.address_id AS addresses_6ca7_address_id, <br/>
addresses_6ca7.user_id AS addresses_6ca7_user_id, <br/>
addresses_6ca7.zip AS addresses_6ca7_zip, addresses_6ca7.state AS addresses_6ca7_state, <br/>
addresses_6ca7.street AS addresses_6ca7_street <br/>
FROM addresses, users LEFT OUTER JOIN addresses AS addresses_6ca7 ON users.user_id = addresses_6ca7.user_id <br/>
WHERE addresses.street = :addresses_street AND users.user_id = addresses.user_id ORDER BY users.oid, addresses_6ca7.oid<br/>
{'addresses_street': '123 Green Street'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The join implied by passing the "street" parameter is separate from the join produced by the eager join, which is "aliasized" to prevent conflicts.
</p>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_selectrelations_options"></a>
    
    <div class="sectionL3">

    <h3>Using Options to Change the Loading Strategy</h3>
    
    

<p>The <code>options()</code> method on the <code>Query</code> object is a generative method that allows modifications to the underlying querying methodology.  The most common use of this feature is to change the "eager/lazy" loading behavior of a particular mapper, via the functions <code>eagerload()</code>, <code>lazyload()</code> and <code>noload()</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># user mapper with lazy addresses
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
             <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">))</span>
         <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query object
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make an eager loading query
</span><span class="python_name">eagerquery </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">eagerquery</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># make another query that wont load the addresses at all
</span><span class="python_name">plainquery </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># multiple options can be specified
</span><span class="python_name">myquery </span><span class="python_operator">= </span><span class="python_name">oldquery</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">lazyload</span><span class="python_enclosure">(</span><span class="python_literal">'tracker'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'streets'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'members'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># to specify a relation on a relation, separate the property names by a "."
</span><span class="python_name">myquery </span><span class="python_operator">= </span><span class="python_name">oldquery</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'orders.items'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_onetoone"></a>
    
    <div class="sectionL2">

    <h3>One to One/Many to One</h3>
    
    

<p>The above examples focused on the "one-to-many" relationship.  To do other forms of relationship is easy, as the <code>relation</code> function can usually figure out what you want:
</p>

    

    <div class="code">
        <pre><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store a user's preferences for a site
</span><span class="python_name">prefs_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'stylename'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'save_password'</span><span class="python_operator">, </span><span class="python_name">Boolean</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'timezone'</span><span class="python_operator">, </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># user table with a 'preference_id' column
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'preference_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"user_prefs.pref_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># engine and some test data
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">prefs_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">pref_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">stylename</span><span class="python_operator">=</span><span class="python_literal">'green'</span><span class="python_operator">, </span><span class="python_name">save_password</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">timezone</span><span class="python_operator">=</span><span class="python_literal">'EST'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'45nfss'</span><span class="python_operator">, </span><span class="python_name">preference_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># classes
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">UserPrefs</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">, </span><span class="python_name">prefs_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
    <span class="python_name">preferences </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_101', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_101_div" class="codepop" style="display:none;">SELECT users.preference_id AS users_preference_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, users.user_id AS users_user_id, <br/>
user_prefs_4eb2.timezone AS user_prefs_4eb2_timezone, user_prefs_4eb2.stylename AS user_prefs_4eb2_stylename, <br/>
user_prefs_4eb2.save_password AS user_prefs_4eb2_save_password, user_prefs_4eb2.pref_id AS user_prefs_4eb2_pref_id <br/>
FROM (SELECT users.user_id AS users_user_id FROM users WHERE users.user_name = :users_user_name ORDER BY users.oid <br/>
LIMIT 1 OFFSET 0) AS rowcount, <br/>
users LEFT OUTER JOIN user_prefs AS user_prefs_4eb2 ON user_prefs_4eb2.pref_id = users.preference_id <br/>
WHERE rowcount.users_user_id = users.user_id ORDER BY users.oid, user_prefs_4eb2.oid<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_name">save_password </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">save_password</span><span class="python_operator">
</span>
<span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">stylename </span><span class="python_operator">= </span><span class="python_literal">'bluesteel'</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_102', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_102_div" class="codepop" style="display:none;">UPDATE user_prefs SET stylename=:stylename<br/>
WHERE user_prefs.pref_id = :pref_id<br/>
[{'stylename': 'bluesteel', 'pref_id': 1}]</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_manytomany"></a>
    
    <div class="sectionL2">

    <h3>Many to Many</h3>
    
    

<p>The <code>relation</code> function handles a basic many-to-many relationship when you specify an association table using the <code>secondary</code> argument:
</p>

    

    <div class="code">
        <pre><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">articles_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'articles'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'headline'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">150</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'headline'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'body'</span><span class="python_operator">, </span><span class="python_name">TEXT</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'body'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">itemkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definitions
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that does many-to-many on the 'itemkeywords' association 
# table
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
    <span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">itemkeywords_table</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">headline </span><span class="python_operator">= </span><span class="python_literal">'a headline'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">body </span><span class="python_operator">= </span><span class="python_literal">'this is the body'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'politics'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'entertainment'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_103', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_103_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
{'name': 'politics'}<br/>
INSERT INTO keywords (name) VALUES (:name)<br/>
{'name': 'entertainment'}<br/>
INSERT INTO articles (article_headline, article_body) VALUES (:article_headline, :article_body)<br/>
{'article_body': 'this is the body', 'article_headline': 'a headline'}<br/>
INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
[{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]</div><pre><span class="python_comment"># select articles based on a keyword.  select_by will handle the extra joins.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_104', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">articles </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'politics'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_104_div" class="codepop" style="display:none;">SELECT keywords_e2f2.keyword_id AS keywords_e2f2_keyword_id, keywords_e2f2.keyword_name AS keywords_e2f2_keyword_name, <br/>
articles.headline AS articles_headline, articles.body AS articles_body, articles.article_id AS articles_article_id <br/>
FROM keywords, article_keywords, articles <br/>
LEFT OUTER JOIN article_keywords AS article_keyword_3da2 ON articles.article_id = article_keyword_3da2.article_id <br/>
LEFT OUTER JOIN keywords AS keywords_e2f2 ON keywords_e2f2.keyword_id = article_keyword_3da2.keyword_id <br/>
WHERE (keywords.keyword_name = :keywords_keywords_name AND articles.article_id = article_keywords.article_id) <br/>
AND keywords.keyword_id = article_keywords.keyword_id ORDER BY articles.oid, article_keyword_3da2.oid<br/>
{'keywords_keyword_name': 'politics'}</div><pre><span class="python_name">a </span><span class="python_operator">= </span><span class="python_name">articles</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># clear out keywords with a new list
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'topstories'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'government'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_105', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_105_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
{'name': 'topstories'}<br/>
INSERT INTO keywords (name) VALUES (:name)<br/>
{'name': 'government'}<br/>
DELETE FROM article_keywords <br/>
WHERE article_keywords.article_id = :article_id <br/>
AND article_keywords.keyword_id = :keyword_id<br/>
[{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]<br/>
INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
[{'keyword_id': 3, 'article_id': 1}, {'keyword_id': 4, 'article_id': 1}]</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping">back to section top</a>
    </div>



    
    <A name="datamapping_association"></a>
    
    <div class="sectionL2">

    <h3>Association Object</h3>
    
    

<p>Many to Many can also be done with an association object, that adds additional information about how two items are related.  In this pattern, the "secondary" option to <code>relation()</code> is no longer used; instead, the association object becomes a mapped entity itself, mapped to the association table.  If the association table has no explicit primary key columns defined, you also have to tell the mapper what columns will compose its "primary key", which are typically the two (or more) columns involved in the association.  Also, the relation between the parent and association mapping is typically set up with a cascade of <code>all, delete-orphan</code>.  This is to ensure that when an association object is removed from its parent collection, it is deleted (otherwise, the unit of work tries to null out one of the foreign key columns, which raises an error condition since that column is also part of its "primary key").
</p>

    

    <div class="code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">articles_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'articles'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'headline'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">150</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'headline'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'body'</span><span class="python_operator">, </span><span class="python_name">TEXT</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'body'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># add "attached_by" column which will reference the user who attached this keyword
</span><span class="python_name">itemkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'attached_by'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definitions
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># Article mapper, relates to Keyword via KeywordAssociation
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mapper for KeywordAssociation
# specify "primary key" columns manually
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">,</span>
    <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">article_id</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'keyword' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">) </span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># user mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># keyword mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># select by keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_106', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">alist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'jacks_stories'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_106_div" class="codepop" style="display:none;">SELECT article_keyword_f9af.keyword_id AS article_keyword_f9af_key_b3e1, <br/>
article_keyword_f9af.attached_by AS article_keyword_f9af_att_95d4, <br/>
article_keyword_f9af.article_id AS article_keyword_f9af_art_fd49, <br/>
users_9c30.user_name AS users_9c30_user_name, users_9c30.user_id AS users_9c30_user_id, <br/>
keywords_dc54.keyword_id AS keywords_dc54_keyword_id, keywords_dc54.keyword_name AS keywords_dc54_keyword_name, <br/>
articles.headline AS articles_headline, articles.body AS articles_body, articles.article_id AS articles_article_id <br/>
FROM keywords, article_keywords, articles <br/>
LEFT OUTER JOIN article_keywords AS article_keyword_f9af ON articles.article_id = article_keyword_f9af.article_id <br/>
LEFT OUTER JOIN users AS users_9c30 ON users_9c30.user_id = article_keyword_f9af.attached_by <br/>
LEFT OUTER JOIN keywords AS keywords_dc54 ON keywords_dc54.keyword_id = article_keyword_f9af.keyword_id <br/>
WHERE (keywords.keyword_name = :keywords_keywords_name AND keywords.keyword_id = article_keywords.keyword_id) <br/>
AND articles.article_id = article_keywords.article_id <br/>
ORDER BY articles.oid, article_keyword_f9af.oid, users_9c30.oid, keywords_dc54.oid<br/>
{'keywords_keywords_name': 'jacks_stories'}</div><pre><span class="python_comment"># user is available
</span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">alist</span><span class="python_operator">:
    </span><span class="python_keyword">for </span><span class="python_name">k </span><span class="python_keyword">in </span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">:
        </span><span class="python_keyword">if </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'jacks_stories'</span><span class="python_operator">:
            </span><span class="python_keyword">print </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator"></span></pre>
    </div>
<p>Keep in mind that the association object works a little differently from a plain many-to-many relationship.  Members have to be added to the list via instances of the association object, which in turn point to the associated object:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'some user'</span><span class="python_operator">
</span>
<span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">assoc </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'blue'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">
</span>
<span class="python_name">assoc2 </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">assoc2</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'green'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">assoc2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">
</span>
<span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">assoc</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">assoc2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>SQLAlchemy includes an extension module which can be used in some cases to decrease the explicitness of the association object pattern; this extension is described in <a href="#plugins_associationproxy">associationproxy</a>.
</p>
<p>Note that you should <strong>not</strong> combine the usage of a <code>secondary</code> relationship with an association object pattern against the same association table.  This is because SQLAlchemy's unit of work will regard rows in the table tracked by the <code>secondary</code> argument as distinct from entities mapped into the table by the association mapper, causing unexpected behaviors when rows are changed by one mapping and not the other.
</p>




            <a href="#datamapping">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="unitofwork"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#datamapping">Data Mapping</a>

               |   
            Next: <a href="#advdatamapping">Advanced Data Mapping</a>
    </div>

        <h2>Session / Unit of Work</h2>
    </div>


        








    
    <A name="unitofwork"></a>
    
    <div class="sectionL1">

    
    



    
    <A name="unitofwork_overview"></a>
    
    <div class="sectionL2">

    <h3>Overview</h3>
    
    

<p>The concept behind Unit of Work is to track modifications to a field of objects, and then be able to flush those changes to the database in a single operation.  Theres a lot of advantages to this, including that your application doesn't need to worry about individual save operations on objects, nor about the required order for those operations, nor about excessive repeated calls to save operations that would be more efficiently aggregated into one step.  It also simplifies database transactions, providing a neat package with which to insert into the traditional database begin/commit phase.
</p>
<p>SQLAlchemy's unit of work includes these functions:
</p>
<ul>
 <li>
     The ability to monitor scalar and list attributes on object instances, as well as object creates.  This is handled via the attributes package.
 </li>

 <li>
     The ability to maintain and process a list of modified objects, and based on the relationships set up by the mappers for those objects as well as the foreign key relationships of the underlying tables, figure out the proper order of operations so that referential integrity is maintained, and also so that on-the-fly values such as newly created primary keys can be propigated to dependent objects that need them before they are saved.  The central algorithm for this is the <em>topological sort</em>.
 </li>

 <li>
     The ability to define custom functionality that occurs within the unit-of-work flush phase, such as "before insert", "after insert", etc.  This is accomplished via MapperExtension.
 </li>

 <li>
     an Identity Map, which is a dictionary storing the one and only instance of an object for a particular table/primary key combination.  This allows many parts of an application to get a handle to a particular object without any chance of modifications going to two different places.
 </li>

 <li>
     The sole interface to the unit of work is provided via the <code>Session</code> object.  Transactional capability, which rides on top of the transactions provided by <code>Engine</code> objects, is provided by the <code>SessionTransaction</code> object.
 </li>

 <li>
     Thread-locally scoped Session behavior is available as an option, which allows new objects to be automatically added to the Session corresponding to by the <em>default Session context</em>.  Without a default Session context, an application must explicitly create a Session manually as well as add new objects to it.  The default Session context, disabled by default, can also be plugged in with other user-defined schemes, which may also take into account the specific class being dealt with for a particular operation.
 </li>

 <li>
     The Session object borrows conceptually from that of <a href='http://www.hibernate.org'>Hibernate</a>, a leading ORM for Java that was a great influence on the creation of the <a href='http://jcp.org/aboutJava/communityprocess/pfd/jsr220/index.html'>JSR-220</a> specification.  SQLAlchemy, under no obligation to conform to EJB specifications, is in general very different from Hibernate, providing a different paradigm for producing queries, a SQL API that is useable independently of the ORM, and of course Pythonic configuration as opposed to XML; however, JSR-220/Hibernate makes some pretty good suggestions with regards to the mechanisms of persistence.
 </li>
</ul>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_states"></a>
    
    <div class="sectionL2">

    <h3>Object States</h3>
    
    

<p>When dealing with mapped instances with regards to Sessions, an instance may be <em>attached</em> or <em>unattached</em> to a particular Session.  An instance also may or may not correspond to an actual row in the database.  The product of these two binary conditions yields us four general states a particular instance can have within the perspective of the Session:
</p>
<ul>
 <li><p><em>Transient</em> - a transient instance exists within memory only and is not associated with any Session.  It also has no database identity and does not have a corresponding record in the database.  When a new instance of a class is constructed, and no default session context exists with which to automatically attach the new instance, it is a transient instance.  The instance can then be saved to a particular session in which case it becomes a <em>pending</em> instance.  If a default session context exists, new instances are added to that Session by default and therefore become <em>pending</em> instances immediately.
</p>

 </li>

 <li><p><em>Pending</em> - a pending instance is a Session-attached object that has not yet been assigned a database identity.  When the Session is flushed (i.e. changes are persisted to the database), a pending instance becomes persistent.
</p>

 </li>

 <li><p><em>Persistent</em> - a persistent instance has a database identity and a corresponding record in the database, and is also associated with a particular Session.   By "database identity" we mean the object is associated with a table or relational concept in the database combined with a particular primary key in that table.  Objects that are loaded by SQLAlchemy in the context of a particular session are automatically considered persistent, as are formerly pending instances which have been subject to a session <code>flush()</code>.
</p>

 </li>

 <li><p><em>Detached</em> - a detached instance is an instance which has a database identity and corresponding row in the database, but is not attached to any Session.  This occurs when an instance has been removed from a Session, either because the session itself was cleared or closed, or the instance was explicitly removed from the Session.  The object can be re-attached to a session in which case it becomes Persistent again; any un-persisted changes that exist on the instance, whether they occurred during its previous persistent state or during its detached state will be detected and maintained by the new session.  Detached instances are useful when an application needs to represent a long-running operation across multiple Sessions, needs to store an object in a serialized state and then restore it later (such as within an HTTP "session" object), or in some cases where code needs to load instances locally which will later be associated with some other Session.
</p>

 </li>
</ul>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_getting"></a>
    
    <div class="sectionL2">

    <h3>Acquiring a Session</h3>
    
    

<p>A new Session object is constructed via the <code>create_session()</code> function:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>A common option used with <code>create_session()</code> is to specify a specific <code>Engine</code> or <code>Connection</code> to be used for all operations performed by this Session:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># create an engine
</span><span class="python_name">e </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://some/url'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session that will use this engine for all operations.
# it will open and close Connections as needed.
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># open a Connection
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">e</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session that will use this specific Connection for all operations
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The session to which an object is attached can be acquired via the <code>object_session()</code> function, which returns the appropriate <code>Session</code> if the object is pending or persistent, or <code>None</code> if the object is transient or detached:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Session Facts:
</p>
<ul>
 <li>
     the Session object is <strong>not threadsafe</strong>.  For thread-local management of Sessions, the recommended approch is to use the <a href="#plugins_sessioncontext">SessionContext</a> extension module.
 </li>
</ul>
<p>We will now cover some of the key concepts used by Sessions and its underlying Unit of Work.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_identitymap"></a>
    
    <div class="sectionL2">

    <h3>Introduction to the Identity Map</h3>
    
    

<p>A primary concept of the Session's underlying Unit of Work is that it is keeps track of all persistent instances; recall that a persistent instance has a database identity and is attached to a Session.  In particular, the Unit of Work must ensure that only <em>one</em> copy of a particular persistent instance exists within the Session at any given time.   The UOW accomplishes this task using a dictionary known as an <em>Identity Map</em>.
</p>
<p>When a <code>Query</code> is used to issue <code>select</code> or <code>get</code> requests to the database, it will in nearly all cases result in an actual SQL execution to the database, and a corresponding traversal of rows received from that execution.  However, when the underlying mapper actually <em>creates</em> objects corresponding to the result set rows it receives, it will check the session's identity map first before instantating a new object, and return the same instance already present in the identity map if it already exists, essentially <em>ignoring</em> the object state represented by that row.  There are several ways to override this behavior and truly refresh an already-loaded instance which are described later, but the main idea is that once your instance is loaded into a particular Session, it will <em>never change</em> its state without your explicit approval, regardless of what the database says about it.
</p>
<p>For example; below, two separate calls to load an instance with database identity "15" are issued, and the results assigned to two separate variables.   However, since the same <code>Session</code> was used, the two instances are the same instance:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">obj1 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">obj2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">obj1 </span><span class="python_keyword">is </span><span class="python_name">obj2</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre>
    </div>
<p>The Identity Map is an instance of <code>dict</code> by default.  (This is new as of version 0.3.2).  As an option, you can specify the flag <code>weak_identity_map=True</code> to the <code>create_session</code> function so that it will use a <code>weakref.WeakValueDictionary</code>, so that when an in-memory object falls out of scope, it will be removed automatically, thereby providing some automatic management of memory.   However, this may not be instant if there are circular references upon the object.  To guarantee that an instance is removed from the identity map before removing references to it, use the <code>expunge()</code> method, described later, to remove it.  Additionally, note that an object that has changes marked on it (i.e. "dirty") can still fall out of scope when using <code>weak_identity_map</code>.
</p>
<p>The Session supports an iterator interface in order to see all objects in the identity map:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">for </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">obj</span><span class="python_operator"></span></pre>
    </div>
<p>As well as <code>__contains__()</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">if </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"Object is present"</span><span class="python_operator"></span></pre>
    </div>
<p>The identity map itself is accessible via the <code>identity_map</code> accessor:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">identity_map</span><span class="python_operator">.</span><span class="python_name">values</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_operator"><</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">User object at </span><span class="python_number">0x712630</span><span class="python_operator">>, <</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">Address object at </span><span class="python_number">0x712a70</span><span class="python_operator">></span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>The identity of each object instance is available via the <code>_instance_key</code> property attached to each object instance, and is a tuple consisting of the object's class and an additional tuple of primary key values, in the order that they appear within the table definition:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">_instance_key </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_operator"><</span><span class="python_keyword">class </span><span class="python_literal">'test.tables.User'</span><span class="python_operator">>, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>At the moment that an object is assigned this key within a <code>flush()</code> operation, it is also added to the session's identity map.
</p>
<p>The <code>get()</code> method on <code>Query</code>, which retrieves an object based on primary key identity, also checks in the Session's identity map first to save a database round-trip if possible.  In the case of an object lazy-loading a single child object, the <code>get()</code> method is used as well, so scalar-based lazy loads may in some cases not query the database; this is particularly important for backreference relationships as it can save a lot of queries.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_changed"></a>
    
    <div class="sectionL2">

    <h3>Whats Changed ?</h3>
    
    

<p>The next concept is that in addition to the <code>Session</code> storing a record of all objects loaded or saved, it also stores lists of all <em>newly created</em> (i.e. pending) objects and lists of all persistent objects that have been marked as <em>deleted</em>.  These lists are used when a <code>flush()</code> call is issued to save all changes.  During a flush operation, it also scans its list of persistent instances for changes which are marked as dirty.
</p>
<p>These records are all tracked by collection functions that are also viewable off the <code>Session</code> as properties:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># pending objects recently added to the Session
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">new</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects which currently have changes detected
# (this collection is now created on the fly each time the property is called)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">dirty</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects that have been marked as deleted via session.delete(obj)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">deleted</span><span class="python_operator"></span></pre>
    </div>
<p>Note that if a session is created with the <code>weak_identity_map</code> flag, an item which is marked as "dirty" will be silently removed from the session if the item falls out of scope in the user application.  This is because the unit of work does not look for "dirty" changes except for within a flush operation (or any time the session.dirty collection is accessed). 
</p>
<p>As for objects inside of <code>new</code> and <code>deleted</code>, if you abandon all references to new or modified objects within a session, <em>they are still present</em> in either of those two lists, and will be saved on the next flush operation, unless they are removed from the Session explicitly (more on that later).  <br></br>
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api"></a>
    
    <div class="sectionL2">

    <h3>The Session API</h3>
    
    



    
    <A name="unitofwork_api_query"></a>
    
    <div class="sectionL3">

    <h3>query()</h3>
    
    

<p>The <code>query()</code> function takes a class or <code>Mapper</code> as an argument, along with an optional <code>entity_name</code> parameter, and returns a new <code>Query</code> object which will issue mapper queries within the context of this Session.  If a Mapper is passed, then the Query uses that mapper.  Otherwise, if a class is sent, it will locate the primary mapper for that class which is used to construct the Query.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># query from a class
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query from a mapper
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">usermapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query from a class mapped with entity name 'alt_users'
</span><span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt_users'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">y </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'orders'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p><code>entity_name</code> is an optional keyword argument sent with a class object, in order to further qualify which primary mapper to be used; this only applies if there was a <code>Mapper</code> created with that particular class/entity name combination, else an exception is raised.  All of the methods on Session which take a class or mapper argument also take the <code>entity_name</code> argument, so that a given class can be properly matched to the desired primary mapper.
</p>
<p>All instances retrieved by the returned <code>Query</code> object will be stored as persistent instances within the originating <code>Session</code>.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_get"></a>
    
    <div class="sectionL3">

    <h3>get()</h3>
    
    

<p>Given a class or mapper, a scalar or tuple-based identity, and an optional <code>entity_name</code> keyword argument, creates a <code>Query</code> corresponding to the given mapper or class/entity_name combination, and calls the <code>get()</code> method with the given identity value.  If the object already exists within this Session, it is simply returned, else it is queried from the database.  If the instance is not found, the method returns <code>None</code>.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># get Employer primary key 5
</span><span class="python_name">employer </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_name">Employer</span><span class="python_operator">, </span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get Report composite primary key 7,12, using mapper 'report_mapper_b'
</span><span class="python_name">report </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_name">Report</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'report_mapper_b'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_load"></a>
    
    <div class="sectionL3">

    <h3>load()</h3>
    
    

<p>load() is similar to get() except it will raise an exception if the instance does not exist in the database.  It will also load the object's data from the database in all cases, and <strong>overwrite</strong> all changes on the object if it already exists in the session with the latest data from the database.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># load Employer primary key 5
</span><span class="python_name">employer </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">load</span><span class="python_enclosure">(</span><span class="python_name">Employer</span><span class="python_operator">, </span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># load Report composite primary key 7,12, using mapper 'report_mapper_b'
</span><span class="python_name">report </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">load</span><span class="python_enclosure">(</span><span class="python_name">Report</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'report_mapper_b'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_save"></a>
    
    <div class="sectionL3">

    <h3>save()</h3>
    
    

<p>save() is called with a single transient (unsaved, unattached) instance as an argument, which is then added to the Session and becomes pending.  When the session is next <code>flush</code>ed, the instance will be saved to the database uponwhich it becomes persistent (saved, attached).  If the given instance is not transient, meaning it is either attached to an existing Session or it has a database identity, an exception is raised.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">user1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()     </span><span class="python_comment"># write changes to the database</span><span class="python_operator"></span></pre>
    </div>
<p>save() is called automatically for new instances by the classes' associated mapper, if a default Session context is in effect (such as a thread-local session), which means that newly created instances automatically become pending.  If there is no default session available, then the instance remains transient (unattached) until it is explicitly added to a Session via the save() method.
</p>
<p>A transient instance also can be automatically <code>save</code>ed if it is associated with a parent object which specifies <code>save-update</code> within its <code>cascade</code> rules, and that parent is already attached or becomes attached to a Session.  For more information on <code>cascade</code>, see the next section.
</p>
<p>The <code>save_or_update()</code> method, covered later, is a convenience method which will call the <code>save()</code> or <code>update()</code> methods appropriately dependening on whether or not the instance has a database identity (but the instance still must be unattached).
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_flush"></a>
    
    <div class="sectionL3">

    <h3>flush()</h3>
    
    

<p>This is the main gateway to what the Unit of Work does best, which is save everything !  It should be clear by now what a flush looks like:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>It also can be called with a list of objects; in this form, the flush operation will be limited only to the objects specified in the list, as well as any child objects within <code>private</code> relationships for a delete operation:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># saves only user1 and address2.  all other modified
# objects remain present in the session.
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">([</span><span class="python_name">user1</span><span class="python_operator">, </span><span class="python_name">address2</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre>
    </div>
<p>This second form of flush should be used carefully as it will not necessarily locate other dependent objects within the session, whose database representation may have foreign constraint relationships with the objects being operated upon.
</p>

    
    <A name="unitofwork_api_flush_whatis"></a>
    
    <div class="sectionL4">

    <h3>Notes on Flush</h3>
    
    
<p>A common misconception about the <code>flush()</code> operation is that once performed, the newly persisted instances will automatically have related objects attached to them, based on the values of primary key identities that have been assigned to the instances before they were persisted.  An example would be, you create a new <code>Address</code> object, set <code>address.user_id</code> to 5, and then <code>flush()</code> the session.  The erroneous assumption would be that there is now a <code>User</code> object of identity "5" attached to the <code>Address</code> object, but in fact this is not the case.  If you were to <code>refresh()</code> the <code>Address</code>, invalidating its current state and re-loading, <em>then</em> it would have the appropriate <code>User</code> object present.
</p>
<p>This misunderstanding is related to the observed behavior of backreferences (<a href="#datamapping_relations_backreferences">Backreferences</a>), which automatically associates an instance "A" with another instance "B", in response to the manual association of instance "B" to instance "A" by the user.  The backreference operation occurs completely externally to the <code>flush()</code> operation, and is pretty much the only example of a SQLAlchemy feature that manipulates the relationships of persistent objects.
</p>
<p>The primary guideline for dealing with <code>flush()</code> is, the developer is responsible for maintaining in-memory objects and their relationships to each other, the unit of work is responsible for maintaining the database representation of the in-memory objects.  The typical pattern is that the manipulation of objects <em>is</em> the way that changes get communicated to the unit of work, so that when the flush occurs, the objects are already in their correct in-memory representation and problems dont arise.  The manipulation of identifier attributes like integer key values as well as deletes in particular are a frequent source of confusion.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_api_close"></a>
    
    <div class="sectionL3">

    <h3>close()</h3>
    
    

<p>This method first calls <code>clear()</code>, removing all objects from this <code>Session</code>, and then ensures that any transactional resources are closed.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_delete"></a>
    
    <div class="sectionL3">

    <h3>delete()</h3>
    
    

<p>The <code>delete</code> method places an instance into the Unit of Work's list of objects to be marked as deleted:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># mark two objects to be deleted
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The delete operation will have an effect on instances that are attached to the deleted instance according to the <code>cascade</code> style of the relationship; cascade rules are described further in the following section.  By default, associated instances may need to be updated in the database to reflect that they no longer are associated with the parent object, before the parent is deleted.  If the relationship specifies <code>cascade=&quot;delete&quot;</code>, then the associated instance will also be deleted upon flush, assuming it is still attached to the parent.  If the relationship additionally includes the <code>delete-orphan</code> cascade style, the associated instance will be deleted if it is still attached to the parent, or is unattached to any other parent. 
</p>
<p>The <code>delete()</code> operation has no relationship to the in-memory status of the instance, including usage of the <code>del</code> Python statement.  An instance marked as deleted and flushed will still exist within memory until references to it are freed; similarly, removing an instance from memory via the <code>del</code> statement will have no effect, since the persistent instance will still be referenced by its Session.  Obviously, if the instance is removed from the Session and then totally dereferenced, it will no longer exist in memory, but also won't exist in any Session and is therefore not deleted from the database.
</p>
<p>Note that the "in-memory status" of an instance also refers to its presence in any other collection.  SQLAlchemy does not track the collections to which an instance is a member, and will not remove an instance from its parent collections that were not directly involved in a deletion operation.  The operational and memory overhead implied by this would be too great (such as, if an object belonged to hundreds of collections).  This means if an object <code>A</code> is attached to both an object <code>B</code> and an object <code>C</code>, if you <code>delete()</code> <code>A</code> and flush, <code>A</code> still remains attached to both <code>B</code> and <code>C</code> in a deleted state and must be removed by the application.  Similarly, if a delete on <code>B</code> cascades to <code>A</code>, this <strong>does not</strong> affect <code>A</code> still being present on <code>C</code> - again it must be manually removed.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_clear"></a>
    
    <div class="sectionL3">

    <h3>clear()</h3>
    
    

<p>This method detaches all instances from the Session, sending them to the detached or transient state as applicable, and replaces the underlying UnitOfWork with a new one.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>clear()</code> method is particularly useful with a "default context" session such as a thread-local session, which can stay attached to the current thread to handle a new field of objects without having to re-attach a new Session.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_refreshexpire"></a>
    
    <div class="sectionL3">

    <h3>refresh() / expire()</h3>
    
    

<p>To assist with the Unit of Work's "sticky" behavior, individual objects can have all of their attributes immediately re-loaded from the database, or marked as "expired" which will cause a re-load to occur upon the next access of any of the object's mapped attributes.  This includes all relationships, so lazy-loaders will be re-initialized, eager relationships will be repopulated.  Any changes marked on the object are discarded:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># immediately re-load attributes on obj1, obj2
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># expire objects obj1, obj2, attributes will be reloaded
# on the next access:
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_expunge"></a>
    
    <div class="sectionL3">

    <h3>expunge()</h3>
    
    

<p>Expunge removes an object from the Session, sending persistent instances to the detached state, and pending instances to the transient state:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expunge</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Use <code>expunge</code> when youd like to remove an object altogether from memory, such as before calling <code>del</code> on it, which will prevent any "ghost" operations occuring when the session is flushed.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_bind"></a>
    
    <div class="sectionL3">

    <h3>bind_mapper() / bind_table()</h3>
    
    

<p>Both of these methods receive two arguments; in the case of <code>bind_mapper()</code>, it is a <code>Mapper</code> and an <code>Engine</code> or <code>Connection</code> instance; in the case of <code>bind_table()</code>, it is a <code>Table</code> instance or other <code>Selectable</code> (such as an <code>Alias</code>, <code>Select</code>, etc.), and an <code>Engine</code> or <code>Connection</code> instance.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">engine1 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///file1.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine2 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">sqlite_conneciton </span><span class="python_operator">= </span><span class="python_name">engine1</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">bind_mapper</span><span class="python_enclosure">(</span><span class="python_name">mymapper</span><span class="python_operator">, </span><span class="python_name">sqlite_connection</span><span class="python_enclosure">)  </span><span class="python_comment"># bind mymapper operations to a single SQLite connection</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">bind_table</span><span class="python_enclosure">(</span><span class="python_name">email_addresses_table</span><span class="python_operator">, </span><span class="python_name">engine2</span><span class="python_enclosure">) </span><span class="python_comment"># bind operations with the email_addresses_table to mysql</span><span class="python_operator"></span></pre>
    </div>
<p>Normally, when a <code>Session</code> is created via <code>create_session()</code> with no arguments, the Session has no awareness of individual <code>Engines</code>, and when mappers use the <code>Session</code> to retrieve connections, the underlying <code>MetaData</code> each <code>Table</code> is associated with is expected to be "bound" to an <code>Engine</code>, else no engine can be located and an exception is raised.  A second form of <code>create_session()</code> takes the argument <code>bind_to=engine_or_connection</code>, where all SQL operations performed by this <code>Session</code> use the single <code>Engine</code> or <code>Connection</code> (collectively known as a <code>Connectable</code>) passed to the constructor.  With <code>bind_mapper()</code> and <code>bind_table()</code>,  the operations of individual mapper and/or tables are bound to distinct engines or connections, thereby overriding not only the engine which may be "bound" to the underlying <code>MetaData</code>, but also the <code>Engine</code> or <code>Connection</code> which may have been passed to the <code>create_session()</code> function.  Configurations which interact with multiple explicit database connections at one time must use either or both of these methods in order to associate <code>Session</code> operations with the appropriate connection resource.  <br></br>
</p>
<p>Binding a <code>Mapper</code> to a resource takes precedence over a <code>Table</code> bind, meaning if mapper A is associated with table B, and the Session binds mapper A to connection X and table B to connection Y, an operation with mapper A will use connection X, not connection Y.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_update"></a>
    
    <div class="sectionL3">

    <h3>update()</h3>
    
    

<p>The update() method is used <em>only</em> with detached instances.  A detached instance only exists if its <code>Session</code> was cleared or closed, or the instance was <code>expunge()</code>d from its session.  <code>update()</code> will re-attach the detached instance with this Session, bringing it back to the persistent state, and allowing any changes on the instance to be saved when the <code>Session</code> is next <code>flush</code>ed.  If the instance is already attached to an existing <code>Session</code>, an exception is raised.
</p>
<p>A detached instance also can be automatically <code>update</code>ed if it is associated with a parent object which specifies <code>save-update</code> within its <code>cascade</code> rules, and that parent is already attached or becomes attached to a Session.  For more information on <code>cascade</code>, see the next section.
</p>
<p>The <code>save_or_update()</code> method is a convenience method which will call the <code>save()</code> or <code>update()</code> methods appropriately dependening on whether or not the instance has a database identity (but the instance still must be unattached).
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_saveorupdate"></a>
    
    <div class="sectionL3">

    <h3>save_or_update()</h3>
    
    

<p>This method is a combination of the <code>save()</code> and <code>update()</code> methods, which will examine the given instance for a database identity (i.e. if it is transient or detached), and will call the implementation of <code>save()</code> or <code>update()</code> as appropriate.  Use <code>save_or_update()</code> to add unattached instances to a session when you're not sure if they were newly created or not.  Like <code>save()</code> and <code>update()</code>, <code>save_or_update()</code> cascades along the <code>save-update</code> cascade indicator, described in the <code>cascade</code> section below.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_api_merge"></a>
    
    <div class="sectionL3">

    <h3>merge()</h3>
    
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p><code>merge()</code> is used to return the persistent version of an instance that is not attached to this Session.  When passed an instance, if an instance with its database identity already exists within this Session, it is returned.  If the instance does not exist in this Session, it is loaded from the database and then returned.  <br></br>
</p>
<p>A future version of <code>merge()</code> will also update the Session's instance with the state of the given instance (hence the name "merge").
</p>
<p>This method is useful for bringing in objects which may have been restored from a serialization, such as those stored in an HTTP session:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># deserialize an object
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">pickle</span><span class="python_operator">.</span><span class="python_name">loads</span><span class="python_enclosure">(</span><span class="python_name">mystring</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "merge" it.  if the session already had this object in the 
# identity map, then you get back the one from the current session.
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">merge</span><span class="python_enclosure">(</span><span class="python_name">myobj</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Note that <code>merge()</code> <em>does not</em> associate the given instance with the Session; it remains detached (or attached to whatever Session it was already attached to).
</p>



            <a href="#unitofwork">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_cascade"></a>
    
    <div class="sectionL2">

    <h3>Cascade rules</h3>
    
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Mappers support the concept of configurable <em>cascade</em> behavior on <code>relation()</code>s.  This behavior controls how the Session should treat the instances that have a parent-child relationship with another instance that is operated upon by the Session.  Cascade is indicated as a comma-separated list of string keywords, with the possible values <code>all</code>, <code>delete</code>, <code>save-update</code>, <code>refresh-expire</code>, <code>merge</code>, <code>expunge</code>, and <code>delete-orphan</code>.
</p>
<p>Cascading is configured by setting the <code>cascade</code> keyword argument on a <code>relation()</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">, </span><span class="python_name">order_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'items' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'customer' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">user_orders_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"save-update"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>The above mapper specifies two relations, <code>items</code> and <code>customer</code>.  The <code>items</code> relationship specifies "all, delete-orphan" as its <code>cascade</code> value, indicating that all  <code>save</code>, <code>update</code>, <code>merge</code>, <code>expunge</code>, <code>refresh</code> <code>delete</code> and <code>expire</code> operations performed on a parent <code>Order</code> instance should also be performed on the child <code>Item</code> instances attached to it (<code>save</code> and <code>update</code> are cascaded using the <code>save_or_update()</code> method, so that the database identity of the instance doesn't matter).  The <code>delete-orphan</code> cascade value additionally indicates that if an <code>Item</code> instance is no longer associated with an <code>Order</code>, it should also be deleted.  The "all, delete-orphan" cascade argument allows a so-called <em>lifecycle</em> relationship between an <code>Order</code> and an <code>Item</code> object.
</p>
<p>The <code>customer</code> relationship specifies only the "save-update" cascade value, indicating most operations will not be cascaded from a parent <code>Order</code> instance to a child <code>User</code> instance, except for if the <code>Order</code> is attached with a particular session, either via the <code>save()</code>, <code>update()</code>, or <code>save-update()</code> method.
</p>
<p>Additionally, when a child item is attached to a parent item that specifies the "save-update" cascade value on the relationship, the child is automatically passed to <code>save_or_update()</code> (and the operation is further cascaded to the child item).
</p>
<p>Note that cascading doesn't do anything that isn't possible by manually calling Session methods on individual instances within a hierarchy, it merely automates common operations on a group of associated instances.
</p>
<p>The default value for <code>cascade</code> on <code>relation()</code>s is <code>save-update</code>, and the <code>private=True</code> keyword argument is a synonym for <code>cascade=&quot;all, delete-orphan&quot;</code>.
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_transaction"></a>
    
    <div class="sectionL2">

    <h3>SessionTransaction</h3>
    
    

<p>SessionTransaction is a multi-engine transaction manager, which aggregates one or more Engine/Connection pairs and keeps track of a Transaction object for each one.  As the Session receives requests to execute SQL statements, it uses the Connection that is referenced by the SessionTransaction.  At commit time, the underyling Session is flushed, and each Transaction is the committed.
</p>
<p>Example usage is as follows:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The SessionTransaction object supports Python 2.5's with statement so that the example above can be written as:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">with sess</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>create_transaction()</code> method creates a new SessionTransaction object but does not declare any connection/transaction resources.  At the point of the first <code>get()</code> call, a connection resource is opened off the engine that corresponds to the Item classes' mapper and is stored within the <code>SessionTransaction</code> with an open <code>Transaction</code>.  When <code>trans.commit()</code> is called, the <code>flush()</code> method is called on the <code>Session</code> and the corresponding update statements are issued to the database within the scope of the transaction already opened; afterwards, the underying Transaction is committed, and connection resources are freed.
</p>
<p><code>SessionTransaction</code>, like the <code>Transaction</code> off of <code>Connection</code> also supports "nested" behavior, and is safe to pass to other functions which then issue their own <code>begin()</code>/<code>commit()</code> pair; only the outermost <code>begin()</code>/<code>commit()</code> pair actually affects the transaction, and any call to <code>rollback()</code> within a particular call stack will issue a rollback.
</p>
<p>Note that while SessionTransaction is capable of tracking multiple transactions across multiple databases, it currently is in no way a fully functioning two-phase commit engine; generally, when dealing with multiple databases simultaneously, there is the distinct possibility that a transaction can succeed on the first database and fail on the second, which for some applications may be an invalid state.  If this is an issue, its best to either refrain from spanning transactions across databases, or to look into some of the available technologies in this area, such as <a href='http://www.zope.org'>Zope</a> which offers a two-phase commit engine; some users have already created their own SQLAlchemy/Zope hybrid implementations to deal with scenarios like these.
</p>
<p>SessionTransaction Facts:
</p>
<ul>
 <li>
     SessionTransaction, like its parent Session object, is <strong>not threadsafe</strong>.
 </li>
</ul>


    
    <A name="unitofwork_transaction_sql"></a>
    
    <div class="sectionL3">

    <h3>Using SQL with SessionTransaction</h3>
    
    

<p>The SessionTransaction can interact with direct SQL queries in two general ways.  Either specific <code>Connection</code> objects can be associated with the <code>SessionTransaction</code>, which are then useable both for direct SQL as well as within <code>flush()</code> operations performed by the <code>SessionTransaction</code>, or via accessing the <code>Connection</code> object automatically referenced within the <code>SessionTransaction</code>.
</p>
<p>To associate a specific <code>Connection</code> with the <code>SessionTransaction</code>, use the <code>add()</code> method:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Associate a Connection with the SessionTransaction</div>
        <pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'col1'</span><span class="python_operator">:</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">'col2'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_enclosure">})</span><span class="python_operator">
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">() </span><span class="python_comment"># flush() operation will use the same connection</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>add()</code> method will key the <code>Connection</code>'s underlying <code>Engine</code> to this <code>SessionTransaction</code>.  When mapper operations are performed against this <code>Engine</code>, the <code>Connection</code> explicitly added will be used.  This <strong>overrides</strong> any other <code>Connection</code> objects that the underlying Session was associated with, corresponding to the underlying <code>Engine</code> of that <code>Connection</code>.  However, if the <code>SessionTransaction</code> itself is already associated with a <code>Connection</code>, then an exception is thrown.
</p>
<p>The other way is just to use the <code>Connection</code> referenced by the <code>SessionTransaction</code>.  This is performed via the <code>connection()</code> method, and requires passing in a class or <code>Mapper</code> which indicates which underlying <code>Connection</code> should be returned (recall that different <code>Mappers</code> may use different underlying <code>Engines</code>).  If the <code>class_or_mapper</code> argument is <code>None</code>, then the <code>Session</code> must be globally bound to a specific <code>Engine</code> when it was constructed, else the method returns <code>None</code>.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Get a Connection from the SessionTransaction</div>
        <pre><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">(</span><span class="python_name">UserClass</span><span class="python_enclosure">)   </span><span class="python_comment"># get the Connection used by the UserClass' Mapper</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'col1'</span><span class="python_operator">:</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">'col2'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>connection()</code> method also exists on the <code>Session</code> object itself, and can be called regardless of whether or not a <code>SessionTransaction</code> is in progress.  If a <code>SessionTransaction</code> is in progress, it will return the connection referenced by the transaction.  If an <code>Engine</code> is being used with <code>threadlocal</code> strategy, the <code>Connection</code> returned will correspond to the connection resources that are bound to the current thread, if any (i.e. it is obtained by calling <code>contextual_connect()</code>).
</p>



            <a href="#unitofwork">back to section top</a>
    </div>



    
    <A name="unitofwork_transaction_using"></a>
    
    <div class="sectionL3">

    <h3>Using Engine-level Transactions with Sessions</h3>
    
    

<p>The transactions issued by <code>SessionTransaction</code> as well as internally by the <code>Session</code>'s <code>flush()</code> operation use the same <code>Transaction</code> object off of <code>Connection</code> that is publically available.  Recall that this object supports "nestable" behavior, meaning any number of actors can call <code>begin()</code> off a particular <code>Connection</code> object, and they will all be managed within the scope of a single transaction.  Therefore, the <code>flush()</code> operation can similarly take place within the scope of a regular <code>Transaction</code>:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Transactions with Sessions</div>
        <pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()   </span><span class="python_comment"># Connection</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">) </span><span class="python_comment"># Session bound to the Connection</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()      </span><span class="python_comment"># start transaction</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">stuff </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()     </span><span class="python_comment"># Session operation uses connection</span><span class="python_operator">
    </span><span class="python_name">stuff</span><span class="python_enclosure">[</span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">=</span><span class="python_literal">"bar"</span><span class="python_enclosure">))    </span><span class="python_comment"># use connection explicitly</span><span class="python_operator">
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()     </span><span class="python_comment"># Session flushes with "connection", using transaction "trans"</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()    </span><span class="python_comment"># or rollback</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()      </span><span class="python_comment"># commit</span><span class="python_operator"></span></pre>
    </div>



            <a href="#unitofwork">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_logging"></a>
    
    <div class="sectionL2">

    <h3>Analyzing Object Flushes</h3>
    
    

<p>The session module can log an extensive display of its "flush plans", which is a graph of its internal representation of objects before they are written to the database.  To turn this logging on:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># make an Session with echo_uow
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">echo_uow</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>flush()</code> operation will then dump to the standard output displays like the following:
</p>

    

    <div class="sliding_code">
        <pre>Task dump:

 UOWTask(6034768, 'User/users/None')
  |
  |- Save User(6016624)
  |       |-Process User(6016624).addresses
  |
  |- UOWTask(6034832, 'Address/email_addresses/None')
  |   |- Save Address(6034384)
  |   |- Save Address(6034256)
  |   |----
  | 
  |----</pre>
    </div>
<p>The above graph can be read straight downwards to determine the order of operations.  It indicates "save User 6016624, process each element in the 'addresses' list on User 6016624, save Address 6034384, Address 6034256".
</p>
<p>Of course, one can also get a good idea of the order of operations just by logging the actual SQL statements executed.
</p>




            <a href="#unitofwork">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="advdatamapping"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#unitofwork">Session / Unit of Work</a>

               |   
            Next: <a href="#types">The Types System</a>
    </div>

        <h2>Advanced Data Mapping</h2>
    </div>


        








    
    <A name="advdatamapping"></a>
    
    <div class="sectionL1">

    
    

<p>This section details all the options available to Mappers, as well as advanced patterns.
</p>
<p>To start, heres the tables we will work with again:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="advdatamapping_properties"></a>
    
    <div class="sectionL2">

    <h3>More On Mapper Properties</h3>
    
    



    
    <A name="advdatamapping_properties_colname"></a>
    
    <div class="sectionL3">

    <h3>Overriding Column Names</h3>
    
    

<p>When mappers are constructed, by default the column names in the Table metadata are used as the names of attributes on the mapped class.  This can be customzed within the properties by stating the key/column combinations explicitly:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">user_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_literal">'name' </span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>In the situation when column names overlap in a mapper against multiple tables, columns may be referenced together with a list:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># join users and addresses
</span><span class="python_name">usersaddresses </span><span class="python_operator">= </span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">usersaddresses</span><span class="python_operator">,   </span>
    <span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_overriding"></a>
    
    <div class="sectionL3">

    <h3>Overriding Properties</h3>
    
    

<p>A common request is the ability to create custom class properties that override the behavior of setting/getting an attribute.  Currently, the easiest way to do this in SQLAlchemy is how it would be done in any Python program; define your attribute with a different name, such as "_attribute", and use a property to get/set its value.  The mapper just needs to be told of the special name:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">_set_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
       </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email </span><span class="python_operator">= </span><span class="python_name">email</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">_get_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
       </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
    </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_email</span><span class="python_operator">, </span><span class="python_name">_set_email</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
   <span class="python_comment"># map the '_email' attribute to the "email" column</span>
   <span class="python_comment"># on the table</span>
   <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>It is also possible to route the the <code>select_by</code> and <code>get_by</code> functions on <code>Query</code> using the new property name, by establishing a <code>synonym</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_comment"># map the '_email' attribute to the "email" column</span>
    <span class="python_comment"># on the table</span>
    <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span><span class="python_operator">,</span>

    <span class="python_comment"># make a synonym 'email'</span>
    <span class="python_literal">'email' </span><span class="python_operator">: </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_email'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># now you can select_by(email)
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'john@smith.com'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Synonym can be established with the flag "proxy=True", to create a class-level proxy to the actual property.  This has the effect of creating a fully functional synonym on class instances:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
    <span class="python_literal">'email' </span><span class="python_operator">: </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_email'</span><span class="python_operator">, </span><span class="python_name">proxy</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_literal">'john@doe.com'</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
</span><span class="python_literal">'john@doe.com'</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_customlist"></a>
    
    <div class="sectionL3">

    <h3>Custom List Classes</h3>
    
    

<p>Feature Status: <a href='javascript:alphaApi()'>Alpha API</a> 
</p>
<p>A one-to-many or many-to-many relationship results in a list-holding element being attached to all instances of a class.  The actual list is an "instrumented" list, which transparently maintains a relationship to a plain Python list.  The implementation of the underlying plain list can be changed to be any object that implements a <code>list</code>-style <code>append</code> and <code>__iter__</code> method.  A common need is for a list-based relationship to actually be a dictionary.  This can be achieved by subclassing <code>dict</code> to have <code>list</code>-like behavior.
</p>
<p>In this example, a class <code>MyClass</code> is defined, which is associated with a parent object <code>MyParent</code>.  The collection of <code>MyClass</code> objects on each <code>MyParent</code> object will be a dictionary, storing each <code>MyClass</code> instance keyed to its <code>name</code> attribute.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># a class to be stored in the list
</span><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_comment"># create a dictionary that will act like a list, and store
# instances of MyClass
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">MyDict</span><span class="python_enclosure">(</span><span class="python_name">dict</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_enclosure">[</span><span class="python_name">item</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">] </span><span class="python_operator">= </span><span class="python_name">item</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__iter__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">values</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># parent class
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">MyParent</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mappers, constructed normally
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">myclass_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyParent</span><span class="python_operator">, </span><span class="python_name">myparent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'myclasses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">MyDict</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># elements on 'myclasses' can be accessed via string keyname
</span><span class="python_name">myparent </span><span class="python_operator">= </span><span class="python_name">MyParent</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myparent</span><span class="python_operator">.</span><span class="python_name">myclasses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_literal">'this is myclass'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">myclass </span><span class="python_operator">= </span><span class="python_name">myparent</span><span class="python_operator">.</span><span class="python_name">myclasses</span><span class="python_enclosure">[</span><span class="python_literal">'this is myclass'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_customjoin"></a>
    
    <div class="sectionL3">

    <h3>Custom Join Conditions</h3>
    
    

<p>When creating relations on a mapper, most examples so far have illustrated the mapper and relationship joining up based on the foreign keys of the tables they represent.  in fact, this "automatic" inspection can be completely circumvented using the <code>primaryjoin</code> and <code>secondaryjoin</code> arguments to <code>relation</code>, as in this example which creates a User object which has a relationship to all of its Addresses which are in Boston:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>Many to many relationships can be customized by one or both of <code>primaryjoin</code> and <code>secondaryjoin</code>, shown below with just the default many-to-many relationship explicitly set:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">,</span>
        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
        <span class="python_name">secondaryjoin</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span>
        <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_multiplejoin"></a>
    
    <div class="sectionL3">

    <h3>Lazy/Eager Joins Multiple Times to One Table</h3>
    
    

<p>The previous example leads in to the idea of joining against the same table multiple times.  Below is a User object that has lists of its Boston and New York addresses:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_literal">'newyork_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'New York'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>Both lazy and eager loading support multiple joins equally well.
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_deferred"></a>
    
    <div class="sectionL3">

    <h3>Deferred Column Loading</h3>
    
    

<p>This feature allows particular columns of a table to not be loaded by default, instead being loaded later on when first referenced.  It is essentailly "column-level lazy loading".   This feature is useful when one wants to avoid loading a large text or binary field into memory when its not needed.  Individual columns can be lazy loaded by themselves or placed into groups that lazy-load together.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that will load each of 'excerpt' and 'photo' in 
# separate, individual-row SELECT statements when each attribute
# is first referenced on the individual object instance
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>Deferred columns can be placed into groups so that they load together:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo1'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo2'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo3'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper with a 'photos' deferred group.  when one photo is referenced,
# all three photos will be loaded in one SELECT statement.  The 'excerpt' will 
# be loaded separately when it is first referenced.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo1' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo1</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo2' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo2</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo3' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo3</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>You can defer or undefer columns at the <code>Query</code> level with the <code>options</code> method:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">defer</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">undefer</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_working"></a>
    
    <div class="sectionL3">

    <h3>Working with Large Collections</h3>
    
    

<p>SQLAlchemy relations are generally simplistic; the lazy loader loads in the full list of child objects when accessed, and the eager load builds a query that loads the full list of child objects.  Additionally, when you are deleting a parent object, SQLAlchemy ensures that it has loaded the full list of child objects so that it can mark them as deleted as well (or to update their parent foreign key to NULL).  It does not issue an en-masse "delete from table where parent_id=?" type of statement in such a scenario.  This is because the child objects themselves may also have further dependencies, and additionally may also exist in the current session in which case SA needs to know their identity so that their state can be properly updated.
</p>
<p>So there are several techniques that can be used individually or combined together to address these issues, in the context of a large collection where you normally would not want to load the full list of relationships:
</p>
<ul>
 <li><p>Use <code>lazy=None</code> to disable child object loading (i.e. noload)
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_name">relation</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>

 </li>

 <li><p>To load child objects, just use a query.  Of particular convenience is that <code>Query</code> is a generative object, so you can return
   it as is, allowing additional criterion to be added as needed:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">Organization</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_name">member_query </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_keyword">lambda </span><span class="python_name">self</span><span class="python_operator">: </span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Member</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_parent</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">myorg </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Organization</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get all members
</span><span class="python_name">members </span><span class="python_operator">= </span><span class="python_name">myorg</span><span class="python_operator">.</span><span class="python_name">member_query</span><span class="python_operator">.</span><span class="python_name">list</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># query a subset of members using LIMIT/OFFSET
</span><span class="python_name">members </span><span class="python_operator">= </span><span class="python_name">myorg</span><span class="python_operator">.</span><span class="python_name">member_query</span><span class="python_enclosure">[</span><span class="python_number">5</span><span class="python_operator">:</span><span class="python_number">10</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>

 </li>

 <li><p>Use <code>passive_deletes=True</code> to disable child object loading on a DELETE operation, in conjunction with "ON DELETE (CASCADE|SET NULL)" on your database to automatically cascade deletes to child objects.   Note that "ON DELETE" is not supported on SQLite, and requires <code>InnoDB</code> tables when using MySQL:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">myothertable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'myothertable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'parent_id'</span><span class="python_enclosure">]</span><span class="python_operator">,</span><span class="python_enclosure">[</span><span class="python_literal">'mytable.id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mmapper</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">myothertable</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">passive_deletes</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>

 </li>

 <li><p>As an alternative to using "ON DELETE CASCADE", for very simple scenarios you can create a simple <code>MapperExtension</code> that will issue a DELETE for child objects before the parent object is deleted:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">DeleteMemberExt</span><span class="python_enclosure">(</span><span class="python_name">MapperExtension</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">before_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_operator">==</span><span class="python_name">instance</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Organization</span><span class="python_operator">, </span><span class="python_name">org_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">DeleteMemberExt</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'members' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Member</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">passive_deletes</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>

 </li>
</ul>
<p>Note that this approach is not nearly as efficient or general-purpose as "ON DELETE CASCADE", since the database itself can cascade the operation along any number of tables.
</p>
<p>The latest distribution includes an example <code>examples/collection/large_collection.py</code> which illustrates most of these techniques.    <br></br>
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_properties_relationoptions"></a>
    
    <div class="sectionL3">

    <h3>Relation Options</h3>
    
    

<p>Options which can be sent to the <code>relation()</code> function.  For arguments to <code>mapper()</code>, see <a href="#advdatamapping_mapperoptions">Mapper Options</a>.
</p>
<ul>
 <li>
     <strong>association</strong> - Deprecated; as of version 0.3.0 the association keyword is synonomous with applying the "all, delete-orphan" cascade to a "one-to-many" relationship.  SA can now automatically reconcile a "delete" and "insert" operation of two objects with the same "identity" in a flush() operation into a single "update" statement, which is the pattern that "association" used to indicate.  See the updated example of association mappings in <a href="#datamapping_association">Association Object</a>.
 </li>

 <li>
     <strong>backref</strong> - indicates the name of a property to be placed on the related mapper's class that will handle this relationship in the other direction, including synchronizing the object attributes on both sides of the relation.  Can also point to a <code>backref()</code> construct for more configurability.  See <a href="#datamapping_relations_backreferences">Backreferences</a>.
 </li>

 <li>
     <strong>cascade</strong> - a string list of cascade rules which determines how persistence operations should be "cascaded" from parent to child. For a description of cascade rules, see <a href="#datamapping_relations_lifecycle">Lifecycle Relations</a> and <a href="#unitofwork_cascade">Cascade rules</a>.
 </li>

 <li>
     <strong>collection_class</strong> - a class or function that returns a new list-holding object.  will be used in place of a plain list for storing elements.  See <a href="#advdatamapping_properties_customlist">Custom List Classes</a>.
 </li>

 <li>
     <strong>foreign_keys</strong> - a list of columns which are to be used as "foreign key" columns.  this parameter should be used in conjunction with explicit
<code>primaryjoin</code> and <code>secondaryjoin</code> (if needed) arguments, and the columns within the <code>foreign_keys</code> list should be present within those join conditions.  Normally, <code>relation()</code> will inspect the columns within the join conditions to determine which columns are the "foreign key" columns, based on information in the <code>Table</code> metadata.  Use this argument when no ForeignKey's are present in the join condition, or to override the table-defined foreign keys.
 </li>

 <li>
     <strong>foreignkey</strong> - deprecated.  use the <code>foreign_keys</code> argument for foreign key specification, or <code>remote_side</code> for "directional" logic.
 </li>

 <li>
     <strong>lazy=True</strong> - specifies how the related items should be loaded.  a value of True indicates they should be loaded lazily when the property is first accessed.  A value of False indicates they should be loaded by joining against the parent object query, so parent and child are loaded in one round trip (i.e. eagerly).  A value of None indicates the related items are not loaded by the mapper in any case; the application will manually insert items into the list in some other way.  In all cases, items added or removed to the parent object's collection (or scalar attribute) will cause the appropriate updates and deletes upon flush(),  i.e. this option only affects load operations, not save operations.  <br></br>
 </li>

 <li>
     <strong>order_by</strong> - indicates the ordering that should be applied when loading these items.  See the section <a href="#advdatamapping_orderby">Controlling Ordering</a> for details.
 </li>

 <li>
     <strong>passive_deletes=False</strong> - Indicates if lazy-loaders should not be executed during the <code>flush()</code> process, which normally occurs in order to locate all existing child items when a parent item is to be deleted.  Setting this flag to True is appropriate when <code>ON DELETE CASCADE</code> rules have been set up on the actual tables so that the database may handle cascading deletes automatically.  This strategy is useful particularly for handling the deletion of objects that have very large (and/or deep) child-object collections.  See the example in <a href="#advdatamapping_properties_working">Working with Large Collections</a>.
 </li>

 <li>
     <strong>post_update</strong> - this indicates that the relationship should be handled by a second UPDATE statement after an INSERT or before a DELETE.  Currently, it also will issue an UPDATE after the instance was UPDATEd as well, although this technically should be improved.  This flag is used to handle saving bi-directional dependencies between two individual rows (i.e. each row references the other), where it would otherwise be impossible to INSERT or DELETE both rows fully since one row exists before the other.  Use this flag when a particular mapping arrangement will incur two rows that are dependent on each other, such as a table that has a one-to-many relationship to a set of child rows, and also has a column that references a single child row within that list (i.e. both tables contain a foreign key to each other).  If a <code>flush()</code> operation returns an error that a "cyclical dependency" was detected, this is a cue that you might want to use <code>post_update</code> to "break" the cycle.
 </li>

 <li>
     <strong>primaryjoin</strong> - a ClauseElement that will be used as the primary join of this child object against the parent object, or in a many-to-many relationship the join of the primary object to the association table.  By default, this value is computed based on the foreign key relationships of the parent and child tables (or association table).
 </li>

 <li>
     <strong>private=False</strong> - deprecated.  setting <code>private=True</code> is the equivalent of setting <code>cascade=&quot;all, delete-orphan&quot;</code>, and indicates the lifecycle of child objects should be contained within that of the parent.   See the example in <a href="#datamapping_relations_lifecycle">Lifecycle Relations</a>.
 </li>

 <li>
     <strong>remote_side</strong> - used for self-referential relationships, indicates the column or list of columns that form the "remote side" of the relationship.  See the examples in <a href="#advdatamapping_selfreferential">Self Referential Mappers</a>.
 </li>

 <li>
     <strong>secondary</strong> - for a many-to-many relationship, specifies the intermediary table.  The <code>secondary</code> keyword argument should generally only be used for a table that is not otherwise expressed in any class mapping.  In particular, using the <a href="#datamapping_association">Association Object Pattern</a> is generally mutually exclusive against using the <code>secondary</code> keyword argument.
 </li>

 <li>
     <strong>secondaryjoin</strong> - a ClauseElement that will be used as the join of an association table to the child object.  By default, this value is computed based on the foreign key relationships of the association and child tables.
 </li>

 <li>
     <strong>uselist=(True|False)</strong> - a boolean that indicates if this property should be loaded as a list or a scalar.  In most cases, this value is determined automatically by <code>relation()</code>, based on the type and direction of the relationship - one to many forms a list, many to one forms a scalar, many to many is a list.  If a scalar is desired where normally a list would be present, such as a bi-directional one-to-one relationship, set uselist to False.
 </li>

 <li>
     <strong>viewonly=False</strong> - when set to True, the relation is used only for loading objects within the relationship, and has no effect on the unit-of-work flush process.  Relations with viewonly can specify any kind of join conditions to provide additional views of related objects onto a parent object.  Note that the functionality of a viewonly relationship has its limits - complicated join conditions may not compile into eager or lazy loaders properly.  If this is the case, use an alternative method, such as those described in <a href="#advdatamapping_properties_working">Working with Large Collections</a>, <a href="#advdatamapping_resultset">Result-Set Mapping</a>, or <a href="#advdatamapping_selects">Mapping a Class against Arbitrary Selects</a>.
 </li>
</ul>



            <a href="#advdatamapping">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_orderby"></a>
    
    <div class="sectionL2">

    <h3>Controlling Ordering</h3>
    
    

<p>By default, mappers will attempt to ORDER BY the "oid" column of a table, or the primary key column, when selecting rows.  This can be modified in several ways.
</p>
<p>The "order_by" parameter can be sent to a mapper, overriding the per-engine ordering if any.  A value of None means that the mapper should not use any ordering.  A non-None value, which can be a column, an <code>asc</code> or <code>desc</code> clause, or an array of either one, indicates the ORDER BY clause that should be added to all select queries:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># disable all ordering
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by a column
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_tableusers_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple items
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre>
    </div>
<p>"order_by" can also be specified to an individual <code>select</code> method, overriding all other per-engine/per-mapper orderings:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># order by a column
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple criterion
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre>
    </div>
<p>For relations, the "order_by" property can also be specified to all forms of relation:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># order address objects by address id
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># eager load with ordering - the ORDER BY clauses of parent/child will be organized properly
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_limits"></a>
    
    <div class="sectionL2">

    <h3>Limiting Rows</h3>
    
    

<p>You can limit rows in a regular SQL query by specifying <code>limit</code> and <code>offset</code>.  A Mapper can handle the same concepts:
</p>

    

    <div class="code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_107', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_107_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password <br/>
FROM users ORDER BY users.oid <br/>
LIMIT 20 OFFSET 10<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>However, things get tricky when dealing with eager relationships, since a straight LIMIT of rows does not represent the count of items when joining against other tables to load related items as well.  So here is what SQLAlchemy will do when you use limit or offset with an eager relationship:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
    </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'F%'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip <br/>
FROM <br/>
(SELECT users.user_id FROM users WHERE users.user_name LIKE %(users_user_name)s<br/>
ORDER BY users.oid LIMIT 20 OFFSET 10) AS rowcount, <br/>
 users LEFT OUTER JOIN addresses ON users.user_id = addresses.user_id <br/>
WHERE rowcount.user_id = users.user_id ORDER BY users.oid, addresses.oid<br/>
{'users_user_name': 'F%'}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The main WHERE clause as well as the limiting clauses are coerced into a subquery; this subquery represents the desired result of objects.  A containing query, which handles the eager relationships, is joined against the subquery to produce the result.
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_inheritance"></a>
    
    <div class="sectionL2">

    <h3>Mapping a Class with Table Inheritance</h3>
    
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Inheritance in databases comes in three forms:  <em>single table inheritance</em>, where several types of classes are stored in one table, <em>concrete table inheritance</em>, where each type of class is stored in its own table, and <em>multiple table inheritance</em>, where the parent/child classes are stored in their own tables that are joined together in a select.
</p>
<p>There is also a concept of <code>polymorphic</code> loading, which indicates if multiple kinds of classes can be loaded in one pass.
</p>
<p>SQLAlchemy supports all three kinds of inheritance.  Additionally, true <code>polymorphic</code> loading is supported in a straightfoward way for single table inheritance, and has some more manually-configured features that can make it happen for concrete and multiple table inheritance.
</p>
<p>Working examples of polymorphic inheritance come with the distribution in the directory <code>examples/polymorphic</code>.
</p>
<p>Here are the classes we will use to represent an inheritance relationship:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">Employee</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Manager</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">manager_data</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data </span><span class="python_operator">= </span><span class="python_name">manager_data</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Engineer</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">engineer_info</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info </span><span class="python_operator">= </span><span class="python_name">engineer_info</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator"></span></pre>
    </div>
<p>Each class supports a common <code>name</code> attribute, while the <code>Manager</code> class has its own attribute <code>manager_data</code> and the <code>Engineer</code> class has its own attribute <code>engineer_info</code>.
</p>


    
    <A name="advdatamapping_inheritance_single"></a>
    
    <div class="sectionL3">

    <h3>Single Table Inheritance</h3>
    
    

<p>This will support polymorphic loading via the <code>Employee</code> mapper.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_inheritance_concrete"></a>
    
    <div class="sectionL3">

    <h3>Concrete Table Inheritance</h3>
    
    

<p>Without polymorphic loading, you just define a separate mapper for each class.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Concrete Inheritance, Non-polymorphic</div>
        <pre><span class="python_name">managers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engineers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>With polymorphic loading, the SQL query to do the actual polymorphic load must be constructed, usually as a UNION.  There is a helper function to create these UNIONS called <code>polymorphic_union</code>.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Concrete Inheritance, Polymorphic</div>
        <pre><span class="python_name">pjoin </span><span class="python_operator">= </span><span class="python_name">polymorphic_union</span><span class="python_enclosure">({</span>
    <span class="python_literal">'manager'</span><span class="python_operator">:</span><span class="python_name">managers_table</span><span class="python_operator">,</span>
    <span class="python_literal">'engineer'</span><span class="python_operator">:</span><span class="python_name">engineers_table</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_literal">'pjoin'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">pjoin</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>A future release of SQLALchemy might better merge the generated UNION into the mapper construction phase.    <br></br>
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_inheritance_multiple"></a>
    
    <div class="sectionL3">

    <h3>Multiple Table Inheritance</h3>
    
    

<p>Like concrete table inheritance, this can be done non-polymorphically, or with a little more complexity, polymorphically:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Multiple Table Inheritance, Non-polymorphic</div>
        <pre><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_name">engineers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.person_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">managers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.person_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
   <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">person_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Polymorphic:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Multiple Table Inheritance, Polymorphic</div>
        <pre><span class="python_name">person_join </span><span class="python_operator">= </span><span class="python_name">polymorphic_union</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">{</span>
        <span class="python_literal">'engineer'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'manager'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">managers</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'person'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">==</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_literal">'pjoin'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">person_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">, </span><span class="python_name">select_table</span><span class="python_operator">=</span><span class="python_name">person_join</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">person_join</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The join condition in a multiple table inheritance relationship can be specified explicitly, using <code>inherit_condition</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">AddressUser</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span>
        <span class="python_name">AddressUser</span><span class="python_operator">,</span>
        <span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span>
        <span class="python_name">inherit_condition</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_joins"></a>
    
    <div class="sectionL2">

    <h3>Mapping a Class against Multiple Tables</h3>
    
    

<p>Mappers can be constructed against arbitrary relational units (called <code>Selectables</code>) as well as plain <code>Tables</code>.  For example, The <code>join</code> keyword from the SQL package creates a neat selectable unit comprised of multiple tables, complete with its own composite primary key, which can be passed in to a mapper as the table.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># a class
</span><span class="python_keyword">class </span><span class="python_name">AddressUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a Join
</span><span class="python_operator"></span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of an AddressUser object will be 
# based on (user_id, address_id) since those are the primary keys involved
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">AddressUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>A second example:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># many-to-many join on an association table
</span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">, </span>
        <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">, </span>
           <span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a class 
</span><span class="python_keyword">class </span><span class="python_name">KeywordUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of a KeywordUser object will be
# (user_id, keyword_id) since those are the primary keys involved
</span><span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_literal">'keyword_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre>
    </div>
<p>In both examples above, "composite" columns were added as properties to the mappers; these are aggregations of multiple columns into one mapper property, which instructs the mapper to keep both of those columns set at the same value.
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_selects"></a>
    
    <div class="sectionL2">

    <h3>Mapping a Class against Arbitrary Selects</h3>
    
    

<p>Similar to mapping against a join, a plain select() object can be used with a mapper as well.  Below, an example select which contains two aggregate functions and a group_by is mapped to a class:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">customers</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'order_count'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">max</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">price</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'highest_order'</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
            <span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">==</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">,</span>
            <span class="python_name">group_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">c </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">]</span>
            <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'somealias'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Customer</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Customer</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Above, the "customers" table is joined against the "orders" table to produce a full row for each customer row, the total count of related rows in the "orders" table, and the highest price in the "orders" table, grouped against the full set of columns in the "customers" table.  That query is then mapped against the Customer class.  New instances of Customer will contain attributes for each column in the "customers" table as well as an "order_count" and "highest_order" attribute.  Updates to the Customer object will only be reflected in the "customers" table and not the "orders" table.  This is because the primary keys of the "orders" table are not represented in this mapper and therefore the table is not affected by save or delete operations.
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_multiple"></a>
    
    <div class="sectionL2">

    <h3>Multiple Mappers for One Class</h3>
    
    

<p>The first mapper created for a certain class is known as that class's "primary mapper."  Other mappers can be created as well, these come in two varieties.
</p>
<ul>
 <li>
     <strong>secondary mapper</strong> - this is a mapper that must be constructed with the keyword argument <code>non_primary=True</code>, and represents a load-only mapper.  Objects that are loaded with a secondary mapper will have their save operation processed by the primary mapper.  It is also invalid to add new <code>relation()</code>s to a non-primary mapper. To use this mapper with the Session, specify it to the <code>query</code> method:
 </li>
</ul>
<p>example:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># primary mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make a secondary mapper to load User against a join
</span><span class="python_name">othermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">someothertable</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">non_primary</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">othermapper</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<ul>
 <li>
     <strong>entity name mapper</strong> - this is a mapper that is a fully functioning primary mapper for a class, which is distinguished from the regular primary mapper by an <code>entity_name</code> parameter.  Instances loaded with this mapper will be totally managed by this new mapper and have no connection to the original one.  Most methods on <code>Session</code> include an optional <code>entity_name</code> parameter in order to specify this condition.
 </li>
</ul>
<p>example:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># primary mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make an entity name mapper that stores User objects in another table
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">alternate_users_table</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make two User objects
</span><span class="python_name">user1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">user2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># save one in in the "users" table
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># save the other in the "alternate_users_table"
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user2</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># select from the alternate mapper
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_selfreferential"></a>
    
    <div class="sectionL2">

    <h3>Self Referential Mappers</h3>
    
    

<p>A self-referential mapper is a mapper that is designed to operate with an <em>adjacency list</em> table.  This is a table that contains one or more foreign keys back to itself, and is usually used to create hierarchical tree structures.  SQLAlchemy's default model of saving items based on table dependencies is not sufficient in this case, as an adjacency list table introduces dependencies between individual rows.  Fortunately, SQLAlchemy will automatically detect a self-referential mapper and do the extra lifting to make it work.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># define a self-referential table
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mapper defines "children" property, pointing back to TreeNode class,
# with the mapper unspecified.  it will point back to the primary 
# mapper on the TreeNode class.
</span><span class="python_operator"></span><span class="python_name">TreeNode</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all"</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>This kind of mapper goes through a lot of extra effort when saving and deleting items, to determine the correct dependency graph of nodes within the tree.
</p>
<p>A self-referential mapper where there is more than one relationship on the table requires that all join conditions be explicitly spelled out.  Below is a self-referring table that contains a "parent_node_id" column to reference parent/child relationships, and a "root_node_id" column which points child nodes back to the ultimate root node:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># define a self-referential table with several relations
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'root_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define the "children" property as well as the "root" property
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">parent_node_id</span><span class="python_operator">==</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span>
                        <span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all"</span><span class="python_operator">,</span>
                        <span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">"parent"</span><span class="python_operator">, </span><span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_enclosure">])</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'root' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                <span class="python_name">TreeNode</span><span class="python_operator">,</span>
                <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">root_node_id</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_operator">, </span>
                <span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
                <span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span>
            <span class="python_enclosure">)</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The "root" property on a TreeNode is a many-to-one relationship.  By default, a self-referential mapper declares relationships as one-to-many, so the extra parameter <code>remote_side</code>, pointing to a column or list of columns on the remote side of a relationship, is needed to indicate a "many-to-one" self-referring relationship (note the previous keyword argument <code>foreignkey</code> is deprecated).
   Both TreeNode examples above are available in functional form in the <code>examples/adjacencytree</code> directory of the distribution.    <br></br>
</p>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_resultset"></a>
    
    <div class="sectionL2">

    <h3>Result-Set Mapping</h3>
    
    

<p>Take any result set and feed it into a Query to produce objects.  Multiple mappers can be combined to retrieve unrelated objects from the same row in one step.  The <code>instances</code> method on Query takes a ResultProxy object, which is the result type generated from SQLEngine, and delivers object instances.  (note: this method has been moved off of Mapper, where it is deprecated).
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users
</span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get objects
</span><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">c</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define a second class/mapper
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users and addresses in one query
# use_labels is so that the user_id column in both tables are distinguished
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute it, and process the results with the User mapper, chained to the Address mapper
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">class_mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># result rows are an array of objects, one for each mapper used
</span><span class="python_keyword">for </span><span class="python_name">entry </span><span class="python_keyword">in </span><span class="python_name">r</span><span class="python_operator">:
    </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
    </span><span class="python_name">address </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>


    
    <A name="advdatamapping_resultset_combining"></a>
    
    <div class="sectionL3">

    <h3>Combining Eager Loads with Result Set Mappings</h3>
    
    

<p>When result-set mapping is used with a particular Mapper, SQLAlchemy has no access to the query being used and therefore has no way of tacking on its own <code>LEFT OUTER JOIN</code> conditions that are normally used to eager load relationships.  If the query being constructed is created in such a way that it returns rows not just from a parent table (or tables) but also returns rows from child tables, the result-set mapping can be notified as to which additional properties are contained within the result set.  This is done using the <code>contains_eager()</code> query option, which specifies the name of the relationship to be eagerly loaded, and optionally a <strong>decorator function</strong> that can translate aliased column names when results are received.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># mapping is the users->addresses mapping
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># define a query on USERS with an outer join to ADDRESSES
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Query object which expects the "addresses" results 
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># get results normally
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre>
    </div>
<p>It is often the case with large queries that some of the tables within the query need to be aliased in order to distinguish them from other occurences of the same table within the query.  A query that attempts to add eagerly loaded child items will often have this condition.  The <code>contains_eager()</code> function takes a keyword argument <code>alias</code> which can either be the string name of an alias, or an actual <code>Alias</code> construct used in constructing the query, which will target the eager loading towards the columns of that alias (new in version 0.3.5):
</p>

    

    <div class="code">
        <pre><span class="python_comment"># use an alias of the addresses table
</span><span class="python_name">adalias </span><span class="python_operator">= </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'adalias'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define a query on USERS with an outer join to adalias
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">adalias</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Query object which expects the "addresses" results 
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">alias</span><span class="python_operator">=</span><span class="python_name">adalias</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># get results normally
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_108', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre><div id="popbox_108_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, adalias.address_id AS adalias_address_id, <br/>
adalias.user_id AS adalias_user_id, adalias.email_address AS adalias_email_address, (...other columns...)<br/>
FROM users LEFT OUTER JOIN email_addresses AS adalias ON users.user_id = adalias.user_id</div><pre><span class="python_operator"></span></pre>
    </div>
<p>In the case that the main table itself is also aliased, the <code>contains_alias()</code> option can be used (new in version 0.3.5):
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># define an aliased UNION called 'ulist'
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">union</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">7</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'ulist'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># add on an eager load of "addresses"
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create query, indicating "ulist" is an alias for the main table, "addresses" property should
# be eager loaded
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_alias</span><span class="python_enclosure">(</span><span class="python_literal">'ulist'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># results
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_mapperoptions"></a>
    
    <div class="sectionL2">

    <h3>Mapper Options</h3>
    
    

<p>Options which can be sent to the <code>mapper()</code> function.  For arguments to <code>relation()</code>, see <a href="#advdatamapping_properties_relationoptions">Relation Options</a>.
</p>
<ul>
 <li>
     <strong>allow_column_override</strong> - if True, allows the usage of a <code>relation()</code> which has the same name as a column in the mapped table. The table column will no longer be mapped.
 </li>

 <li>
     <strong>allow_null_pks=False</strong> - indicates that composite primary keys where one or more (but not all) columns contain NULL is a valid primary key. Primary keys which contain NULL values usually indicate that a result row does not contain an entity and should be skipped.
 </li>

 <li>
     <strong>always_refresh=False</strong> - if True, all query operations for this mapped class will overwrite all data within object instances that already exist within the session, erasing any in-memory changes with whatever information was loaded from the database.
 </li>

 <li>
     <strong>batch=True</strong> - when False, indicates that when a mapper is persisting a list of instances, each instance will be fully saved to the database before moving onto the next instance. Normally, inserts and updates are batched together per-table, such as for an inheriting mapping that spans multiple tables. This flag is for rare circumstances where custom <code>MapperExtension</code> objects are used to attach logic to <code>before_insert()</code>, <code>before_update()</code>, etc., and the user-defined logic requires that the full persistence of each instance must be completed before moving onto the next (such as logic which queries the tables for the most recent ID). Note that this flag has a significant impact on the efficiency of a large save operation.
 </li>

 <li>
     <strong>column_prefix</strong> - a string which will be prepended to the "key" name of all Columns when creating column-based properties from the given Table. Does not affect explicitly specified column-based properties. Setting <code>column_prefix='_'</code> is equivalent to defining all column-based properties as <code>_columnname=table.c.columnname</code>. See <a href="#advdatamapping_properties_colname">Overriding Column Names</a> for information on overriding column-based attribute names.
 </li>

 <li>
     <strong>concrete</strong> - if True, indicates this mapper should use concrete table inheritance with its parent mapper.  Requires <code>inherits</code> to be set.
 </li>

 <li>
     <strong>entity_name</strong> - defines this mapping as local to a particular class of entities within a single class.  Allows alternate persistence mappings for a single class. See <a href="#advdatamapping_multiple">Multiple Mappers for One Class</a>.
 </li>

 <li>
     <strong>extension</strong> - a MapperExtension instance or list of MapperExtension instances which will be applied to all operations by this Mapper. See <a href="#advdatamapping_extending">Extending Mapper</a>.
 </li>

 <li>
     <strong>inherits</strong> - another Mapper or class for which this Mapper will have an inheritance relationship with. See the examples in <a href="#advdatamapping_inheritance">Mapping a Class with Table Inheritance</a>.
 </li>

 <li>
     <strong>inherit_condition</strong> - for joined table inheritance, a SQL expression (constructed ClauseElement) which will define how the two tables are joined;
defaults to a natural join between the two tables.
 </li>

 <li>
     <strong>non_primary=False</strong> - if True, construct a Mapper that will define only the selection of instances, not their persistence. It essentially creates a mapper that can be used for querying but does not define how instances of the class are stored. A non_primary mapper is always created after a regular primary mapper has already been created for the class. To use one, send it in place of the class argument when creating a query, such as <code>session.query(somemapper)</code>. Note that it is usually invalid to define additional relationships on a non_primary mapper as they will conflict with those of the primary. See <a href="#advdatamapping_multiple">Multiple Mappers for One Class</a>.
 </li>

 <li>
     <strong>order_by</strong> - a single Column or list of Columns for which selection operations should use as the default ordering for entities. Defaults to the OID/ROWID of the table if any, or the first primary key column of the table. See <a href="#advdatamapping_orderby">Controlling Ordering</a>.
 </li>

 <li>
     <strong>polymorphic_on</strong> - used with mappers in an inheritance relationship, a Column which will identify the class/mapper combination to be used with a particular row. requires the <code>polymorphic_identity</code> value to be set for all mappers in the inheritance hierarchy.
 </li>

 <li>
     <strong>polymorphic_identity</strong> - a value which will be stored in the Column denoted by <code>polymorphic_on</code>, corresponding to the "class identity" of this mapper.  See <a href="#advdatamapping_inheritance">Mapping a Class with Table Inheritance</a>.
 </li>

 <li>
     <strong>primary_key</strong> - a list of Column objects which define the "primary key" to be used against this mapper's selectable unit. The mapper normally determines these automatically from the given <code>local_table</code> of the mapper combined against any inherited tables. When this argument is specified, the primary keys of the mapped table if any are disregarded in place of the columns given. This can be used to provide primary key identity to a table that has no PKs defined at the schema level, or to modify what defines "identity" for a particular table.
 </li>

 <li>
     <strong>properties</strong> - a dictionary mapping the string names of object attributes to MapperProperty instances, which define the persistence behavior of that attribute. Note that the columns in the mapped table are automatically converted into ColumnProperty instances based on the "key" property of each Column (although they can be overridden using this dictionary).
 </li>

 <li>
     <strong>select_table</strong> - used with polymorphic mappers, this is a <code>Selectable</code> which will take the place of the <code>Mapper</code>'s main table argument when
performing queries.
 </li>

 <li>
     <strong>version_id_col</strong> - a Column which must have an integer type that will be used to keep a running "version id" of mapped entities in the database. This is used during save operations to ensure that no other thread or process has updated the instance during the lifetime of the entity, else a ConcurrentModificationError exception is thrown.
 </li>
</ul>



            <a href="#advdatamapping">back to section top</a>
    </div>



    
    <A name="advdatamapping_extending"></a>
    
    <div class="sectionL2">

    <h3>Extending Mapper</h3>
    
    

<p>Mappers can have functionality augmented or replaced at many points in its execution via the usage of the MapperExtension class.  This class is just a series of "hooks" where various functionality takes place.  An application can make its own MapperExtension objects, overriding only the methods it needs.  Methods that are not overridden return the special value <code>sqlalchemy.orm.mapper.EXT_PASS</code>, which indicates the operation should proceed as normally.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">MapperExtension</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""base implementation for an object that provides overriding behavior to various
    Mapper functions.  For each method in MapperExtension, a result of EXT_PASS indicates
    the functionality is not overridden."""</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_session</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called to retrieve a contextual Session instance with which to
        register a new object. Note: this is not called if a session is 
        provided with the __init__ params (i.e. _sa_session)"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">query</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""overrides the select_by method of the Query object"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">query</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""overrides the select method of the Query object"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">create_instance</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">class_</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when a new object instance is about to be created from a row.  
        the method can choose to create the instance itself, or it can return 
        None to indicate normal object creation should take place.

        mapper - the mapper doing the operation

        selectcontext - SelectionContext corresponding to the instances() call

        row - the result row from the database

        class_ - the class we are mapping.
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append_result</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">, </span><span class="python_name">identitykey</span><span class="python_operator">, </span><span class="python_name">result</span><span class="python_operator">, </span><span class="python_name">isnew</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when an object instance is being appended to a result list.

        If this method returns EXT_PASS, it is assumed that the mapper should do the appending, else
        if this method returns any other value or None, it is assumed that the append was handled by this method.

        mapper - the mapper doing the operation

        selectcontext - SelectionContext corresponding to the instances() call

        row - the result row from the database

        instance - the object instance to be appended to the result

        identitykey - the identity key of the instance

        result - list to which results are being appended

        isnew - indicates if this is the first time we have seen this object instance in the current result
        set.  if you are selecting from a join, such as an eager load, you might see the same object instance
        many times in the same result set.
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">populate_instance</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">, </span><span class="python_name">identitykey</span><span class="python_operator">, </span><span class="python_name">isnew</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called right before the mapper, after creating an instance from a row, passes the row
        to its MapperProperty objects which are responsible for populating the object's attributes.
        If this method returns EXT_PASS, it is assumed that the mapper should do the appending, else
        if this method returns any other value or None, it is assumed that the append was handled by this method.

        Essentially, this method is used to have a different mapper populate the object:

            def populate_instance(self, mapper, selectcontext, instance, row, identitykey, isnew):
                othermapper.populate_instance(selectcontext, instance, row, identitykey, isnew, frommapper=mapper)
                return True
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is INSERTed into its table.

        this is a good place to set up primary key values and such that arent handled otherwise."""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_update</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instnace is UPDATED"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_update</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instnace is UPDATED"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instance has been INSERTed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is DELETEed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instance is DELETEed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator"></span></pre>
    </div>
<p>To use MapperExtension, make your own subclass of it and just send it off to a mapper:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MyExtension</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre>
    </div>
<p>Multiple extensions will be chained together and processed in order; they are specified as a list:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">ext1</span><span class="python_operator">, </span><span class="python_name">ext2</span><span class="python_operator">, </span><span class="python_name">ext3</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre>
    </div>




            <a href="#advdatamapping">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="types"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#advdatamapping">Advanced Data Mapping</a>

               |   
            Next: <a href="#pooling">Connection Pooling</a>
    </div>

        <h2>The Types System</h2>
    </div>


        








    
    <A name="types"></a>
    
    <div class="sectionL1">

    
    

<p>The package <code>sqlalchemy.types</code> defines the datatype identifiers which may be used when defining <b>metadata</b>.  This package includes a set of generic types, a set of SQL-specific subclasses of those types, and a small extension system used by specific database connectors to adapt these generic types into database-specific type objects.
</p>


    
    <A name="types_standard"></a>
    
    <div class="sectionL2">

    <h3>Built-in Types</h3>
    
    

<p>SQLAlchemy comes with a set of standard generic datatypes, which are defined as classes.   <br></br>
</p>
<p>The standard set of generic types are:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">package sqlalchemy.types</div>
        <pre><span class="python_keyword">class </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Integer</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">SmallInteger</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Numeric</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Float</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># DateTime, Date and Time types deal with datetime objects from the Python datetime module
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">DateTime</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Date</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Time</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Binary</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Boolean</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># converts unicode strings to raw bytes
# as bind params, raw bytes to unicode as 
# rowset values, using the unicode encoding 
# setting on the engine (defaults to 'utf-8')
</span><span class="python_keyword">class </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">String</span><span class="python_operator">
</span>
<span class="python_comment"># uses the pickle protocol to serialize data
# in/out of Binary columns
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">PickleType</span><span class="python_enclosure">(</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">Binary</span><span class="python_operator"></span></pre>
    </div>
<p>More specific subclasses of these types are available, which various database engines may choose to implement specifically, allowing finer grained control over types:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">FLOAT</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TEXT</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DECIMAL</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">INT</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">INTEGER </span><span class="python_operator">= </span><span class="python_name">INT</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TIMESTAMP</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DATETIME</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CLOB</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BLOB</span><span class="python_enclosure">(</span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BOOLEAN</span><span class="python_enclosure">(</span><span class="python_name">Boolean</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>When using a specific database engine, these types are adapted even further via a set of database-specific subclasses defined by the database engine.
   There may eventually be more type objects that are defined for specific databases.  An example of this would be Postgres' Array type.
</p>
<p>Type objects are specified to table meta data using either the class itself, or an instance of the class.  Creating an instance of the class allows you to specify parameters for the type, such as string length, numerical precision, etc.:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_comment"># define type using a class</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'my_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">, </span>

    <span class="python_comment"># define type using an object instance</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">Number</span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">4</span><span class="python_enclosure">)) </span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#types">back to section top</a>
    </div>



    
    <A name="types_custom"></a>
    
    <div class="sectionL2">

    <h3>Creating your Own Types</h3>
    
    

<p>User-defined types can be created, to support either database-specific types, or customized pre-processing of query parameters as well as post-processing of result set data.  You can make your own classes to perform these operations.  To augment the behavior of a <code>TypeEngine</code> type, such as <code>String</code>, the <code>TypeDecorator</code> class is used:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""basic type that decorates String, prefixes values with "PREFIX:" on 
    the way in and strips it off on the way out."""</span><span class="python_operator">
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"PREFIX:" </span><span class="python_operator">+ </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_enclosure">[</span><span class="python_number">7</span><span class="python_operator">:</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>Unicode</code> and <code>PickleType</code> classes are instances of <code>TypeDecorator</code> already and can be subclassed directly.
</p>
<p>To build a type object from scratch, which will not have a corresponding database-specific implementation, subclass <code>TypeEngine</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_number">8</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_col_spec</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"MYTYPE(%s)" </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator"></span></pre>
    </div>




            <a href="#types">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="pooling"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#types">The Types System</a>

               |   
            Next: <a href="#plugins">Plugins</a>
    </div>

        <h2>Connection Pooling</h2>
    </div>


        








    
    <A name="pooling"></a>
    
    <div class="sectionL1">

    
    

<p>This section describes the connection pool module of SQLAlchemy.  The <code>Pool</code> object it provides is normally embedded within an <code>Engine</code> instance.  For most cases, explicit access to the pool module is not required.  However, the <code>Pool</code> object can be used on its own, without the rest of SA, to manage DBAPI connections; this section describes that usage.  Also, this section will describe in more detail how to customize the pooling strategy used by an <code>Engine</code>.
</p>
<p>At the base of any database helper library is a system of efficiently acquiring connections to the database.  Since the establishment of a database connection is typically a somewhat expensive operation, an application needs a way to get at database connections repeatedly without incurring the full overhead each time.  Particularly for server-side web applications, a connection pool is the standard way to maintain a "pool" of database connections which are used over and over again among many requests.  Connection pools typically are configured to maintain a certain "size", which represents how many connections can be used simultaneously without resorting to creating more newly-established connections.
</p>


    
    <A name="pooling_establishing"></a>
    
    <div class="sectionL2">

    <h3>Establishing a Transparent Connection Pool</h3>
    
    

<p>Any DBAPI module can be "proxied" through the connection pool using the following technique (note that the usage of 'psycopg2' is <strong>just an example</strong>; substitute whatever DBAPI module you'd like):
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2 as psycopg</span><span class="python_operator">
</span><span class="python_name">psycopg </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">manage</span><span class="python_enclosure">(</span><span class="python_name">psycopg</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then connect normally
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">database</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'tiger'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>This produces a <code>sqlalchemy.pool.DBProxy</code> object which supports the same <code>connect()</code> function as the original DBAPI module.  Upon connection, a connection proxy object is returned, which delegates its calls to a real DBAPI connection object.  This connection object is stored persistently within a connection pool (an instance of <code>sqlalchemy.pool.Pool</code>) that corresponds to the exact connection arguments sent to the <code>connect()</code> function.  <br></br>
</p>
<p>The connection proxy supports all of the methods on the original connection object, most of which are proxied via <code>__getattr__()</code>.  The <code>close()</code> method will return the connection to the pool, and the <code>cursor()</code> method will return a proxied cursor object.  Both the connection proxy and the cursor proxy will also return the underlying connection to the pool after they have both been garbage collected, which is detected via the <code>__del__()</code> method.
</p>
<p>Additionally, when connections are returned to the pool, a <code>rollback()</code> is issued on the connection unconditionally.  This is to release any locks still held by the connection that may have resulted from normal activity.
</p>
<p>By default, the <code>connect()</code> method will return the same connection that is already checked out in the current thread.  This allows a particular connection to be used in a given thread without needing to pass it around between functions.  To disable this behavior, specify <code>use_threadlocal=False</code> to the <code>manage()</code> function.
</p>



            <a href="#pooling">back to section top</a>
    </div>



    
    <A name="pooling_configuration"></a>
    
    <div class="sectionL2">

    <h3>Connection Pool Configuration</h3>
    
    

<p>For all types of Pool construction, which includes the "transparent proxy" described in the previous section, using an <code>Engine</code> via <code>create_engine()</code>, or constructing a pool through direct class instantiation, the options are generally the same.  Additional options may be available based on the specific subclass of <code>Pool</code> being used.
</p>
<p>For a description of all pool classes, see the <a href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool">generated documentation</a>.
</p>
<p>Common options include:
</p>
<ul>
 <li>
     echo=False : if set to True, connections being pulled and retrieved from/to the pool will
        be logged to the standard output, as well as pool sizing information.  Echoing can also
        be achieved by enabling logging for the "sqlalchemy.pool" namespace.  When using create_engine(), 
        this option is specified as <code>echo_pool</code>.
 </li>

 <li>
     use_threadlocal=False : if set to True, repeated calls to connect() within the same
        application thread will be guaranteed to return the same connection object, if one has
        already been retrieved from the pool and has not been returned yet. This allows code to
        retrieve a connection from the pool, and then while still holding on to that connection,
        to call other functions which also ask the pool for a connection of the same arguments;
        those functions will act upon the same connection that the calling method is using.
        This option is overridden during <code>create_engine()</code>, corresponding to the "plain" or 
   "threadlocal" connection strategy.
 </li>

 <li>
     recycle=-1 : if set to non -1, a number of seconds between connection recycling, which
        means upon checkout, if this timeout is surpassed the connection will be closed and replaced
        with a newly opened connection.
 </li>

 <li>
     auto_close_cursors = True : cursors, returned by connection.cursor(), are tracked and are 
        automatically closed when the connection is returned to the pool.  some DBAPIs like MySQLDB
        become unstable if cursors remain open.
 </li>

 <li>
     disallow_open_cursors = False : if auto_close_cursors is False, and disallow_open_cursors is True,
        will raise an exception if an open cursor is detected upon connection checkin.  If auto_close_cursors and disallow_open_cursors are both False, then no cursor processing occurs upon checkin.
 </li>
</ul>
<p>QueuePool options include:
</p>
<ul>
 <li>
     pool_size=5 : the size of the pool to be maintained. This is the
      largest number of connections that will be kept persistently in the pool. Note that the
      pool begins with no connections; once this number of connections is requested, that
      number of connections will remain.
 </li>

 <li>
     max_overflow=10 : the maximum overflow size of the pool. When the number of checked-out
      connections reaches the size set in pool_size, additional connections will be returned up
      to this limit. When those additional connections are returned to the pool, they are
      disconnected and discarded. It follows then that the total number of simultaneous
      connections the pool will allow is pool_size + max_overflow, and the total number of
      "sleeping" connections the pool will allow is pool_size. max_overflow can be set to -1 to
      indicate no overflow limit; no limit will be placed on the total number of concurrent
      connections.
 </li>

 <li>
     timeout=30 : the number of seconds to wait before giving up on returning a connection
 </li>
</ul>



            <a href="#pooling">back to section top</a>
    </div>



    
    <A name="pooling_custom"></a>
    
    <div class="sectionL2">

    <h3>Custom Pool Construction</h3>
    
    

<p>Besides using the transparent proxy, instances of <code>sqlalchemy.pool.Pool</code> can be created directly.  Constructing your own pool involves passing a callable used to create a connection.  Through this method, custom connection schemes can be made, such as a connection that automatically executes some initialization commands to start.  <br></br>
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Constructing a QueuePool</div>
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">psycopg2</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_comment"># execute an initialization function on the connection before returning
    </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"setup_encodings()"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">c</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">use_threadlocal</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Or with SingletonThreadPool:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Constructing a SingletonThreadPool</div>
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">sqlite</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlite</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">filename</span><span class="python_operator">=</span><span class="python_literal">'myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SQLite connections require the SingletonThreadPool    
</span><span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">SingletonThreadPool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>




            <a href="#pooling">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="plugins"></a>

        
    <div class="navbanner">
        <a href="documentation.html">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#pooling">Connection Pooling</a>

               |   
            Next: <a href="docstrings.html#docstrings">Generated Documentation</a>
    </div>

        <h2>Plugins</h2>
    </div>


        








    
    <A name="plugins"></a>
    
    <div class="sectionL1">

    
    

<p>SQLAlchemy has a variety of extensions and "mods" available which provide extra functionality to SA, either via explicit usage or by augmenting the core behavior.  Several of these extensions are designed to work together.
</p>


    
    <A name="plugins_sessioncontext"></a>
    
    <div class="sectionL2">

    <h3>SessionContext</h3>
    
    

<p><strong>Author:</strong>  Daniel Miller
</p>
<p>This plugin is used to instantiate and manage Session objects.  It is the preferred way to provide thread-local session functionality to an application.  It provides several services:
</p>
<ul>
 <li>
     serves as a factory to create sessions of a particular configuration.  This factory may either call <code>create_session()</code> with a particular set of arguments, or instantiate a different implementation of <code>Session</code> if one is available.
 </li>

 <li>
     for the <code>Session</code> objects it creates, provides the ability to maintain a single <code>Session</code> per distinct application thread.  The <code>Session</code> returned by a <code>SessionContext</code> is called the <em>contextual session.</em>   Providing at least a thread-local context to sessions is important because the <code>Session</code> object is not threadsafe, and is intended to be used with localized sets of data, as opposed to a single session being used application wide.
 </li>

 <li>
     besides maintaining a single <code>Session</code> per thread, the contextual algorithm can be changed to support any kind of contextual scheme.
 </li>

 <li>
     provides a <code>MapperExtension</code> that can enhance a <code>Mapper</code>, such that it can automatically <code>save()</code> newly instantiated objects to the current contextual session.  It also allows <code>Query</code> objects to be created without an explicit <code>Session</code>.  While this is very convenient functionality, having it switched on without understanding it can be very confusing.  Note that this feature is optional when using <code>SessionContext</code>.
 </li>
</ul>
<p>Using the SessionContext in its most basic form involves just instantiating a <code>SessionContext</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the contextual session is referenced by the "current" property on SessionContext
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>From this example, one might see that the <code>SessionContext</code>'s typical <em>scope</em> is at the module or application level.  Since the <code>Session</code> itself is better suited to be used in per-user-request or even per-function scope, the <code>SessionContext</code> provides an easy way to manage the scope of those <code>Session</code> objects.
</p>
<p>The construction of each <code>Session</code> instance can be customized by providing a "creation function" which returns a new <code>Session</code>.  A common customization is a <code>Session</code> which needs to explicitly bind to a particular <code>Engine</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_comment"># create an engine
</span><span class="python_name">someengine </span><span class="python_operator">= </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a function to return a Session bound to our engine
</span><span class="python_keyword">def </span><span class="python_name">make_session</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">someengine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SessionContext
</span><span class="python_operator"></span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">make_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the session bound to engine "someengine":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator"></span></pre>
    </div>
<p>The above pattern is more succinctly expressed using Python lambdas:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_keyword">lambda</span><span class="python_operator">:</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">someengine</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>The default creation function is simply:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The "scope" to which the session is associated, which by default is a thread-local scope, can be customized by providing a "scope callable" which returns a hashable key that represents the current scope:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_comment"># global declaration of "scope"
</span><span class="python_name">scope </span><span class="python_operator">= </span><span class="python_literal">"scope1"</span><span class="python_operator">
</span>
<span class="python_comment"># a function to return the current "session scope"
</span><span class="python_keyword">def </span><span class="python_name">global_scope_func</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">scope</span><span class="python_operator">
</span>
<span class="python_comment"># create SessionContext with a custom "scopefunc"
</span><span class="python_operator"></span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_operator">, </span><span class="python_name">scopefunc</span><span class="python_operator">=</span><span class="python_name">global_scope_func</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the session corresponding to "scope1":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">
</span>
<span class="python_comment"># switch the "scope"
</span><span class="python_name">scope </span><span class="python_operator">= </span><span class="python_literal">"scope2"</span><span class="python_operator">
</span>
<span class="python_comment"># get the session corresponding to "scope2":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator"></span></pre>
    </div>
<p>Examples of customized scope can include user-specific sessions or requests, or even sub-elements of an application, such as a graphical application which maintains a single <code>Session</code> per application window (this was the original motivation to create SessionContext).
</p>


    
    <A name="plugins_sessioncontext_sessioncontextext"></a>
    
    <div class="sectionL3">

    <h3>Using SessionContextExt</h3>
    
    

<p>This is a <code>MapperExtension</code> which allows a <code>Mapper</code> to be automatically associated with a <code>SessionContext</code>.  Newly constructed objects get <code>save()</code>d to the session automatically, and <code>Query</code> objects can be constructed without a session. The instance of <code>SessionContextExt</code> is provided by the <code>SessionContext</code> itself:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">mapper_extension</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># 'u' is automatically added to the current session of 'ctx'
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_keyword">assert </span><span class="python_name">u </span><span class="python_keyword">in </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">
</span>
<span class="python_comment"># get the current session and flush
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>MapperExtension</code> can be configured either per-mapper as above, or on an application-wide basis using:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_keyword">import </span><span class="python_name">global_extensions</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">global_extensions</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">mapper_extension</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>SessionContextExt allows <code>Query</code> objects to be created against the mapped class without specifying a <code>Session</code>.  Each <code>Query</code> will automatically make usage of the current contextual session:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># create a Query from a class
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># specify entity name
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a Query from a mapper
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then use it
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>When installed globally, all <code>Mapper</code> objects will contain a built-in association to the <code>SessionContext</code>.  This means that once a mapped instance is created, creating a new <code>Session</code> and calling <code>save()</code> with the instance as an argument will raise an error stating that the instance is already associated with a different session.  While you can always remove the object from its original session, <code>SessionContextExt</code> is probably convenient only for an application that does not need much explicit manipulation of sessions.
</p>
<p>The user still has some control over which session gets used at instance construction time.  An instance can be redirected at construction time to a different <code>Session</code> by specifying the keyword parameter <code>_sa_session</code> to its constructor, which is decorated by the mapper:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()  </span><span class="python_comment"># create a new session distinct from the contextual session</span><span class="python_operator">
</span><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">_sa_session</span><span class="python_operator">=</span><span class="python_name">session</span><span class="python_enclosure">)  </span><span class="python_comment"># make a new User that is saved to this session</span><span class="python_operator"></span></pre>
    </div>
<p>Similarly, the <code>entity_name</code> parameter, which specifies an alternate <code>Mapper</code> to be used when attaching this instance to the <code>Session</code>, can be specified via <code>_sa_entity_name</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">_sa_session</span><span class="python_operator">=</span><span class="python_name">session</span><span class="python_operator">, </span><span class="python_name">_sa_entity_name</span><span class="python_operator">=</span><span class="python_literal">'altentity'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>The decoration of mapped instances' <code>__init__()</code> method is similar to this example:    <br></br>
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">oldinit </span><span class="python_operator">= </span><span class="python_name">class_</span><span class="python_operator">.</span><span class="python_name">__init__   </span><span class="python_comment"># the previous init method</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">kwargs</span><span class="python_operator">.</span><span class="python_name">pop</span><span class="python_enclosure">(</span><span class="python_literal">'_sa_session'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">entity_name </span><span class="python_operator">= </span><span class="python_name">kwargs</span><span class="python_operator">.</span><span class="python_name">pop</span><span class="python_enclosure">(</span><span class="python_literal">'_sa_entity_name'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">() </span><span class="python_comment"># get Session from this Mapper's MapperExtension</span><span class="python_operator">
        </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is </span><span class="python_name">EXT_PASS</span><span class="python_operator">:
            </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_name">entity_name</span><span class="python_enclosure">)  </span><span class="python_comment"># attach to the current session</span><span class="python_operator">
    </span><span class="python_name">oldinit</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwagrs</span><span class="python_enclosure">)   </span><span class="python_comment"># call previous init method</span><span class="python_operator"></span></pre>
    </div>



            <a href="#plugins">back to section top</a>
    </div>




    </div>



    
    <A name="plugins_selectresults"></a>
    
    <div class="sectionL2">

    <h3>SelectResults</h3>
    
    

<p><strong>Author:</strong> Jonas Borgström
</p>
<p><em>NOTE:</em> As of verison 0.3.6 of SQLAlchemy, most behavior of <code>SelectResults</code> has been rolled into the base <code>Query</code> object.  Explicit usage of <code>SelectResults</code> is therefore no longer needed.
</p>
<p><code>SelectResults</code> gives transformative behavior to the results returned from the <code>select</code> and <code>select_by</code> methods of <code>Query</code>. 
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">selectresults </span><span class="python_keyword">import </span><span class="python_name">SelectResults</span><span class="python_operator">
</span>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">query</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column </span><span class="python_operator">== </span><span class="python_literal">"something"</span><span class="python_enclosure">) </span><span class="python_comment"># adds a WHERE clause (or appends to the existing via "and")</span><span class="python_operator">
</span><span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">([</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_enclosure">]) </span><span class="python_comment"># adds an ORDER BY clause</span><span class="python_operator">
</span>
<span class="python_keyword">for </span><span class="python_name">x </span><span class="python_keyword">in </span><span class="python_name">res</span><span class="python_enclosure">[</span><span class="python_operator">:</span><span class="python_number">10</span><span class="python_enclosure">]</span><span class="python_operator">:  </span><span class="python_comment"># Fetch and print the top ten instances - adds OFFSET 0 LIMIT 10 or equivalent</span><span class="python_operator">
  </span><span class="python_keyword">print </span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">column2</span><span class="python_operator">
</span>
<span class="python_comment"># evaluate as a list, which executes the query
</span><span class="python_operator"></span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">list</span><span class="python_enclosure">(</span><span class="python_name">res</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># Count how many instances that have column2 > 42
# and column == "something"
</span><span class="python_keyword">print </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column2 </span><span class="python_operator">> </span><span class="python_number">42</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># select() is a synonym for filter()
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">==</span><span class="python_literal">"something"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">([</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_enclosure">])[</span><span class="python_number">2</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>An important facet of SelectResults is that the actual SQL execution does not occur until the object is used in a list or iterator context.  This means you can call any number of transformative methods (including <code>filter</code>, <code>order_by</code>, list range expressions, etc) before any SQL is actually issued.
</p>
<p>Configuration of SelectResults may be per-Query, per Mapper, or per application:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">selectresults </span><span class="python_keyword">import </span><span class="python_name">SelectResults</span><span class="python_operator">, </span><span class="python_name">SelectResultsExt</span><span class="python_operator">
</span>
<span class="python_comment"># construct a SelectResults for an individual Query
</span><span class="python_name">sel </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Mapper where the Query.select()/select_by() methods will return a SelectResults:
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">SelectResultsExt</span><span class="python_enclosure">())</span><span class="python_operator">
</span>
<span class="python_comment"># globally configure all Mappers to return SelectResults, using the "selectresults" mod
</span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">selectresults</span><span class="python_operator"></span></pre>
    </div>
<p>SelectResults greatly enhances querying and is highly recommended.  For example, heres an example of constructing a query using a combination of joins and outerjoins:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'orders'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">, </span><span class="python_name">orders_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'items'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">}))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">outerjoin_to</span><span class="python_enclosure">(</span><span class="python_literal">'orders'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin_to</span><span class="python_enclosure">(</span><span class="python_literal">'items'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">order_id</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">Item</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">item_id</span><span class="python_operator">==</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>For a full listing of methods, see the <a href="sqlalchemy_ext_selectresults.html#docstrings_sqlalchemy.ext.selectresults">generated documentation</a>.
</p>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_assignmapper"></a>
    
    <div class="sectionL2">

    <h3>assignmapper</h3>
    
    

<p><strong>Author:</strong> Mike Bayer
</p>
<p>This extension is used to decorate a mapped class with direct knowledge about its own <code>Mapper</code>, a contextual <code>Session</code>, as well as functions provided by the <code>Query</code> and <code>Session</code> objects.  The methods will automatically make usage of a contextual session with which all newly constructed objects are associated.  <code>assign_mapper</code> operates as a <code>MapperExtension</code>, and requires the usage of a <code>SessionContext</code> as well as <code>SessionContextExt</code>, described in <a href="#plugins_sessioncontext">SessionContext</a>.  It replaces the usage of the normal <code>mapper</code> function with its own version that adds a <code>SessionContext</code> specified as the first argument:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">assignmapper </span><span class="python_keyword">import </span><span class="python_name">assign_mapper</span><span class="python_operator">
</span>
<span class="python_comment"># session context
</span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># assign mapper to class MyClass using table 'sometable', getting
# Sessions from 'ctx'.
</span><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">ctx</span><span class="python_operator">, </span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">sometable</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_operator">...</span><span class="python_enclosure">}</span><span class="python_operator">, ...</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>
<p>Above, all new instances of <code>MyClass</code> will be associated with the contextual session, <code>ctx.current</code>.  Additionally, <code>MyClass</code> and instances of <code>MyClass</code> now contain a large set of methods including <code>get</code>, <code>select</code>, <code>flush</code>, <code>delete</code>.  The full list is as follows:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># Query methods:
</span><span class="python_enclosure">[</span><span class="python_literal">'get'</span><span class="python_operator">, </span><span class="python_literal">'select'</span><span class="python_operator">, </span><span class="python_literal">'select_by'</span><span class="python_operator">, </span><span class="python_literal">'selectone'</span><span class="python_operator">, </span><span class="python_literal">'get_by'</span><span class="python_operator">, </span><span class="python_literal">'join_to'</span><span class="python_operator">, </span><span class="python_literal">'join_via'</span><span class="python_operator">, </span><span class="python_literal">'count'</span><span class="python_operator">, </span><span class="python_literal">'count_by'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># Session methods:
</span><span class="python_enclosure">[</span><span class="python_literal">'flush'</span><span class="python_operator">, </span><span class="python_literal">'delete'</span><span class="python_operator">, </span><span class="python_literal">'expire'</span><span class="python_operator">, </span><span class="python_literal">'refresh'</span><span class="python_operator">, </span><span class="python_literal">'expunge'</span><span class="python_operator">, </span><span class="python_literal">'merge'</span><span class="python_operator">, </span><span class="python_literal">'save'</span><span class="python_operator">, </span><span class="python_literal">'update'</span><span class="python_operator">, </span><span class="python_literal">'save_or_update'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>To continue the <code>MyClass</code> example:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_comment"># create a MyClass.  it will be automatically assigned to the contextual Session.
</span><span class="python_name">mc </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># save MyClass - this will call flush() on the session, specifying 'mc' as the only
# object to be affected
</span><span class="python_name">mc</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load an object, using Query methods attached to MyClass
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># delete it
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># commit all changes
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p><strong>Note:</strong> : while the <code>flush()</code> method is also available on individual object instances, the instance-local flush() <strong>does not flush dependent objects</strong>.  For this reason this method may be removed in a future release and replaced with a more explicit version.
</p>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_associationproxy"></a>
    
    <div class="sectionL2">

    <h3>associationproxy</h3>
    
    

<p><strong>Author:</strong> Mike Bayer<br></br>
   <strong>Version:</strong> 0.3.1 or greater
</p>
<p><code>associationproxy</code> is used to create a transparent proxy to the associated object in an association relationship, thereby decreasing the verbosity of the pattern in cases where explicit access to the association object is not required.  The association relationship pattern is a richer form of a many-to-many relationship, which is described in <a href="#datamapping_association">Association Object</a>.  It is strongly recommended to fully understand the association object pattern in its explicit form before using this extension; see the examples in the SQLAlchemy distribution under the directory <code>examples/association/</code>.
</p>
<p>When dealing with association relationships, the <strong>association object</strong> refers to the object that maps to a row in the association table (i.e. the many-to-many table), while the <strong>associated object</strong> refers to the "endpoint" of the association, i.e. the ultimate object referenced by the parent.  The proxy can return collections of objects attached to association objects, and can also create new association objects given only the associated object.  An example using the Keyword mapping described in the data mapping documentation is as follows:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">AssociationProxy</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># create "keywords" proxied association.
    # the collection is called 'keyword_associations', the endpoint
    # attribute of each association object is called 'keyword'.  the 
    # class itself of the association object will be figured out automatically  .
</span><span class="python_operator">    </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">AssociationProxy</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_associations'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># create mappers normally
# note that we set up 'keyword_associations' on Article,
# and 'keyword' on KeywordAssociation.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keyword_associations'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">,</span>
    <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">article_id</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'keyword' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">) </span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># now, Keywords can be attached to an Article directly;
# KeywordAssociation will be created by the AssociationProxy, and have the 
# 'keyword' attribute set to the new Keyword.
# note that these KeywordAssociation objects will not have a User attached to them.
</span><span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'blue'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'red'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the "keywords" collection also returns the underlying Keyword objects
</span><span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">k </span><span class="python_keyword">in </span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"Keyword:"</span><span class="python_operator">, </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">keyword_name</span><span class="python_operator">
</span>
<span class="python_comment"># the original 'keyword_associations' relation exists normally with no awareness of the proxy
</span><span class="python_operator"></span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keyword_associations</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">ka </span><span class="python_keyword">for </span><span class="python_name">ka </span><span class="python_keyword">in </span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keyword_associations</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre>
    </div>
<p>Note that the above operations on the <code>keywords</code> collection are proxying operations to and from the <code>keyword_associations</code> collection, which exists normally and can be accessed directly.  <code>AssociationProxy</code> will also detect if the collection is list or scalar based and will configure the proxied property to act the same way.
</p>
<p>For the common case where the association object's creation needs to be specified by the application, <code>AssociationProxy</code> takes an optional callable <code>creator()</code> which takes a single associated object as an argument, and returns a new association object.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">def </span><span class="python_name">create_keyword_association</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">ka </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">ka</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">ka</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># create "keywords" proxied association
</span><span class="python_operator">    </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">AssociationProxy</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_associations'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">create_keyword_association</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_threadlocal"></a>
    
    <div class="sectionL2">

    <h3>threadlocal</h3>
    
    

<p><strong>Author:</strong>  Mike Bayer and Daniel Miller
</p>
<p><code>threadlocal</code> is an extension that was created primarily to provide backwards compatibility with the older SQLAlchemy 0.1 series.  It uses three features which SQLAlchemy 0.2 and above provide as distinct features:  <code>SessionContext</code>, <code>assign_mapper</code>, and the <code>TLEngine</code>, which is the <code>Engine</code> used with the threadlocal <code>create_engine()</code> strategy.  It is <strong>strongly</strong> recommended that these three features are understood individually before using threadlocal.
</p>
<p>In SQLAlchemy 0.1, users never dealt with explcit connections and didn't have a very explicit <code>Session</code> interface, instead relying upon a more magical global object called <code>objectstore</code>.  The <code>objectstore</code> idea was wildly popular with about half of SA's users, and completely unpopular with the other half.  The threadlocal mod basically brings back <code>objectstore</code>, which is in fact just a <code>SessionContext</code> where you can call <code>Session</code> methods directly off of it, instead of saying <code>context.current</code>.  For <code>threadlocal</code> to faithfully produce 0.1 behavior, it is invoked as a <em>mod</em> which globally installs the objectstore's mapper extension, such that all <code>Mapper</code>s will automatically assign all new instances of mapped classes to the objectstore's contextual <code>Session</code>.  Additionally, it also changes the default engine strategy used by <code>create_engine</code> to be the "threadlocal" strategy, which in normal practice does not affect much. 
</p>
<p>When you import threadlocal, what you get is:
</p>
<ul>
 <li>
     the "objectstore" session context object is now added to the <code>sqlalchemy</code> namespace.
 </li>

 <li>
     a global <code>MapperExtension</code> is set up for all mappers which assigns "objectstore"'s session as the default session context, used by new instances as well as <code>Query</code> objects (see the section <a href="#plugins_sessioncontext_sessioncontextext">Using SessionContextExt</a>).
 </li>

 <li>
     a new function "assign_mapper" is added to the <code>sqlalchemy</code> namespace, which calls the <code>assignmapper</code> mapper function using the new "objectstore" context.
 </li>

 <li>
     the <code>create_engine</code> function is modified so that "threadlocal", and not "plain", is the default engine strategy.
 </li>
</ul>
<p>So an important point to understand is, <strong>don't use the threadlocal mod unless you explcitly are looking for that behavior</strong>.  Unfortunately, the easy import of the "threadlocal" mod has found its way into several tutorials on external websites, which produces application-wide behavior that is in conflict with the SQLAlchemy tutorial and data mapping documentation.
</p>
<p>While "threadlocal" is only about 10 lines of code, it is strongly advised that users instead make usage of <code>SessionContext</code> and <code>assign_mapper</code> explictly to eliminate confusion.  Additionally, the "threadlocal" strategy on <code>create_engine()</code> also exists primarily to provide patterns used in 0.1 and is probably not worth using either, unless you specifically need those patterns.
</p>
<p>Basic usage of threadlocal involves importing the mod, <em>before</em> any usage of the <code>sqlalchemy</code> namespace, since threadlocal is going to add the "objectstore" and "assign_mapper" keywords to "sqlalchemy".
</p>
<p>To use <code>objectstore</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">threadlocal</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">user_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "user" object is added to the session automatically
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># flush the contextual session
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>The actual <code>Session</code> is available as:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>
<p>To use <code>assign_mapper</code>:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">threadlocal</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># note that no "context" object is needed
</span><span class="python_operator"></span><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">user_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># call up a user
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">user_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># call 'delete' on the user
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre>
    </div>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_activemapper"></a>
    
    <div class="sectionL2">

    <h3>ActiveMapper</h3>
    
    

<p><strong>Author:</strong> Jonathan LaCour
</p>
<p>Please note that ActiveMapper has been deprecated in favor of <a href='http://elixir.ematia.de/'>Elixir</a>, a more comprehensive solution to declarative mapping, of which Jonathan is a co-author.
</p>
<p>ActiveMapper is a so-called "declarative layer" which allows the construction of a class, a <code>Table</code>, and a <code>Mapper</code> all in one step:
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">class </span><span class="python_name">Person</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">id          </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">full_name   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">first_name  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">middle_name </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">last_name   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">birth_date  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">ssn         </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">gender      </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">home_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">cell_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">work_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">prefs_id    </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">foreign_key</span><span class="python_operator">=</span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'preferences.id'</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_name">addresses   </span><span class="python_operator">= </span><span class="python_name">one_to_many</span><span class="python_enclosure">(</span><span class="python_literal">'Address'</span><span class="python_operator">, </span><span class="python_name">colname</span><span class="python_operator">=</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">preferences </span><span class="python_operator">= </span><span class="python_name">one_to_one</span><span class="python_enclosure">(</span><span class="python_literal">'Preferences'</span><span class="python_operator">, </span><span class="python_name">colname</span><span class="python_operator">=</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">__str__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">s </span><span class="python_operator">=  </span><span class="python_literal">'%s\n' </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">full_name</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * birthdate: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">birth_date </span><span class="python_keyword">or </span><span class="python_literal">'not provided'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * fave color: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">favorite_color </span><span class="python_keyword">or </span><span class="python_literal">'Unknown'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * personality: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">personality_type </span><span class="python_keyword">or </span><span class="python_literal">'Unknown'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
        <span class="python_keyword">for </span><span class="python_name">address </span><span class="python_keyword">in </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:
            </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * address: %s\n' </span><span class="python_operator">% </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">address_1</span><span class="python_operator">
            </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'             %s, %s %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">state</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">postal_code</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
        <span class="python_operator"></span><span class="python_keyword">return </span><span class="python_name">s</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Preferences</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">__table__        </span><span class="python_operator">= </span><span class="python_literal">'preferences'</span><span class="python_operator">
        </span><span class="python_name">id               </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">favorite_color   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">personality_type </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">id          </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">type        </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">address_1   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">city        </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">state       </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">postal_code </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">person_id   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">foreign_key</span><span class="python_operator">=</span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'person.id'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre>
    </div>
<p>More discussion on ActiveMapper can be found at <a href='http://cleverdevil.org/computing/35/declarative-mapping-with-sqlalchemy'>Jonathan LaCour's Blog</a> as well as the <a href='http://www.sqlalchemy.org/trac/wiki/ActiveMapper'>SQLAlchemy Wiki</a>.
</p>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_sqlsoup"></a>
    
    <div class="sectionL2">

    <h3>SqlSoup</h3>
    
    

<p><strong>Author:</strong> Jonathan Ellis
</p>
<p>SqlSoup creates mapped classes on the fly from tables, which are automatically reflected from the database based on name.  It is essentially a nicer version of the "row data gateway" pattern.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_literal">>>> </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sqlsoup </span><span class="python_keyword">import </span><span class="python_name">SqlSoup</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">soup </span><span class="python_operator">= </span><span class="python_name">SqlSoup</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Bhargan Basepair'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'basepair@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'basepair'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
 <span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Joe Student'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'student@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'student'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">0</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre>
    </div>
<p>Full SqlSoup documentation is on the <a href='http://www.sqlalchemy.org/trac/wiki/SqlSoup'>SQLAlchemy Wiki</a>.
</p>



            <a href="#plugins">back to section top</a>
    </div>



    
    <A name="plugins_proxyengine"></a>
    
    <div class="sectionL2">

    <h3>ProxyEngine</h3>
    
    

<p><strong>Author:</strong> Jason Pellerin
</p>
<p>The <code>ProxyEngine</code> is used to "wrap" an <code>Engine</code>, and via subclassing <code>ProxyEngine</code> one can instrument the functionality of an arbitrary <code>Engine</code> instance through the decorator pattern.  It also provides a <code>connect()</code> method which will send all <code>Engine</code> requests to different underlying engines.  Its functionality in that regard is largely superceded now by <code>DynamicMetaData</code> which is a better solution.
</p>

    

    <div class="sliding_code">
        <pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">proxy </span><span class="python_keyword">import </span><span class="python_name">ProxyEngine</span><span class="python_operator">
</span><span class="python_name">proxy </span><span class="python_operator">= </span><span class="python_name">ProxyEngine</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">proxy</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://user:pw@host/db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre>
    </div>




            <a href="#plugins">back to section top</a>
    </div>




    </div>


</html>
    
    
    <A name="docstrings"></a>

    
    
    <A name="docstrings_sqlalchemy.sql"></a>

    
    
    <A name="docstrings_sqlalchemy.schema"></a>

    
    
    <A name="docstrings_sqlalchemy.types"></a>

    
    
    <A name="docstrings_sqlalchemy.engine"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.url"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.strategies"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.default"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.threadlocal"></a>

    
    
    <A name="docstrings_sqlalchemy.ansisql"></a>

    
    
    <A name="docstrings_sqlalchemy.orm"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.mapper"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.query"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.session"></a>

    
    
    <A name="docstrings_sqlalchemy.exceptions"></a>

    
    
    <A name="docstrings_sqlalchemy.pool"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.sessioncontext"></a>

    
    
    <A name="docstrings_sqlalchemy.mods.threadlocal"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.selectresults"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.proxy"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.sqlite"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.postgres"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.mysql"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.oracle"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.mssql"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.firebird"></a>








</body>
</html>






