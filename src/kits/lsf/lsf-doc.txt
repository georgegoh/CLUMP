<html>
<head>
<title>Deploying Platform LSF 7.0.2 on OCS 5</title>
<style type="text/css">
    #cmd {
        font-family: courier new, courier, monospace;
    }

    #code {
        background: #c0c0c0;
        margin-left: 20px;
        margin-right: 300px;
        font-family: sans-serif;
        font-weight: bolder;
    }

    #path {
        font-family: sans-serif;
        font-weight: bold;
    }
</style>
</head>
<body>
<h1>Deploying Platform LSF 7.0.2 on OCS 5</h1>
<h3>Written by Mike Frisch &lt;mfrisch@platform.com&gt;</h3>
<h3>December 18th, 2007</h3>
<hr/>

<h2>Installing the OCS LSF Kit</h2>

<p>
This installation procedure assumes a functioning OCS 5 installation.
</p>

<ol>
<li id="listitem">Download the LSF kit ISO from my.platform.com</li>
<p></p>

<li>Install the kit using standard OCS kit installation procedure:

<div id="code">
<p>
<span id="cmd">kitops --add -m kit-lsf-7.0.2-0.x86_64.iso</span>
</p>

<p>
<span id="cmd">repoman -a --kit lsf -r "rhel5_x86_64"</span>
</p>

<p>
<span id="cmd">repoman -u -r "rhel5_x86_64"</span>
</p>

<p>
<span id="cmd">cfmsync -f -p</span>
</p>
</div>

<p>
Note: the default repo name for OCS 5 is "rhel5_x86_64" 
</p>

<p>
This procedure will make LSF available to your OCS cluster.
</p>

<p>
During the LSF kit installation process, the nodegroup <em>lsf-master-candidate</em> is
created.  Any nodes added to this nodegroup will become LSF master candidate
nodes.  These nodes will be configured as <i>"management hosts"</i> to LSF.  See LSF
documentation for more information about management hosts.
</p>

<p>
Note: it is necessary to have at least one LSF master candidate within an LSF
cluster.
</p>

<p>
Any 'regular' OCS cluster nodes (typically added to the "rhel-compute"
nodegroup) automatically become LSF cluster nodes.
</p>
</li>

<li>Install a license.dat file
<p>
LSF requires a valid license file in order to function.
</p>
<p>

It should be copied to the following locations:
</p>

   <ul>
   <li><span id="path">/etc/cfm/lsf-master-candidate/opt/lsf/conf</span></li>
   <li><span id="path">/etc/cfm/rhel-compute/opt/lsf/conf</span></li>
    </ul>

<p>
This will make it available to all LSF/OCS cluster nodes.
</p>

<p>
If the license file is installed later, it is necessary to restart LSF for the
new license file to register.  Alternatively, simply reboot the node.
</p>
</ol>

<h2>Testing Your LSF Installation</h2>

<p>
The <span id="cmd">lsid</span> command should display basic cluster information (master/master candidates and the cluster name).
</p>

<p>
The LSF command <span id="cmd">lshosts</span> can be used to display all hosts in the LSF cluster.  The host names displayed should match those in use by the OCS cluster.
</p>

<p>
Note: it can take a while for all nodes to report to the master depending on the cluster size and network activity within the cluster
</p>

<h2>LSF Installation location</h2>

The installation directory of LSF is <span id="path">/opt/lsf</span>

<h2>LSF Environment Variables</h2>

<p>
The LSF environment is automatically initialized through the following symbolic
links:
</p>

<ul>
   <li><span id="path">/etc/profile.d/lsf.sh</span></li>
   <li><span id="path">/etc/profile.d/lsf.csh</span></li>
</ul>

<h2>Starting LSF</h2>

LSF on OCS is preconfigured to start automatically when the node boots.

This can be controlled by using <span id="cmd">chkconfig</span>.  The service name is <em>lsf_daemons</em>.


<h2>Default Cluster Name</h2>

<p>
The default cluster name for an LSF cluster installed on OCS is the host name
of the installer node.  This can be changed by the end-user as necessary.
</p>

<h2>LSF Configuration Files</h2>

<p>
The subdirectory <span id="path">/etc/cfm/templates/lsf</span> on the OCS installer node contains
the "template" configuration files for LSF. These are files which may be
customized with site-specific settings.
</p>

<p>
<span id="path">/etc/cfm/templates/lsf/default.lsf.conf.master</span> contains the configuration for
master candidate nodes (all nodes in the lsf-master-candidate nodegroup).
</p>

<p>
<span id="path">/etc/cfm/templates/lsf/default.lsf.conf.slave</span> contains the configuration for
LSF compute nodes (all nodes in the rhel-compute/rhel-diskless/rhel-imaged
nodegroups)
</p>

<p>
These are the "master" files and can be customized.  Any changes specific to
the cluster (ie. LSF_MASTER_xxx are overwritten as part of the OCS
integration).  Use OCS to reconfigure settings such as the admin email address.
</p>

<p>
Use the command <span id="cmd">cfmsync -f -p</span> to propagate the updated configuration files to
the LSF cluster nodes.
</p>

<h2>Migrating from Platform Lava to Platform LSF</h2>

TBD
