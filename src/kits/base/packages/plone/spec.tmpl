# Copyright (C) 2007 Platform Computing Inc.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of version 2 of the GNU General Public License as
# published by the Free Software Foundation.
# 	
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
# 
# $Id: spec.tmpl 1335 2007-06-14 11:06:48Z najib $
#

%define _approot @KUSUROOT@
%define brp-python-bytecompile /bin/true




Summary: @NAME@ module runtime
Name: @NAME@
Version: @VERSION@
Release: @RELEASE@
License: MIT
Group: System Environment/Base
Vendor: Platform Computing Inc.
BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot
BuildArch: noarch
AutoReq: no
Requires: coreutils
Requires: shadow-utils

%description
This package installs the @NAME@.

%prep
mkdir -p %{buildroot}%{_approot}
mkdir -p %{buildroot}/etc/init.d

%install
cd %{_builddir}/%{name}-%{version}-%{release}
find bin/ | cpio -mpdu %{buildroot}%{_approot}
find info/ | cpio -mpdu %{buildroot}%{_approot}
find lib/ | cpio -mpdu %{buildroot}%{_approot}
find lib64/ | cpio -mpdu %{buildroot}%{_approot}
find man/ | cpio -mpdu %{buildroot}%{_approot}
find share/ | cpio -mpdu %{buildroot}%{_approot}
find receipts/ | cpio -mpdu %{buildroot}%{_approot}
find skel/ | cpio -mpdu %{buildroot}%{_approot}
find zinstance/ | cpio -mpdu %{buildroot}%{_approot}
find doc/ | cpio -mpdu %{buildroot}%{_approot}
find Python-2.4.4/ | cpio -mpdu %{buildroot}%{_approot}

install -m755 zinstance.3.0.3 %{buildroot}/etc/init.d/zinstance
install -m755 zeocluster.3.0.3 %{buildroot}/etc/init.d/zeocluster

%pre
if ! /usr/bin/id plone &>/dev/null; then
    useradd -d %{_approot} plone > /dev/null 2>&1 || true
fi

%postun
if [ $1 -eq 0 ]; then
    /usr/sbin/userdel plone > /dev/null 2>&1 || true
fi

%post
/bin/chown -R plone.plone %{_approot} > /dev/null 2>&1 


%clean
rm -rf %{buildroot}

%files
%{_approot}
/etc/init.d/zinstance
/etc/init.d/zeocluster


