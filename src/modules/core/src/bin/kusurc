#!/usr/bin/env python
#
# $Id$
#
# Copyright 2007 Platform Computing Inc.
#
# Licensed under GPL version 2; See LICENSE file for details.
#

from kusu.core.plugin import PluginRunner
import kusu.util.log as kusulog
from path import path

import sys

kl = kusulog.getKusuLog()

if __name__ == '__main__':

    args = sys.argv

    if len(args) == 1:
        dir = '/etc/rc.kusu.d'
    else:
        dir = args[1]

    if path('/etc/profile.nii').exists():
        dbs = None

    elif path('/root/kusu.db').exists():
        from kusu.core import database as db
        dbs = db.DB('sqlite', '/root/kusu.db')
    
    else:        
        from kusu.core import database as db

        dbdriver = 'mysql'
        dbdatabase = 'kusudb'
        dbuser = 'apache'
        dbpassword = None
        
        dbs = db.DB(dbdriver, dbdatabase, dbuser, dbpassword)

    p = PluginRunner('KusuRC', dir, dbs)
    p.run()
